<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2013, 2014. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!--

  This is the ant file for running the Rule Objects Extractor Tool.
  This will extract rule objects data for a given CREOLECaseDetermination record 
  to the specified output folder. (creole.extract.ruleobjects)
  
  or 
  
  This will extract rule objects data for a given CREOLEProgGrpDetermination record 
  to the specified output folder. (creole.extract.programgroupruleobjects)
  
  The output will appear in html format similar in style to Session Doc output.

-->
<project
  default="creole.extract.ruleobjects"
  name="app_ruleobjectsdataextractor"
>


  <!--  ********************************************************************************  -->
  <!--  *** E X T R A C T  R U L E  O B J E C T S  F O R  D E T E R M I N A T I O N  ***  -->
  <!--  ********************************************************************************  -->
  <target name="creole.extract.ruleobjects">


    <!-- Start recording progress to a log file -->
    <mkdir dir="${dir.bld.log}"/>


    <!-- Set the starting time stamp for use in file names -->
    <tstamp>
      <format
        pattern="yyyyMMddHHmmss"
        property="tim.start.sort"
      />
    </tstamp>
    <record
      loglevel="info"
      name="${dir.bld.log}/ExtractData${tim.start.sort}.log"
    />


    <antcall
      inheritAll="false"
      target="dispmsg"
    >
      <param
        name="prm.msg"
        value="Invoking the Rule Objects Data Extractor"
      />
    </antcall>


    <!-- Start the data extraction -->
    <antcall target="extractruleobjectsforcasedetermination"/>


  </target>


  <!-- BEGIN, CR00437084, GD -->
  <target name="creole.extract.programgroupruleobjects">


    <!-- Start recording progress to a log file -->
    <mkdir dir="${dir.bld.log}"/>


    <!-- Set the starting time stamp for use in file names -->
    <tstamp>
      <format
        pattern="yyyyMMddHHmmss"
        property="tim.start.sort"
      />
    </tstamp>
    <record
      loglevel="info"
      name="${dir.bld.log}/ProgramGroupRuleObjectExtractData${tim.start.sort}.log"
    />


    <antcall
      inheritAll="false"
      target="dispmsg"
    >
      <param
        name="prm.msg"
        value="Invoking the Program Group Rule Objects Data Extractor"
      />
    </antcall>


    <!-- Start the data extraction -->
    <antcall target="extractruleobjectsforprogramgroupdetermination"/>


  </target>
  <!-- END, CR00437084 -->


  <target name="extractruleobjectsforcasedetermination">


    <condition
      property="extra.args"
      value="-logfiledir ${logFileDir}"
    >
      <and>
        <isset property="logFileDir"/>
      </and>
    </condition>
    <property
      name="extra.args"
      value=""
    />


    <property
      name="deleteOutputDir"
      value="true"
    />
    <condition
      property="deleteset"
      value="true"
    >
      <equals
        arg1="${deleteOutputDir}"
        arg2="true"
      />
    </condition>


    <condition
      property="extra.args.nohtml"
      value="-nohtml"
    >
      <and>
        <isset property="nohtml"/>
      </and>
    </condition>
    <property
      name="extra.args.nohtml"
      value=""
    />


    <antcall target="deletedataextractoutput"/>
    <java
      classname="curam.core.sl.util.impl.ExtractRuleObjectsTool"
      classpathref="j.cp"
      failonerror="${java.failonerror}"
      fork="${java.fork}"
      maxmemory="${java.maxmemory}"
      taskname="dataextractor"
    >
      <sysproperty
        key="curam.disable.dynamic.properties"
        value="true"
      />
      <jvmarg value="${java.jvmargs}"/>
      <jvmarg value="-Xms${java.maxmemory}"/>
      <jvmarg value="-Xbootclasspath/p:${jars.allxml}"/>
      <arg line="-outdir ${outputDir}"/>
      <arg line="-determinationID ${caseDeterminationID}"/>
      <arg line="${extra.args}"/>
      <arg line="${extra.args.nohtml}"/>
    </java>


    <echo>The output file/s have been created</echo>


  </target>


  <!-- BEGIN, CR00437084, GD -->
  <target name="extractruleobjectsforprogramgroupdetermination">


    <condition
      property="extra.args"
      value="-logfiledir ${logFileDir}"
    >
      <and>
        <isset property="logFileDir"/>
      </and>
    </condition>
    <property
      name="extra.args"
      value=""
    />


    <property
      name="deleteOutputDir"
      value="true"
    />
    <condition
      property="deleteset"
      value="true"
    >
      <equals
        arg1="${deleteOutputDir}"
        arg2="true"
      />
    </condition>


    <antcall target="deletedataextractoutput"/>
    <java
      classname="curam.healthcare.creoledetermination.impl.ExtractProgramGroupRuleObjectsTool"
      classpathref="j.cp"
      failonerror="${java.failonerror}"
      fork="${java.fork}"
      maxmemory="${java.maxmemory}"
      taskname="dataextractor"
    >
      <sysproperty
        key="curam.disable.dynamic.properties"
        value="true"
      />
      <jvmarg value="${java.jvmargs}"/>
      <jvmarg value="-Xms${java.maxmemory}"/>
      <jvmarg value="-Xbootclasspath/p:${jars.allxml}"/>
      <arg line="-outdir ${outputDir}"/>
      <arg line="-determinationID ${programGroupDeterminationID}"/>
      <arg line="${extra.args}"/>
    </java>


    <echo>The output file/s have been created</echo>


  </target>
  <!-- END, CR00437084 -->


  <target
    if="deleteset"
    name="deletedataextractoutput"
  >
    <delete dir="${outputDir}"/>
  </target>


  <!--  *****************  -->
  <!--  ***  THE END  ***  -->
  <!--  *****************  -->


</project>
