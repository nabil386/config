<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2013. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!--

  This is the ant file for running the Rules Data Extractor.

-->
<project name="app_rulesdataextractor" default="extractrulesdata">

  <property name="dir.dataextractor"      value="${dir.bld}/dataextractor"/>
  <property name="dir.dataextractor.blob" value="${dir.dataextractor}/blob"/>

  <!--  *********************************************  -->
  <!--  *** E X T R A C T  R U L E S  D A T A  ******  -->
  <!--  *********************************************  -->
  <target name="creole.extractrulesdata">

    <!-- Start recording progress to a log file -->
    <mkdir dir="${dir.bld.log}"/>

    <!-- Set the starting time stamp for use in file names -->
    <tstamp><format property="tim.start.sort" pattern="yyyyMMddHHmmss"/></tstamp>
    <record name="${dir.bld.log}/ExtractData${tim.start.sort}.log" loglevel="info" />

    <antcall target="dispmsg" inheritAll="false">
      <param name="prm.msg" value="Invoking the Rules Data Extractor"/>
    </antcall>

    <!-- Start the data extraction -->
    <antcall target="extractdatacommon"/>

  </target>

  <target name="extractdatacommon">
  
    <!-- Make the temp directory -->

    <property name="deletedataextractoutputdir" value="true"/>
     <condition property="deleteset" value="true">
      <equals arg1="${deletedataextractoutputdir}" arg2="true"/>
    </condition>

    <antcall target="deletedataextractoutput" />
    <mkdir dir="${dir.dataextractor}" />
    <mkdir dir="${dir.dataextractor.blob}" />

    <java
      classname="curam.creole.storage.database.dataextractor.RuleSetExtractor"
      classpathref="j.cp"
      fork="${java.fork}"
      failonerror="${java.failonerror}"
      maxmemory="${java.maxmemory}"
      taskname="dataextractor"
    >
      <sysproperty key="curam.disable.dynamic.properties"     value="true"/>
      <jvmarg value="${java.jvmargs}" />
      <jvmarg value="-Xms${java.maxmemory}" />
      <jvmarg value="-Xbootclasspath/p:${jars.allxml}" />
      <classpath path="${jar.creole}"/>
      <arg line="-outdir ${dir.bld}/dataextractor" />
      <arg line="-ddldir ${ddldir}"/>
      <arg line="-inedit ${inedit}"/>
      <arg line="-creolerulesetname ${creolerulesetname}" />
    </java>

    <echo>The output file/s have been created in ${dir.dataextractor}</echo>

  </target>

  <target name="deletedataextractoutput"  if="deleteset">
     <delete dir="${dir.dataextractor}"/>
  </target>

  <!--  *****************  -->
  <!--  ***  THE END  ***  -->
  <!--  *****************  -->

</project>

