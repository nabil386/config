<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  Licensed Materials - Property of IBM
  
  PID 5725-H26
 
  Copyright IBM Corporation 2021. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure 
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->

<workflow-process creationDate="20210217T190651" createdBy="admin" category="PC2001" released="true" language-version="1.0" process-version="2" id="1126999418470660">
  <name>AdvancedEvidenceSharingWorkflow</name>
  <process-display-name>
    <localized-text>
      <locale language="en">AdvancedEvidenceSharingWorkflow</locale>
    </localized-text>
  </process-display-name>
  <description>
    <localized-text>
      <locale language="en">This workflow is responsible for controlling the flow of evidence in the system as part of Advanced Evidence Sharing. In particular it controls the flow of evidence from one source case to zero or many target cases on the system. This includes not only the successful sharing onto the target case(s) but also the failure scenarios where the evidence cannot be shared seamlessly. Customers should use the out-of-the-box workflow as is.</locale>
    </localized-text>
  </description>
  <enactment-mappings>
    <mapping>
      <source-attribute name="shareSetID" struct-name="curam.aes.sl.entity.struct.AESShareSetKey" />
      <target-attribute name="shareSetID" wdo-name="AESShareSetKey" />
    </mapping>
  </enactment-mappings>
  <wdos>
    <wdo initialize-attributes="true" is-list-wdo="false">
      <wdo-name>AESShareSetKey</wdo-name>
      <display-name>
        <localized-text>
          <locale language="en">AESShareSet Key</locale>
        </localized-text>
      </display-name>
      <description>
        <localized-text>
          <locale language="en">This workflow data object contains the details required to share the propagated evidence onto the target cases specified by the delivery plans.</locale>
        </localized-text>
      </description>
      <attributes>
        <attribute>
          <attribute-name>shareSetID</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">Advanced Evidence Share Set ID</locale>
            </localized-text>
          </display-name>
          <type>INT64</type>
          <required-at-enactment>true</required-at-enactment>
          <process-output>false</process-output>
        </attribute>
      </attributes>
    </wdo>
    <wdo initialize-attributes="false" is-list-wdo="true">
      <wdo-name>CaseIDList</wdo-name>
      <display-name>
        <localized-text>
          <locale language="en">CaseIDList</locale>
        </localized-text>
      </display-name>
      <attributes>
        <attribute>
          <attribute-name>caseID</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">caseID</locale>
            </localized-text>
          </display-name>
          <type>INT64</type>
          <required-at-enactment>false</required-at-enactment>
          <process-output>false</process-output>
        </attribute>
      </attributes>
    </wdo>
  </wdos>
  <activities>
    <start-process-activity id="1">
      <name>
        <localized-text>
          <locale language="en">Start Process Activity</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">The start process activity</locale>
        </localized-text>
      </description>
      <split type="none">
        <transition-id idref="1" />
      </split>
    </start-process-activity>
    <end-process-activity id="2">
      <name>
        <localized-text>
          <locale language="en">End Process Activity</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">The end process activity</locale>
        </localized-text>
      </description>
      <join type="none" />
    </end-process-activity>
    <automatic-activity category="AC1" id="3">
      <name>
        <localized-text>
          <locale language="en">Initiate Sharing</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">This activity sets the status of the evidence sharing to 'In Progress'.</locale>
        </localized-text>
      </description>
      <join type="none" />
      <split type="none">
        <transition-id idref="3" />
      </split>
      <bpo-mapping method-name="initiateSharing" interface-name="curam.aes.sl.workflow.intf.AdvancedEvidenceSharingPushWorkflow">
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.aes.sl.entity.struct.AESShareSetKey">
              <field name="shareSetID">
                <base-type type="INT64">
                  <wdo-attribute name="shareSetID" wdo-name="AESShareSetKey" />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
      </bpo-mapping>
    </automatic-activity>
    <automatic-activity category="AC1" id="4">
      <name>
        <localized-text>
          <locale language="en">Calculate ShareSet DeliverPlan</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">This activity calculates the delivery plan(s) for the evidence being shared.</locale>
        </localized-text>
      </description>
      <join type="none" />
      <split type="none">
        <transition-id idref="11" />
      </split>
      <bpo-mapping method-name="calculateShareSetDeliverPlan" interface-name="curam.aes.sl.workflow.intf.AdvancedEvidenceSharingPushWorkflow">
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.aes.sl.entity.struct.AESShareSetKey">
              <field name="shareSetID">
                <base-type type="INT64">
                  <wdo-attribute name="shareSetID" wdo-name="AESShareSetKey" />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
      </bpo-mapping>
    </automatic-activity>
    <automatic-activity category="AC1" id="5">
      <name>
        <localized-text>
          <locale language="en">Recommend ShareSet Actions</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">This activity recommends the action that should be taken when delivering shared evidence onto a target case. There are a number of actions that can be recommended, including Insert, Modify, Remove, Ignore and Manual Intervention.</locale>
        </localized-text>
      </description>
      <join type="none" />
      <split type="none">
        <transition-id idref="7" />
      </split>
      <bpo-mapping method-name="recommendShareSetAction" interface-name="curam.aes.sl.workflow.intf.AdvancedEvidenceSharingPushWorkflow">
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.aes.sl.entity.struct.AESShareSetKey">
              <field name="shareSetID">
                <base-type type="INT64">
                  <wdo-attribute name="shareSetID" wdo-name="AESShareSetKey" />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
      </bpo-mapping>
    </automatic-activity>
    <automatic-activity category="AC1" id="6">
      <name>
        <localized-text>
          <locale language="en">Deliver ShareSet</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">This activity delivers the evidence onto a target case in accordance with the action determined for that delivery.</locale>
        </localized-text>
      </description>
      <join type="none" />
      <split type="none">
        <transition-id idref="17" />
      </split>
      <bpo-mapping method-name="deliverShareSet" interface-name="curam.aes.sl.workflow.intf.AdvancedEvidenceSharingPushWorkflow">
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.aes.sl.entity.struct.AESShareSetKey">
              <field name="shareSetID">
                <base-type type="INT64">
                  <wdo-attribute name="shareSetID" wdo-name="AESShareSetKey" />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
      </bpo-mapping>
    </automatic-activity>
    <automatic-activity category="AC1" id="7">
      <name>
        <localized-text>
          <locale language="en">Activate Target Case Evidence</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">This activity activates the shared evidence on the specided target cases as per the sharing configuration.</locale>
        </localized-text>
      </description>
      <join type="none" />
      <split type="none">
        <transition-id idref="14" />
      </split>
      <bpo-mapping method-name="activateTargetCase" interface-name="curam.aes.sl.workflow.intf.AdvancedEvidenceSharingPushWorkflow">
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.aes.sl.workflow.struct.AESCaseID">
              <field name="caseid">
                <base-type type="INT64">
                  <wdo-attribute name="caseID" wdo-name="CaseIDList[Context_Loop.loopCount]" />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
          <formal-parameter index="1">
            <struct type="curam.aes.sl.entity.struct.AESShareSetKey">
              <field name="shareSetID">
                <base-type type="INT64">
                  <wdo-attribute name="shareSetID" wdo-name="AESShareSetKey" />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
      </bpo-mapping>
    </automatic-activity>
    <automatic-activity category="AC1" id="8">
      <name>
        <localized-text>
          <locale language="en">Complete ShareSet</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">This activity is responsible for marking a particular share set of evidence as 'Completed'. In the case of failures occurring during the workflow, the share set will be updated to 'Complete With Resilience' and the appropriate notification will be raised.</locale>
        </localized-text>
      </description>
      <join type="none" />
      <split type="none">
        <transition-id idref="16" />
      </split>
      <bpo-mapping method-name="completeShareSet" interface-name="curam.aes.sl.workflow.intf.AdvancedEvidenceSharingPushWorkflow">
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.aes.sl.entity.struct.AESShareSetKey">
              <field name="shareSetID">
                <base-type type="INT64">
                  <wdo-attribute name="shareSetID" wdo-name="AESShareSetKey" />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
      </bpo-mapping>
    </automatic-activity>
    <automatic-activity category="AC1" id="9">
      <name>
        <localized-text>
          <locale language="en">Callback</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">This activity process triggers the callback mechanism. An example of where a callback mechanism is used is during the authorization process. Authorization has a dependency on evidence being shared from the application case to the ongoing case. Once all the evidence has been shared onto the target (ongoing) case, the application case needs to be notified via the callback mechanism. In the authorization process, the callback is used to update the status of the application case to 'Closed'.</locale>
        </localized-text>
      </description>
      <join type="none" />
      <split type="none">
        <transition-id idref="15" />
      </split>
      <bpo-mapping method-name="callback" interface-name="curam.aes.sl.workflow.intf.AdvancedEvidenceSharingPushWorkflow">
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.aes.sl.entity.struct.AESShareSetKey">
              <field name="shareSetID">
                <base-type type="INT64">
                  <wdo-attribute name="shareSetID" wdo-name="AESShareSetKey" />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
      </bpo-mapping>
    </automatic-activity>
    <loop-begin-activity category="AC1" id="10">
      <name>
        <localized-text>
          <locale language="en">LoopOverCase [Begin]</locale>
        </localized-text>
      </name>
      <join type="none" />
      <split type="none">
        <transition-id idref="20" />
      </split>
      <loop-type name="while" />
      <condition>
        <expression conjunction="and" data-item-rhs="CaseIDList.size()" operation="&lt;" data-item-lhs="Context_Loop.loopCount" id="1" />
      </condition>
      <block-endpoint-ref activity-id="11" />
    </loop-begin-activity>
    <loop-end-activity category="AC1" id="11">
      <name>
        <localized-text>
          <locale language="en">LoopOverCase [End]</locale>
        </localized-text>
      </name>
      <join type="none" />
      <split type="none">
        <transition-id idref="19" />
      </split>
      <block-endpoint-ref activity-id="10" />
    </loop-end-activity>
    <automatic-activity category="AC1" id="12">
      <name>
        <localized-text>
          <locale language="en">getCaseList</locale>
        </localized-text>
      </name>
      <join type="none" />
      <split type="none">
        <transition-id idref="21" />
      </split>
      <bpo-mapping method-name="getCaseList" interface-name="curam.aes.sl.workflow.intf.AdvancedEvidenceSharingPushWorkflow">
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.aes.sl.entity.struct.AESShareSetKey">
              <field name="shareSetID">
                <base-type type="INT64">
                  <wdo-attribute name="shareSetID" wdo-name="AESShareSetKey" />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
        <return>
          <struct>
            <field name="dtls">
              <struct>
                <field name="caseid">
                  <base-type>
                    <wdo-attribute name="caseID" wdo-name="CaseIDList" />
                  </base-type>
                </field>
              </struct>
            </field>
          </struct>
        </return>
      </bpo-mapping>
    </automatic-activity>
  </activities>
  <transitions>
    <transition to-activity-idref="3" from-activity-idref="1" id="1" />
    <transition to-activity-idref="4" from-activity-idref="3" id="3" />
    <transition to-activity-idref="5" from-activity-idref="4" id="11" />
    <transition to-activity-idref="6" from-activity-idref="5" id="18" />
    <transition to-activity-idref="12" from-activity-idref="6" id="17" />
    <transition to-activity-idref="11" from-activity-idref="7" id="14" />
    <transition to-activity-idref="9" from-activity-idref="8" id="16" />
    <transition to-activity-idref="2" from-activity-idref="9" id="15" />
    <transition to-activity-idref="8" from-activity-idref="11" id="19" />
    <transition to-activity-idref="7" from-activity-idref="10" id="20" />
    <transition to-activity-idref="10" from-activity-idref="12" id="21" />
  </transitions>
</workflow-process>

