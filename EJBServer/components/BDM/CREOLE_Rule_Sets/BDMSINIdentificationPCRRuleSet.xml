<?xml version="1.0" encoding="UTF-8"?>

<RuleSet name="BDMSINIdentificationPCRRuleSet"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">


	<Class extends="AbstractPCR" extendsRuleSet="PCRRuleSet"
		name="BDMSINIdentificationPCR">
		<Annotations>
			<Label label-id="BDMSINIdentificationPCR.label.1"
				name="BDM SIN Identification Integrity Rules PCR Rules Class" />
		</Annotations>
		<Attribute name="caseID">
			<type>
				<javaclass name="Number" />
			</type>
			<derivation>
				<specified />
			</derivation>
		</Attribute>

		<Attribute name="priorityRate">
			<type>
				<javaclass name="Number" />
			</type>
			<derivation>
				<null />
			</derivation>
		</Attribute>

		<Attribute name="priorityReason">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<null />
			</derivation>
		</Attribute>

		<Attribute name="complexityRate">
			<type>
				<javaclass name="Number" />
			</type>
			<derivation>
				<null />
			</derivation>
		</Attribute>

		<Attribute name="complexityReason">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<null />
			</derivation>
		</Attribute>

		<Attribute name="riskRate">
			<type>
				<javaclass name="Number" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Number" />
					</type>
					<when>
						<condition>
							<reference attribute="isRiskConditionMet" />
						</condition>
						<value>
							<Number value="2" />
						</value>
					</when>
					<otherwise>
						<value>
							<Number value="0" />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute name="riskReason">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.creole.value.Message" />
					</type>
					<when>
						<condition>
							<reference attribute="isRiskConditionMet" />
						</condition>
						<value>
							<XmlMessage>SIN Identification failing SIN Integrity Limit Check</XmlMessage>
						</value>
					</when>
					<otherwise>
						<value>
							<XmlMessage>SIN Identification passing SIN Integrity Limit Check</XmlMessage>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute name="isRiskConditionMet">
			<type>
				<javaclass name="Boolean" />
			</type>
			<derivation>
				<true/>
			</derivation>
		</Attribute>
		
		<Attribute name="checkRiskCondition">
			<Annotations>
			  <Label label-id="BDMPDCIdentificationDeterminator.label.2" name="BDM SIN Integrity Rules - IntegrityRule0005 - SIN Rules"/>
			</Annotations>
			<type>
				<javaclass name="Boolean"/>
			</type>
			<derivation>
				<true/>				
			</derivation>
		</Attribute>

		<Attribute name="bdmSINIdentificationStatusRecord">
			<type>
				<ruleclass name="BDMSINIdentificationStatus"
					ruleset="BDMSINIdentificationStatusDataRuleSet" />
			</type>
			<derivation>
				<singleitem onMultiple="returnFirst" onEmpty="returnNull">
					<readall ruleclass="BDMSINIdentificationStatus"
						ruleset="BDMSINIdentificationStatusDataRuleSet">
						<match retrievedattribute="caseID">
							<reference attribute="caseID" />
						</match>
					</readall>
				</singleitem>
			</derivation>
		</Attribute>

		<Attribute name="identificationEvidenceRecord">
			<type>
				<ruleclass name="PDCIdentification"
					ruleset="PDCIdentificationDataRuleSet" />
			</type>
			<derivation>
				<singleitem onMultiple="returnFirst" onEmpty="returnNull">
					<readall ruleclass="PDCIdentification"
						ruleset="PDCIdentificationDataRuleSet">
						<match retrievedattribute="caseID">
							<reference attribute="caseID" />
						</match>
					</readall>
				</singleitem>
	
			</derivation>
		</Attribute>

	</Class>

</RuleSet>
