<?xml version="1.0" encoding="UTF-8"?>
  
<ieg-script xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="ieg-schema.xsd"
	finish-page="cw/FinishLifeEventScript.jspx"
	quit-page="cw/QuitLifeEventScript.jspx"		
	show-sections="true"
	show-progress-bar="true"
	validate-save-and-exit="false"
	config-properties="bdm-app-config"
	>
		
	<identifier id="BDMLifeEventIncarcerationUpdate" scriptversionnumber="V1" type="LifeEvent" />
	
	 <section>
		<title id="SelectChangeType.SectionTitle"><![CDATA[Select type of change]]></title>
		<question-page 
			id="SelectChangeType"
			entity="Person"
			progress="0" 
			show-back-button="false"
			show-exit-button="true" 
			show-save-exit-button="false"
			>
			<description id="MandatoryFieldsDescription">
				<![CDATA[All fields are mandatory unless specified as optional.]]>
			</description>

			<validation expression="UpdateIncarcerationEntity(Person.incarcerationChangeType)">
				     <message id="SelectChangeType.Validation"><![CDATA[Please select a period of incarceration to update or remove]]></message>
			</validation>
			<cluster >
				<question id="incarcerationChangeType" mandatory="true">
					<label id="SelectChangeType.SelectChangeType"> <![CDATA[What changes would you like to make to the incarceration period?]]></label>
							<layout>
								<type>radio</type>
							</layout>
				</question>
			</cluster>	
			<condition expression="isNotNull(Person.incarcerationChangeType) and not(Person.incarcerationChangeType==&quot;BDMICT01&quot;)">
				<cluster>
					<list-question entity="Incarceration" 
						id="incarcerationSelected"
						single-select="true" 
						mandatory="true"
						criteria="instName!=&quot;&quot;">			
						<label id="SelectChangeType.IncarcerationPeriod"><![CDATA[Select the period of incarceration that the change applies to:]]></label>
	              		<item-label><label-element attribute-id="incarcerationPeriodDesc"/></item-label>
	            	</list-question>
	            </cluster>
            </condition>
		</question-page>
	</section>
	
	<section>
		<title id="ChangeInformation.SectionTitle"><![CDATA[Change information]]></title>
		<condition expression="not(Person.incarcerationChangeType==&quot;BDMICT03&quot;) and Person.selectedIncarcerationID!=&quot;&quot;">
				<question-page id="ChangeInformation"
					entity="Person"
					progress="30" 
					show-back-button="true"
					show-exit-button="true" 
					show-save-exit-button="false"
					>				
					<description id="MandatoryFieldsDescription">
						<![CDATA[All fields are mandatory unless specified as optional.]]>
					</description> 
					<validation expression="not(isNotNull(Incarceration.instName)) or ValidateInstitutionNameLength(Incarceration.instName, &quot;1&quot;, &quot;100&quot;)">
						<message id="ChangeInformation.InstitutionName.Validation"><![CDATA[Institution name must only contain alphabets and must be between 1 and 100 characters long.]]></message>
					</validation>
					<validation expression="ValidatePeriodNotOverlapping(Incarceration.startDateInca,Incarceration.endDateInca)">
						<message id="ChangeInformation.OverlappingDates.Validation"><![CDATA[The start date and end date can't overlap with an existing period of incarceration.]]></message>
					</validation>
					<validation expression="not(isNotNull(Incarceration.startDateInca)) or validateStartDateBeforeDOB(Incarceration.startDateInca, Person.dateOfBirth)">
						<message id="ChangeInformation.StartDateBeforeDOB.Validation"><![CDATA[Start date cannot be earlier than your date of birth.]]></message>
					</validation>
					<validation expression="not(isNotNull(Incarceration.startDateInca)) or ValidateStartDateAfterOneHundredDOB(Incarceration.startDateInca, Person.dateOfBirth)">
						<message id="ChangeInformation.StartDateGreaterThan100Birthday.Validation"><![CDATA[Start date cannot be greater than 100th birthday.]]></message>
					</validation>
					<!-- <validation expression="not(isNotNull(Incarceration.startDateInca)) or ValidateFutureDate(Incarceration.startDateInca)">
						<message id="ChangeInformation.NoFutureDate.Validation"><![CDATA[Start date can not be a future date.]]></message>
					</validation> -->
					<validation expression="ValidateEndDateNotEarlierThanStartDate(Incarceration.startDateInca,Incarceration.endDateInca)">
						<message id="ChangeInformation.EndDate.Validation"><![CDATA[Incarceration end date can't be earlier than the incarceration start date.]]></message>
					</validation>
					<validation expression="ValidateDatastoreIncarcerationValueChanged(Incarceration.instName,Incarceration.startDateInca,Incarceration.endDateInca)">
						<message id="ChangeInformation.FieldValueChanges.Validation"><![CDATA[Nothing has changed. Please make a change to proceed.]]></message>
					</validation>
					<cluster entity="Incarceration"   criteria="curamDataStoreUniqueID!=&quot;&quot;"  >
							<question id="instName"  mandatory="true" >
								<label id="ChangeInformation.NameOfInstitution">
									<![CDATA[Name of institution]]>
								</label>
							</question>
							<question id="startDateInca"  mandatory="true" >
									<label id="ChangeInformation.StartDate">
										<![CDATA[Incarceration start date]]>
									</label>
									<layout>
                    					<type>date-picker</type>
                    					<class-names>wds-js-input-mask-yyyy-mm-dd</class-names>
                   					 </layout>
								</question>
								<question id="endDateInca">
									<label id="ChangeInformation.EndDate">
										<![CDATA[Incarceration end date]]>
									</label>
									<layout>
                    					<type>date-picker</type>
                    					<class-names>wds-js-input-mask-yyyy-mm-dd</class-names>
                   					 </layout>
							</question>
					</cluster>
				</question-page>
		</condition>
	</section>
	<section>
		<title id="SummaryPage.SectionTitle"><![CDATA[Summary of changes]]></title>
		<summary-page id="SummaryPage"  
			entity="Person"
			show-back-button="true"
			show-exit-button="true" 
			show-save-exit-button="false"
			>
			<cluster entity="Person" >
				<title id="SummaryPage.PageTitle"><![CDATA[Incarceration information]]></title>
		        <edit-link start-page="ChangeInformation" />
				<question id="incarcerationChangeType" ><label id="SummaryPage.TypeOfChange"><![CDATA[What changes would you like to make to the incarceration period?]]></label></question>
			</cluster>
			<condition expression="Person.incarcerationChangeType==&quot;BDMICT03&quot; and Person.selectedIncarcerationID!=&quot;&quot;">
				<cluster entity="Incarceration"   criteria="curamDataStoreUniqueID!=&quot;&quot;">
					<question id="incarcerationPeriodDesc" ><label id="SummaryPage.PeriodDesc"><![CDATA[Incarceration period]]></label></question>
				</cluster>
			</condition>
			<condition expression="not(Person.incarcerationChangeType==&quot;BDMICT03&quot;) and Person.selectedIncarcerationID!=&quot;&quot;">
				<cluster entity="Incarceration" criteria="curamDataStoreUniqueID!=&quot;&quot;">	
		            <layout><type>flow</type><num-cols>3</num-cols></layout>
					<question id="instName" ><label id="SummaryPage.NameOfInstitution"><![CDATA[Name of institution]]></label></question>
					<question id="startDateInca" ><label id="SummaryPage.StartDate"><![CDATA[Incarceration start date]]></label></question>
					<question id="endDateInca"><label id="SummaryPage.EndDate"><![CDATA[Incarceration end date]]></label></question>
				</cluster>
			</condition>
			</summary-page>
	</section> 
	<!-- Attestation-->
	<ieg-sub-script>
		<identifier id="BDMStimulusApplicationSubmission" scriptversionnumber="V1" type="Sub"/>
	</ieg-sub-script>
	<!-- End Attestation-->
	
</ieg-script>
	