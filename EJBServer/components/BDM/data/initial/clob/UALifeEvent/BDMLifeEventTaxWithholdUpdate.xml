<?xml version="1.0" encoding="UTF-8"?>
<ieg-script
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="ieg-schema.xsd"
	finish-page="cw/FinishLifeEventScript.jspx"
	quit-page="cw/QuitLifeEventScript.jspx"		
	show-sections="true"
	show-progress-bar="true"
	validate-save-and-exit="false"
	config-properties="bdm-app-config"
	>

	<identifier id="BDMLifeEventTaxWithholdUpdate" scriptversionnumber="V1" type="LifeEvent" />
	
	<!-- BEGIN Tax Change pages -->
	<section>
		<title id="ProgramInformation.Title"><![CDATA[Select program]]></title>
		<icon enabled-image="sample_about_you" current-image="sample_about_you" />

		<!-- BEGIN Program Selection page -->
		<question-page id="ProgramInformation" 
			progress="0" 
			read-only="false" 
			set-focus="true" 
			show-back-button="false"
			show-exit-button="true"
			show-next-button="true"
			show-person-tabs="false" 
			show-save-exit-button="false"
			entity="Person">
			<description id="MandatoryFieldsDescription"><![CDATA[All fields are mandatory unless specified as optional.]]></description>
			<validation expression="not(isNotNull(Person.activePrograms)) or Person.activePrograms"><message id="ProgramInformation.validation"><![CDATA[You cannot proceed without an active benefit that allows for additional tax to be deducted.  Please click 'Delete and exit' to return to your Profile.]]></message></validation>
			<condition expression="Person.activePrograms==true">
				<cluster entity="Person">
					<list-question entity="Programs"
						id="activeProgramSelected"
						single-select="true"
						mandatory="true"
						criteria="activeProgramName!=&quot;&quot;">
						<label id="ProgramInformation.activeProgram.Label"><![CDATA[What program would you like to apply the change to?]]></label>
	              		<item-label><label-element attribute-id="activeProgramName"/></item-label>
	            	</list-question>
	            </cluster>
			</condition>
			<condition expression="Person.activePrograms==false">
				<cluster entity="Person">
					<display-text id="ProgramInformation.noActiveProgram"><![CDATA[You do not have any active benefits at this time. Please click 'Delete and exit' to return to your Profile.]]></display-text>
	            </cluster>
			</condition>
		</question-page>
	</section>
	<!-- END Program Selection page -->
	
	<!-- Begin Type Of Change page -->
	<section>
		<title id="TypeOfChange.Title"><![CDATA[Select type of change]]></title>
		<condition expression="Person.activeTaxWithholds==true">
			<question-page id="TypeOfChange" 
				progress="0" 
				read-only="false" 
				set-focus="true" 
				show-back-button="true"
				show-exit-button="true"
				show-next-button="true"
				show-person-tabs="false" 
				show-save-exit-button="false"
				entity="Person">
				<description id="MandatoryFieldsDescription"><![CDATA[All fields are mandatory unless specified as optional.]]></description>
				<cluster entity="Person">							
					<question id="taxWithholdChangeType" mandatory="true">
						<label id="TypeOfChange.taxWithholdChangeType"><![CDATA[What changes would you like to make to your additional tax deduction?]]></label>
						<layout><type>radio</type></layout>
					</question>
	            </cluster>
	            <condition expression="Person.taxWithholdChangeType!=&quot;BDMTWCT03&quot;">
					<cluster entity="Person">
						<list-question entity="TaxInfo"
							id="taxWithholdSelected"
							single-select="true"
							mandatory="true"
							criteria="taxWithholdPeriodDesc!=&quot;&quot;">
							<label id="ProgramInformation.taxWithholdSelected"><![CDATA[Select the additional tax deduction that the change applies to:]]></label>
		              		<item-label><label-element attribute-id="taxWithholdPeriodDesc"/></item-label>
		            	</list-question>
		            </cluster>
				</condition>
			</question-page>
		</condition>
	</section>
	<!-- END Type Of Change page -->
	<!-- Start ADO-13709 VTW Evidence Mapping configuration  -->
	<callout expression="SetVTWPersonID()" id="TaxInfo.taxPersonID"/>
	<!-- End ADO-13709 VTW Evidence Mapping configuration  -->
	
	<!-- Begin Tax Information page -->
	<section>
		<title id="TaxInformation.Title"><![CDATA[Tax withhold details]]></title>
		<condition expression="Person.activeTaxWithholds==false or Person.taxWithholdChangeType==&quot;BDMTWCT01&quot;">
			<question-page id="TaxInformation" 
				progress="0" 
				read-only="false" 
				set-focus="true" 
				show-back-button="true"
				show-exit-button="true"
				show-next-button="true"
				show-person-tabs="false" 
				show-save-exit-button="false"
				entity="Person">
				<description id="MandatoryFieldsDescription"><![CDATA[All fields are mandatory unless specified as optional.]]></description>
				<set-attribute expression="true" id="TaxInfo.taxWithholdSelected"/>
				<validation expression="isNotNull(TaxInfo.changeEffectiveDate) or not(isNotNull(TaxInfo.startDate)) or validatePastDate(TaxInfo.startDate)"><message id="TaxInformation.startDate.NoFutureDate.Validation"><![CDATA[Start date can not be in the past.]]></message></validation>
				<validation expression="isNotNull(TaxInfo.changeEffectiveDate) or not(isNotNull(TaxInfo.startDate)) or ValidateEndDateNotEarlierThanStartDate(TaxInfo.startDate,TaxInfo.endDate)"><message id="TaxInformation.startDate.Validation"><![CDATA[End date can't be earlier than the start date.]]></message></validation>
				<validation expression="isNotNull(TaxInfo.changeEffectiveDate) or not(isNotNull(TaxInfo.startDate)) or ValidateEndDateNotSameAsStartDate(TaxInfo.startDate,TaxInfo.endDate)"><message id="TaxInformation.changeEffectiveDateTwo.Validation"><![CDATA[End date can't be the same as the effective change date.]]></message></validation>
				<validation expression="isNotNull(TaxInfo.changeEffectiveDate) or not(isNotNull(TaxInfo.startDate)) or ValidatePeriodNotOverlapping(TaxInfo.startDate,TaxInfo.endDate)"><message id="TaxInformation.startDate.OverlappingDates.Validation"><![CDATA[The start date and end date can't overlap with an existing period of a tax withhold.]]></message></validation>
				<validation expression="not(isNotNull(TaxInfo.changeEffectiveDate)) or validatePastDate(TaxInfo.changeEffectiveDate)"><message id="TaxInformation.changeEffectiveDate.NoFutureDate.Validation"><![CDATA[Change effective date can not be in the past.]]></message></validation>
				<validation expression="not(isNotNull(TaxInfo.changeEffectiveDate)) or ValidateEndDateNotEarlierThanStartDate(TaxInfo.changeEffectiveDate,TaxInfo.endDate)"><message id="TaxInformation.changeEffectiveDate.Validation"><![CDATA[End date can't be earlier than the effective change date.]]></message></validation>
				<validation expression="not(isNotNull(TaxInfo.changeEffectiveDate)) or ValidateEndDateNotSameAsStartDate(TaxInfo.changeEffectiveDate,TaxInfo.endDate)"><message id="TaxInformation.changeEffectiveDateTwo.Validation"><![CDATA[End date can't be the same as the effective change date.]]></message></validation>
				<validation expression="not(isNotNull(TaxInfo.changeEffectiveDate)) or ValidateTaxWithholdPeriodNotOverlapping(TaxInfo.changeEffectiveDate,TaxInfo.endDate)"><message id="TaxInformation.changeEffectiveDate.OverlappingDates.Validation"><![CDATA[The effective change date and end date can't overlap with an existing period of a tax withhold.]]></message></validation>
				<validation expression="ValidateDatastoreTaxInfoValueChanged(TaxInfo.dedMethod,TaxInfo.dollarAmount,TaxInfo.dollarPerct,TaxInfo.startDate,TaxInfo.changeEffectiveDate,TaxInfo.endDate)"><message id="TaxInformation.FieldValueChanges.Validation"><![CDATA[Nothing has changed. Please make a change to proceed.]]></message></validation>
				<condition expression="Person.activePrograms==true">
					<cluster entity="Person">
						<list-question entity="Programs" id="activeProgramSelected" single-select="false" mandatory="true" read-only-expression="true" criteria="activeProgramName!=&quot;&quot;">
							<label id="TaxInformation.programSelected"><![CDATA[Program selected to apply the tax withhold:]]></label>
		              		<item-label><label-element attribute-id="activeProgramName"/></item-label>
		            	</list-question>
		            </cluster>
				</condition>
				<cluster entity="TaxInfo" criteria="taxWithholdSelected==true">
					<question id="dedMethod" mandatory="true" read-only-expression="Person.taxWithholdChangeType!=&quot;BDMTWCT03&quot;">
						<label id="TaxInformation.dedMethod"><![CDATA[How would you like to specify the amount of additional federal income tax to deduct?]]></label>
						<layout><type>radio</type></layout>
					</question>
				</cluster>
				<condition expression="TaxInfo.dedMethod==&quot;BDMTDM8000&quot;">
					<cluster entity="TaxInfo" criteria="taxWithholdSelected==true">
						<question id="dollarAmount" mandatory="true"><label id="TaxInformation.dollarAmount"><![CDATA[Indicate a dollar amount you want us to deduct (for example: 100.00).]]></label></question>
						<layout><mask-format><![CDATA[{"numeral": "true"}]]></mask-format></layout>
					</cluster>
				</condition>
				<condition expression="TaxInfo.dedMethod==&quot;BDMTDM8001&quot;">
					<cluster entity="TaxInfo" criteria="taxWithholdSelected==true">
						<question id="dollarPerct" mandatory="true"><label id="TaxInformation.dollarPerct"><![CDATA[Indicate a percentage you want us to deduct (for example: 20).]]></label>
							<hint-text id="TaxInformation.dollarPerct.hint"><![CDATA[Please enter a number between 1 and 100.]]></hint-text>
							<layout><class-names>wds-js-input-mask-percentage</class-names></layout>
						</question>
					</cluster>
				</condition>
				<condition expression="Person.activeTaxWithholds==false">
					<cluster entity="TaxInfo" criteria="taxWithholdSelected==true">
						<question id="startDate" mandatory="true">
							<label id="TaxInformation.startDate"><![CDATA[What date would you like the deduction to start?]]></label>
							<hint-text id="TaxInformation.startDate.hint"><![CDATA[Deductions will commence from the first payment processed after the date selected (YYYY/MM/DD)]]></hint-text>
							<layout><type>date-picker</type></layout>
						</question>
					</cluster>
				</condition>
				<condition expression="Person.activeTaxWithholds==true">
					<cluster entity="TaxInfo" criteria="taxWithholdSelected==true">
						<question id="changeEffectiveDate" mandatory="true">
							<label id="TaxInformation.changeEffectiveDate"><![CDATA[What date would you like the change to come into effect?]]></label>
							<hint-text id="TaxInformation.changeEffectiveDate.hint"><![CDATA[Deductions will commence from the first payment processed after the date selected (YYYY/MM/DD)]]></hint-text>
							<layout><type>date-picker</type></layout>
						</question>
					</cluster>
				</condition>
				<cluster entity="TaxInfo" criteria="taxWithholdSelected==true">
					<question id="endDate" mandatory="false">
						<label id="TaxInformation.endDate"><![CDATA[What date would you like the deduction to end?]]></label>
						<hint-text id="TaxInformation.endDate.hint"><![CDATA[Deductions will cease as of the first payment processed after the date selected (YYYY/MM/DD)]]></hint-text>
						<layout><type>date-picker</type></layout>
					</question>
				</cluster>
			</question-page>
		</condition>
	</section>
	<!-- End Tax Information page -->
	
	<!-- BEGIN SUMMARY PAGE -->
	<section>
		<title id="Summary.Title"><![CDATA[Summary of changes]]></title>
		<summary-page id="SummaryPage" 
			show-back-button="true"
			entity="Person" 
			show-exit-button="true" 
			show-save-exit-button="false"
			>
			<next-button-label id="NextButton.Label"><![CDATA[Submit]]></next-button-label>
			<!-- BEGIN SUMMARY -->
			<cluster entity="Person" grouping-id="1">
				<!-- edit link only shows when having cluster title  -->
				<title id="SummaryPage.Title"><![CDATA[Additional tax information]]></title>
				<edit-link start-page="TaxInformation" />
				<list-question entity="Programs"
					id="activeProgramSelected"
					criteria="activeProgramName!=&quot;&quot;">
					<label id="ProgramInformation.activeProgram.Label"><![CDATA[What program would you like to apply the change to?]]></label>
              		<item-label><label-element attribute-id="activeProgramName"/></item-label>
            	</list-question>
            </cluster>
            <cluster entity="Person" grouping-id="1">
            	<question id="taxWithholdChangeType"><label id="TypeOfChange.taxWithholdChangeType"><![CDATA[What changes would you like to make to your additional tax deduction?]]></label></question>
            </cluster>
            <cluster entity="TaxInfo" criteria="taxWithholdSelected==true">
            	<question id="dedMethod"><label id="TaxInformation.dedMethod"><![CDATA[How would you like to specify the amount of additional federal income tax to deduct?]]></label></question>
        	</cluster>
            <condition expression="TaxInfo.dedMethod==&quot;BDMTDM8000&quot;">
				<cluster entity="TaxInfo" criteria="taxWithholdSelected==true"><question id="dollarAmount"><label id="TaxInformation.dollarAmount"><![CDATA[Indicate a dollar amount you want us to deduct (for example: 100.00).]]></label></question></cluster>
			</condition>
			<condition expression="TaxInfo.dedMethod==&quot;BDMTDM8001&quot;">
				<cluster entity="TaxInfo" criteria="taxWithholdSelected==true">
					<question id="dollarPerct">
						<label id="TaxInformation.dollarPerct"><![CDATA[Indicate a percentage you want us to deduct (for example: 20).]]></label>
						<layout><class-names>wds-js-input-mask-percentage</class-names></layout>
					</question>
				</cluster>
			</condition>
			<condition expression="Person.activeTaxWithholds==false">
				<cluster entity="TaxInfo" criteria="taxWithholdSelected==true"><question id="startDate"><label id="TaxInformation.startDate"><![CDATA[What date would you like the deduction to start?]]></label></question></cluster>
			</condition>
			<condition expression="Person.taxWithholdChangeType==&quot;BDMTWCT01&quot;">
				<cluster entity="TaxInfo" criteria="taxWithholdSelected==true"><question id="changeEffectiveDate"><label id="TaxInformation.changeEffectiveDate"><![CDATA[What date would you like the change to come into effect?]]></label></question></cluster>
			</condition>
			<condition expression="Person.taxWithholdChangeType==&quot;BDMTWCT02&quot;">
				<cluster entity="Person"><question id="today"><label id="TaxInformation.changeEffectiveDate"><![CDATA[What date would you like the change to come into effect?]]></label></question></cluster>
			</condition>
			<condition expression="Person.taxWithholdChangeType!=&quot;BDMTWCT02&quot;">
				<cluster entity="TaxInfo" criteria="taxWithholdSelected==true"><question id="endDate"><label id="TaxInformation.endDate"><![CDATA[What date would you like the deduction to end?]]></label></question></cluster>
			</condition>
			<condition expression="Person.taxWithholdChangeType==&quot;BDMTWCT02&quot;">
				<cluster entity="Person"><question id="today"><label id="TaxInformation.endDate"><![CDATA[What date would you like the deduction to end?]]></label></question></cluster>
			</condition>
		</summary-page>
	</section>
	<!-- END SUMMARY PAGE -->
			
</ieg-script>