<?xml version="1.0" encoding="UTF-8"?>

<ieg-script
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="ieg-schema.xsd"
finish-page="CommonIntake_finishInternalIntakeScript" 
	quit-page="CommonIntake_quitInternalIntakeScript"
	show-sections="true" show-progress-bar="true"
	validate-save-and-exit="false">


	<identifier id="BDMOASGISCombinedApplicationAP"
		scriptversionnumber="V1" type="Intake" />


	<section>
		<title id="PaymentInformation.Title">
			<![CDATA[Payment Information]]>
		</title>
		<icon enabled-image="sample_about_you"
			current-image="sample_about_you" />

		<condition expression="Application.applicationForm==&quot;AF7&quot;">
		<question-page id="PaymentInformation" 
			progress="0" 
			read-only="false" 
			set-focus="true" 
			show-back-button="true"
			show-exit-button="true"
			show-next-button="true"
			show-person-tabs="false" 
			show-save-exit-button="true"
			entity="Person"
 			criteria="isPrimaryParticipant==true"
 			>
			
			<title id="PaymentInfoPage.Title">Payment Information</title>
						
			<description id="MandatoryFieldsDescription">
				<![CDATA[All fields are mandatory unless specified as optional.]]>
			</description>
			<cluster>
			<display-text>
			<![CDATA[]]></display-text>
			</cluster>
			<set-attribute id="Payment.sortCode" expression="concatenate(Payment.bankInstNum, Payment.bankBranchNum)"/>
			
			<validation expression="ValidateBankBranch(Payment.bankInstNum, Payment.bankBranchNum)">
				<message id="BankBranch.Validation">Invalid combination Transit/branch number and Financial institution number.</message>
			</validation>
			<validation expression="not(isNotNull(Payment.bankBranchNum)) or validateOnlyNumeric(Payment.bankBranchNum)">
      			<message id="Bank.Transit.validation"><![CDATA[Transit/branch number must be numeric.]]></message>
    		</validation>
    		<validation expression="not(isNotNull(Payment.bankInstNum)) or validateOnlyNumeric(Payment.bankInstNum)">
      			<message id="Bank.Fin.validation"><![CDATA[Financial institution number must be numeric.]]></message>
    		</validation>
    		<validation expression="not(isNotNull(Payment.accountNumber)) or validateOnlyNumeric(Payment.accountNumber)">
      			<message id="Bank.AccountNumber.validation"><![CDATA[Account number must be numeric]]></message>
    		</validation>
			
			<cluster entity="Person">
				
				<question control-question="false"
					id="preferredPaymentMethod" mandatory="true" multi-select="false" >
					<label id="Bank.preferredPaymentMethod.Label">How would the applicant like to receive their payments?	</label>
					<layout>
						<type>radio</type>
					</layout>
				</question>

			</cluster>
			<condition expression="Person.preferredPaymentMethod==&quot;EFT&quot; and Person.hasActiveBankAccounts">
				<cluster entity="Payment">				
					<question control-question="false"
						id="preferredBankAccount" mandatory="true" multi-select="false"
						show-field-help="true">

						<label id="Bank.preferredBankAccount.Label">Did the applicant indicate they would like to use one of these existing direct deposit accounts or did they provide new direct deposit information?	</label>

						<layout>
							<type>radio</type>
						</layout>
					</question>

				</cluster>
			</condition>
			<condition expression="Payment.preferredBankAccount==&quot;BDMBAC8001&quot; and Person.hasActiveBankAccounts">
				<cluster entity="Person">
					<list-question entity="PaymentBanks" 
								id="preferredBankForProgram" 
								single-select="true" 
								mandatory="true" 
								criteria="bankAccountNameAndNumber!=&quot;&quot;" 
								display="dropdown">
						<label id="Bank.preferredBankForProgram.Label"><![CDATA[Which bank account would you like to use?]]></label>
	              		<item-label><label-element attribute-id="bankAccountNameAndNumber"/></item-label>
	            	</list-question>
	            </cluster>
			</condition>
			<condition expression="(Person.preferredPaymentMethod==&quot;EFT&quot; and Person.hasActiveBankAccounts==false)  or Payment.preferredBankAccount==&quot;BDMBAC8000&quot;">
				<cluster entity="Payment">
					<title id="Cluster.Title.AddNewDDAccount">Add new Direct Deposit Account</title>	
					<help-text id="PaymentInfoCluster.BankInfo.Help"/>									
					<question control-question="false" id="bankAccountName"
						mandatory="true" multi-select="false" show-field-help="false">
						<label id="Bank.bankAccountName.Label"><![CDATA[Name(s) on the account]]></label>
						<layout>
							<width>70</width>							
						</layout>						
					</question>
					<question control-question="false" id="bankBranchNum"
						mandatory="true" multi-select="false" show-field-help="false">
						<label id="Bank.bankBranchNum.Label"><![CDATA[Branch Transit Number]]></label>
						<layout>
							<width>50</width>							
						</layout>						
					</question>
					<question control-question="false" id="bankInstNum"
						mandatory="true" multi-select="false" show-field-help="false">
						<label id="Bank.BankInstNum.Label"><![CDATA[Financial Institution Number]]></label>
						<layout>
							<width>50</width>							
						</layout>						
					</question>
					<question control-question="false" id="accountNumber"
						mandatory="true" multi-select="false" show-field-help="false">
						<label id="Bank.account.Label"><![CDATA[Account Number]]></label>
						<layout>
							<width>50</width>							
						</layout>						
					</question>
				</cluster>
			</condition>
		</question-page>
		</condition>
		
		<condition expression="Person.residentialCountry==&quot;CA&quot; and Application.applicationForm==&quot;AF7&quot;">		

			<question-page id="VoluntaryTaxWithhold" 
				entity="TaxInfo"
				progress="0" 
				show-back-button="true"
				show-exit-button="true"
				>
				
				<title id="QuestionPage.Title.VTW">
					<![CDATA[Voluntary Tax Withhold]]>
				</title>
							
				<description id="QuestionPage.Description.MandatoryFields">
					<![CDATA[All fields marked with * are mandatory.]]>
				</description>
	
				<!-- BEGIN BDMOAS: Commented -->
				<!-- 
		    	<validation expression="not(isNotNull(TaxInfo.dedMethod)) or not(isNotNull(TaxInfo.dollarAmount)) or ValidateDeductionAmount(TaxInfo.dedMethod,TaxInfo.dollarAmount)">
					<message id="Validation.Message.DollarAmount">The maximum amount you can enter is 400</message>
		    	</validation>
		    	 -->
				<!-- END BDMOAS: Commented -->
	
		    	<validation expression="not(isNotNull(TaxInfo.dedMethod)) or not(isNotNull(TaxInfo.dollarPerct)) or ValidateDeductionPercent(TaxInfo.dedMethod,TaxInfo.dollarPerct)">
					<message id="Validation.Message.PercentageAmount">Please enter a number between 1 and 100.</message>
		    	</validation>
	
					<cluster>
						<question id="dedFedTax">
							<label id="Question.Label.MonthlyTaxDeduction">
								<![CDATA[Does the applicant want Federal income tax deducted from their monthly payment?]]>
							</label>
							<layout>
								<type>radio</type>
							</layout>
						</question>
					</cluster>	
					<condition expression="TaxInfo.dedFedTax==&quot;YN1&quot;">
						<cluster>	
							<question id="dedMethod" mandatory="true">
								<label id="Question.Label.TaxDedtnInPercentageOrDollar">
									<![CDATA[Does the applicant want a percentage or a dollar amount for deduction?]]>
								</label>
								<layout>
									<type>radio</type>
								</layout>
							</question>	
						</cluster>
					</condition>
	
					<condition expression="TaxInfo.dedMethod==&quot;BDMTDM8000&quot;">
						<cluster>
							<question id="dollarAmount" mandatory="true">
								<label id="Question.Label.DollarAmountDeduction">
									<![CDATA[Indicate a dollar amount applicant wants deducted for income tax (for example: 100.00).]]>
								</label>
								<layout>
									<width>50</width>							
								</layout>
							</question>	
						</cluster>
						</condition>
						<condition expression="TaxInfo.dedMethod==&quot;BDMTDM8001&quot;">
							<cluster>
							<question id="dollarPerct" mandatory="true">
								<label id="Question.Label.PercentageAmountDeduction">
									<![CDATA[Indicate a percentage applicant wants deducted for income tax (for example: 20).]]>
								</label>
								<layout>
									<width>50</width>							
								</layout>
							</question>
							</cluster>	
						</condition>
				</question-page>
	
				<callout expression="SetVTWPersonID()" id="TaxInfo.taxPersonID"/>
				
			</condition>
			
		<question-page 
			id="WorldIncome" 
			entity="Person"
			progress="0" 
			show-back-button="true" 
			show-exit-button="true"
 			criteria="isPrimaryParticipant==true"			
			>
			
			<title id="QuestionPage.Title.WorldIncome">
				<![CDATA[World Income]]>
			</title>
			
			<description id="QuestionPage.Description.MandatoryFields">
				<![CDATA[All fields marked with * are mandatory.]]>
			</description>			

			<cluster entity="WorldIncome">
				<question id="yearNdThresholdAmt" mandatory="true">
					<label id="Question.Label.SelectYearAndThresholdAmount">
						<![CDATA[Select the year and threshold amount as indicated on the form]]>
					</label>
					<layout>
						<width>60</width>							
					</layout>					
				</question>			
				<question id="isNonResidntNdIncmLTThrshld">
					<label id="Question.Label.IsNRCAndWorldIncomeGTThreshold">
						<![CDATA[Did the applicant indicate that they are not a resident of Canada for tax purposes and their net world income is more than the threshold?]]>
					</label>
					<layout>
						<width>60</width>							
					</layout>					
				</question>		
			</cluster>
		</question-page>					
	</section>

</ieg-script>
