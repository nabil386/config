<?xml version="1.0" encoding="UTF-8"?>

<ieg-script
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="ieg-schema.xsd"
	finish-page="CommonIntake_finishInternalIntakeScript"
	quit-page="CommonIntake_quitInternalIntakeScript" show-sections="true"
	show-progress-bar="true" validate-save-and-exit="false">

	<identifier id="BDMOASGISCombinedApplicationAP"
		scriptversionnumber="V1" type="Intake" />

	<section>

		<title id="Section.Title.OASPension">
			<![CDATA[Old Age Security Pension]]>
		</title>

		<icon enabled-image="sample_about_you"
			current-image="sample_about_you" />

		<question-page id="OASPensionStartDate" entity="Person"
			progress="0" show-back-button="true" show-exit-button="true"
			criteria="isPrimaryParticipant==true">

			<title id="QuestionPage.Title.OASPensionStartDate">
				<![CDATA[Old Age Security Pension Start Date]]>
			</title>

			<description
				id="QuestionPage.Description.MandatoryFields">
				<![CDATA[All fields marked with * are mandatory.]]>
			</description>

			<validation
				expression="not(isNotNull(OASPension.reqPensionStartDate)) or ValidateDateFirstOfMonth(OASPension.reqPensionStartDate)">
				<message id="Validation.Message.RequestedPensionStartDate"><![CDATA[Selected Date must be 1st of the month.]]></message>
			</validation>

			<cluster entity="OASPension">
				<question id="reqPensionStartOption" show-field-help="true">
					<label id="Question.Label.RequestedPensionStartOption">
						<![CDATA[When does applicant want their Old Age Security pension to start?]]>
					</label>
					<layout>
						<type>radio</type>
					</layout>
					<help-text
						id="Question.Label.RequestedPensionStartOption.Help">
						<![CDATA[Indicate when the applicant wants their pension to start.]]>
					</help-text>
				</question>
			</cluster>

			<condition
				expression="OASPension.reqPensionStartOption==&quot;BDMOASPSO2&quot;">
				<cluster entity="OASPension">
					<question id="reqPensionStartDate" mandatory="true"
						show-field-help="true">
						<label id="Question.Label.RequestedPensionStartDate">
							<![CDATA[Requested pension start date]]>
						</label>
						<layout>
							<type>date-picker</type>
							<!-- <class-names>wds-js-input-mask-yyyy-mm-dd</class-names> -->
						</layout>
						<help-text
							id="Question.Label.RequestedPensionStartDate.Help">
							<![CDATA[YYYY-MM-DD]]>
						</help-text>
					</question>
				</cluster>
			</condition>
		</question-page>

		<question-page id="LegalStatus" entity="Person"
			progress="0" show-back-button="true" show-exit-button="true"
			criteria="isPrimaryParticipant==true">

			<title id="QuestionPage.Title.LegalStatus">
				<![CDATA[Legal Status]]>
			</title>

			<description
				id="QuestionPage.Description.MandatoryFields">
				<![CDATA[All fields marked with * are mandatory.]]>
			</description>

			<validation
				expression="not(isNotNull(LegalStatus.canadaFirstEntryDate)) or ValidateFutureDate(LegalStatus.canadaFirstEntryDate)">
				<message id="Validation.Message.CanadaFirstEntryDate"><![CDATA[The 'Date applicant first entered Canada' must be on or before the Current Date.]]></message>
			</validation>

			<validation
				expression="not(isNotNull(LegalStatus.canadaFirstEntryDate) and isNotNull(Person.dateOfDeath))  or ValidateFirstEntryDate(LegalStatus.canadaFirstEntryDate, Person.dateOfDeath)">
				<message
					id="Validation.Message.CanadaFirstEntryDateNotAfterDateOfDeath"><![CDATA[The 'Date applicant first entered Canada' cannot be after Date of Death.]]></message>
			</validation>
			

			<!-- Country of Birth Cluster -->
			<condition expression="Application.applicationForm==&quot;AF10&quot;">
				<cluster entity="Person">
					<title id="Cluster.Title.CountryOfBirth">
						<![CDATA[Country of Birth]]>
					</title>
					<question id="countryOfBirth">
						<label id="Question.Label.CountryOfBirth">
							<![CDATA[Place/Country of birth]]>
						</label>
						<layout>
							<width>60</width>
						</layout>
					</question>
				</cluster>
			</condition>
			
			<condition expression="Application.applicationForm==&quot;AF7&quot;">
				<cluster entity="LegalStatus">
					<question id="isOutOfCABorned">
						<label id="Question.Label.IsBornedOutsideCanada">
							<![CDATA[Did the applicant indicate they were born outside of Canada?]]>
						</label>
						<layout>
							<width>60</width>
						</layout>
					</question>
				</cluster>
			</condition>

			<!-- Legal Status Cluster -->
			<condition
				expression="Person.residentialCountry==&quot;CA&quot;">
				<cluster entity="LegalStatus">
					<title id="Cluster.Title.LegalStatus">
						<![CDATA[Legal Status]]>
					</title>
					<question id="inCALegalStatus">
						<label id="Question.Label.LivingInCanadaLegalStatus">
							<![CDATA[Applicant is living in Canada and is a]]>
						</label>
						<layout>
							<width>60</width>
						</layout>
					</question>
				</cluster>
			</condition>

			<condition
				expression="LegalStatus.inCALegalStatus==&quot;LST6&quot;">
				<cluster entity="LegalStatus">
					<question id="inCALegalStatusOthr" mandatory="true"
						show-field-help="true">
						<label id="Question.Label.LivingInCanadaLegalStatusOther">
							<![CDATA[Specify Legal Status, if Other is selected]]>
						</label>
						<help-text
							id="Question.Label.LivingInCanadaLegalStatusOther.Help">
							<![CDATA[Example: Temporary Resident, Student, Temporary Worker]]>
						</help-text>
						<layout>
							<width>60</width>
						</layout>
					</question>
				</cluster>
			</condition>

			<condition
				expression="not ((Person.residentialCountry!=&quot;CA&quot; and LegalStatus.isOutOfCABorned==&quot;YN2&quot;) or Application.applicationForm==&quot;AF10&quot;)">
				<cluster entity="LegalStatus">
					<question id="isSponseredInCA">
						<label id="Question.Label.IsApplicantEneteredOnSponsorship">
							<![CDATA[If applicant entered Canada from another country, were they admitted into Canada under a sponsorship agreement?]]>
						</label>
						<layout>
							<width>60</width>
						</layout>
					</question>
				</cluster>
			</condition>

			<condition
				expression="Person.residentialCountry!=&quot;CA&quot; or Application.applicationForm==&quot;AF10&quot;">
				<cluster entity="LegalStatus">
					<question id="outOfCALegalStatus">
						<label id="Question.Label.LivingOutOfCanadaLegalStatus">
							<![CDATA[Applicant is living outside of Canada and before they left they were a]]>
						</label>
						<layout>
							<width>60</width>
						</layout>
					</question>
				</cluster>
			</condition>

			<condition
				expression="LegalStatus.outOfCALegalStatus==&quot;LST6&quot;">
				<cluster entity="LegalStatus">
					<question id="outOfCALegalStatusOthr" mandatory="true"
						show-field-help="true">
						<label id="Question.Label.LivingOutOfCanadaLegalStatusOther">
							<![CDATA[Specify Legal Status, if Other is selected]]>
						</label>
						<help-text
							id="Question.Label.LivingOutOfCanadaLegalStatusOther.Help">
							<![CDATA[Example: Temporary Resident, Student, Temporary Worker]]>
						</help-text>
						<layout>
							<width>60</width>
						</layout>
					</question>
				</cluster>
			</condition>

			<!-- First entry into Canada Cluster -->
			<condition
				expression="(isNotNull(LegalStatus.isOutOfCABorned) and not(LegalStatus.isOutOfCABorned==&quot;YN2&quot;)) or (isNotNull(Person.countryOfBirth) and Person.countryOfBirth!=&quot;CA&quot;)">
				<cluster entity="LegalStatus">
					<title id="Cluster.Title.FirstEntryInToCanada">
						<![CDATA[First entry into Canada]]>
					</title>
					<question id="canadaFirstEntryDate" show-field-help="true">
						<label id="Question.Label.FirstEntryDateInToCanada">
							<![CDATA[On what date did the applicant first enter Canada?]]>
						</label>
						<layout>
							<type>date-picker</type>
							<!-- <class-names>wds-js-input-mask-yyyy-mm-dd</class-names> -->
						</layout>
						<help-text
							id="Question.Label.FirstEntryDateInToCanada.Help">
							<![CDATA[YYYY-MM-DD]]>
						</help-text>
					</question>
					<question id="immigrationDocType">
						<label id="Question.Label.TypeOfImmigrationDocument">
							<![CDATA[What type of immigration document did the applicant have when they entered Canada?]]>
						</label>
						<layout>
							<width>70</width>
						</layout>
					</question>
				</cluster>
			</condition>

			<condition
				expression="isNotNull(LegalStatus.immigrationDocType) and LegalStatus.immigrationDocType==&quot;IDOC6&quot;">
				<cluster entity="LegalStatus">
					<question id="immigrationDocTypOthr" mandatory="true">
						<label id="Question.Label.ImmigrationDocTypeOther">
								<![CDATA[Other (Specify)]]>
						</label>
						<layout>
							<width>60</width>
						</layout>
					</question>
				</cluster>
			</condition>
			
			<condition expression="(isNotNull(LegalStatus.isOutOfCABorned) and not(LegalStatus.isOutOfCABorned==&quot;YN2&quot;) or (isNotNull(Person.countryOfBirth) and Person.countryOfBirth!=&quot;CA&quot;)) and Application.applicationForm==&quot;AF10&quot;">
				<cluster entity="LegalStatus">
					<question id="placeOfEntryInCanada">
						<label id="Question.Label.PlaceOfEntryInCanada">
								<![CDATA[Where did the applicant indicate their place of entry was?]]>
						</label>
						<layout>
							<width>60</width>
						</layout>
					</question>
				</cluster>
			</condition>

			<!-- Residence History Cluster -->
			<condition expression="Application.applicationForm==&quot;AF7&quot;">
				<cluster entity="LegalStatus">
					<title id="Cluster.Title.ResidenceHistory">
						<![CDATA[Residence History]]>
					</title>
					<question id="isLivedInCASinceAge18" mandatory="true">
						<label id="Question.Label.IsLivedInCanadaSinceAge18">
							<![CDATA[Has the applicant always lived in Canada since age 18?]]>
						</label>
						<layout>
							<type>radio</type>
						</layout>
					</question>
				</cluster>
			</condition>
				
			<condition expression="Application.applicationForm==&quot;AF10&quot;">
				<cluster entity="LegalStatus">
					<question id="isLivedInCASinceBirth" mandatory="true">
						<label id="Question.Label.IsLivedInCanadaSinceBirth">
							<![CDATA[Has the applicant always lived in Canada since birth?]]>
						</label>
						<layout>
							<type>radio</type>
						</layout>
					</question>
				</cluster>
			</condition>
		</question-page>

		<condition
			expression="(isNotNull(LegalStatus.isLivedInCASinceAge18) and LegalStatus.isLivedInCASinceAge18==&quot;YN2&quot;) or (isNotNull(LegalStatus.isLivedInCASinceBirth) and LegalStatus.isLivedInCASinceBirth==&quot;YN2&quot;)">
			<loop loop-type="for-each" entity="Person"
				criteria="isPrimaryParticipant==true">

				<loop loop-type="while"
					loop-expression="hasMoreResidencePeriodToEnter"
					entity="ResidenceHistory">
					<question-page id="ResidenceHistory"
						entity="ResidenceHistory" progress="0" show-back-button="true"
						show-exit-button="true">

						<title id="QuestionPage.Title.ResidenceHistory">
								<![CDATA[Residence History]]>
						</title>

						<description
							id="QuestionPage.Description.MandatoryFields">
								<![CDATA[All fields marked with * are mandatory.]]>
						</description>

						<validation
							expression="not(isNotNull(ResidenceHistory.residenceHistEndDate) and isNotNull(ResidenceHistory.residenceHistStartDate)) or ValidateEndDateNotEarlierThanStartDate(ResidenceHistory.residenceHistStartDate, ResidenceHistory.residenceHistEndDate)">
							<message id="Validation.Message.EndDateBeforeStartDate"><![CDATA[End date must be after Start Date.]]></message>
						</validation>
						
						<validation
							expression="validateValueConditionalMandatory(ResidenceHistory.residenceHistCountry, ResidenceHistory.foreignCountryIDNumber)">
							<message id="Validation.Message.CountryIDNumber"><![CDATA[Country must be selected if Insurance or identification number from this country is entered.]]></message>
						</validation>

						<cluster>
							<title id="Cluster.Title.AddResidenceHistory">
									<![CDATA[Add Residence History]]>
							</title>

							<description
								id="Cluster.Description.AddResidenceHistory">
									<![CDATA[Enter all residence history records as entered by client on paper form.]]>
							</description>

							<question id="residenceHistCountry">
								<label id="Question.Label.Country">
										<![CDATA[Country]]>
								</label>
								<layout>
									<width>70</width>
								</layout>
							</question>

							<question id="residenceHistStartDate"
								show-field-help="true">
								<label id="Question.Label.StartDate">
										<![CDATA[Start Date]]>
								</label>
								<layout>
									<type>date-picker</type>
									<class-names>wds-js-input-mask-yyyy-mm-dd</class-names>
								</layout>
								<help-text id="Question.Label.StartDate.Help">
										<![CDATA[YYYY-MM-DD]]>
								</help-text>
							</question>

							<question id="residenceHistEndDate"
								show-field-help="true">
								<label id="Question.Label.EndDate">
										<![CDATA[End Date]]>
								</label>
								<layout>
									<type>date-picker</type>
									<class-names>wds-js-input-mask-yyyy-mm-dd</class-names>
								</layout>
								<help-text id="Question.Label.EndDate.Help">
										<![CDATA[YYYY-MM-DD]]>
								</help-text>
							</question>

							<question id="didWorkInCountry">
								<label id="Question.Label.DidApplicantWorkedInCountry">
										<![CDATA[Did applicant indicate they worked in this country?]]>
								</label>
								<layout>
									<type>radio</type>
								</layout>
							</question>

							<question id="didApplyForBenfInCountry">
								<label
									id="Question.Label.DidApplicantAppliedForBenefitInCountry">
										<![CDATA[Did applicant indicate they have applied for a benefit from this country?]]>
								</label>
								<layout>
									<type>radio</type>
								</layout>
							</question>

							<question id="foreignCountryIDNumber">
								<label id="Question.Label.InsuranceOrIDNumberFromCountry">
										<![CDATA[Insurance or identification number from this country]]>
								</label>
								<layout>
									<width>60</width>
								</layout>
							</question>
						</cluster>
						<cluster>
							<question id="hasMoreResidencePeriodToEnter"
								control-question="true" control-question-type="IEG_BOOLEAN">
								<label id="Question.Label.IsAnyResidencePeriodToEnter">
													<![CDATA[Is there another residence period to be entered?]]>
								</label>
							</question>
						</cluster>
					</question-page>


				</loop>

			</loop>
<!--START 96222 DEV: 225-18a Residence History & Absence Details Paper Application Intake Sections -->
			<summary-page id="ResidenceHistoryList" entity="Person"
				progress="0" show-back-button="true" show-exit-button="true"
				criteria="isPrimaryParticipant==true">

				<title id="QuestionPage.Title.ResidenceHistoryList">
								<![CDATA[Residence History]]>
				</title>

				<list entity="Person" criteria="isPrimaryParticipant==true">
					<title id="Cluster.Title.ResidenceHistory">
						<![CDATA[Residence History]]>
					</title>
					<description id="Cluster.Description.ResidenceHistory">
						<![CDATA[See below the details of the residence periods captured thus far in this form]]>
					</description>
					<edit-link start-page="ResidenceHistory"
						skip-to-summary="true" />
					<delete-link />
					<list entity="ResidenceHistory">
						<column id="residenceHistCountry">
							<title id="Question.Label.Country">
								<![CDATA[Country]]>
							</title>
						</column>
						<column id="residenceHistStartDate">
							<title id="Question.Label.StartDate">
								<![CDATA[Start Date]]>
							</title>
						</column>
						<column id="residenceHistEndDate">
							<title id="Question.Label.EndDate">
								<![CDATA[End Date]]>
							</title>
						</column>
						<column id="didWorkInCountry">
							<title id="Question.Label.DidApplicantWorkedInCountry">
								<![CDATA[Did applicant indicate they worked in this country?]]>
							</title>
						</column>
						<column id="didApplyForBenfInCountry">
							<title
								id="Question.Label.DidApplicantAppliedForBenefitInCountry">
								<![CDATA[Did applicant indicate they have applied for a benefit from this country?]]>
							</title>
						</column>
						<column id="foreignCountryIDNumber">
							<title id="Question.Label.InsuranceOrIDNumberFromCountry">
								<![CDATA[Insurance or identification number from this country]]>
							</title>
						</column>
					</list>
				</list>

			</summary-page>
			<!--END 96222 DEV: 225-18a Residence History & Absence Details Paper Application Intake Sections -->
		</condition>

		<condition
			expression="(isNotNull(LegalStatus.isLivedInCASinceAge18) and LegalStatus.isLivedInCASinceAge18==&quot;YN2&quot;) or (isNotNull(LegalStatus.isLivedInCASinceBirth) and LegalStatus.isLivedInCASinceBirth==&quot;YN2&quot;)">
			<question-page id="NatureOfAbsences" entity="Person"
				progress="0" show-back-button="true" show-exit-button="true"
				criteria="isPrimaryParticipant==true">

				<title id="QuestionPage.Title.NatureOfAbsences">
					<![CDATA[Nature of Absences]]>
				</title>

				<description
					id="QuestionPage.Description.MandatoryFields">
					<![CDATA[All fields marked with * are mandatory.]]>
				</description>

				<cluster entity="AbsenceDetails">
					<question id="absenceReason">
						<label id="Question.Label.NatureOfAbsencesIfApplicable">
							<![CDATA[Nature of Absences (if applicant indicated any)]]>
						</label>
						<layout>
							<num-rows>4</num-rows>
						</layout>
					</question>
				</cluster>
			</question-page>
		</condition>
	</section>
</ieg-script>
