<?xml version="1.0" encoding="UTF-8"?>

<ieg-script
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="ieg-schema.xsd"
	finish-page="CommonIntake_finishInternalIntakeScript"
	quit-page="CommonIntake_quitInternalIntakeScript" show-sections="true"
	show-progress-bar="true" validate-save-and-exit="false">

	<identifier id="BDMOASGISApplicationCP"
		scriptversionnumber="V1" type="Intake" />

	<section>
		<title id="Section.Title.ResidencePeriod">
			<![CDATA[Residence Period]]>
		</title>

		<icon enabled-image="sample_about_you"
			current-image="sample_about_you" />

		<question-page id="Residence" entity="Person"
			progress="0" show-back-button="true" show-exit-button="true"
			criteria="isPrimaryParticipant==true">

			<title id="QuestionPage.Title.Residence">
				<![CDATA[Residence]]>
			</title>

			<description
				id="QuestionPage.Description.MandatoryFields">
				<![CDATA[All fields marked with * are mandatory.]]>
			</description>

			<!-- Residence History Cluster -->
			<cluster entity="LegalStatus">
				<question id="isAplcntLivedInCAForLast2Yr" mandatory="true">
					<label id="Question.Label.IsLivedInCanadaForLast2Years">
						<![CDATA[Has the applicant lived in Canada for the last two years?]]>
					</label>
					<layout>
						<type>radio</type>
					</layout>
				</question>
			</cluster>
		</question-page>

		<condition
			expression="LegalStatus.isAplcntLivedInCAForLast2Yr==&quot;YN2&quot;">
			<loop loop-type="for-each" entity="Person"
				criteria="isPrimaryParticipant==true">

				<loop loop-type="while"
					loop-expression="hasMoreResidencePeriodToEnter"
					entity="ResidenceHistory">
					<question-page id="ResidenceHistory"
						entity="ResidenceHistory" progress="0" show-back-button="true"
						show-exit-button="true">

						<title id="QuestionPage.Title.ResidenceHistory">
								<![CDATA[Residence History]]>
						</title>

						<description
							id="QuestionPage.Description.MandatoryFields">
								<![CDATA[All fields marked with * are mandatory.]]>
						</description>

						<validation
							expression="not(isNotNull(ResidenceHistory.residenceHistEndDate) and isNotNull(ResidenceHistory.residenceHistStartDate)) or ValidateEndDateNotEarlierThanStartDate(ResidenceHistory.residenceHistStartDate, ResidenceHistory.residenceHistEndDate)">
							<message id="Validation.Message.EndDateBeforeStartDate"><![CDATA[End date must be equal to or later than Start Date.]]></message>
						</validation>

						<validation
							expression="not(isNotNull(ResidenceHistory.residenceHistEndDate) and isNotNull(ResidenceHistory.residenceHistStartDate)) or ValidateResidencePeriodNotOverlapping(ResidenceHistory.residenceHistStartDate, ResidenceHistory.residenceHistEndDate, Person.isPrimaryParticipant)">
							<message id="Validation.Message.OverlapingPeriodCanNotBeEntered"><![CDATA[Overlapping periods cannot be entered.]]></message>
						</validation>
						
						<validation
							expression="(not(isNotNull(ResidenceHistory.residenceHistStartDate)) or ValidateFutureDate(ResidenceHistory.residenceHistStartDate)) and (not(isNotNull(ResidenceHistory.residenceHistEndDate)) or ValidateFutureDate(ResidenceHistory.residenceHistEndDate))">
							<message id="Validation.Message.DateCanNotBeFutureDated"><![CDATA[Date cannot be future dated.]]></message>
						</validation>	

						<validation
							expression="not(isNotNull(ResidenceHistory.residenceHistStartDate)) or ValidateDateBetweenPeriod(ResidenceHistory.residenceHistStartDate, &quot;2&quot;)">
							<message id="Validation.Message.Last2YrsOnly"><![CDATA[Please provide residence history for the past 2 years only.]]></message>
						</validation>				

						<validation
							expression="ValidateForeignIdentifier(ResidenceHistory.residenceHistCountry, ResidenceHistory.didApplyForBenfInCountry, ResidenceHistory.foreignCountryIDNumber)">
							<message id="Validation.Message.CountryIDNumber"><![CDATA[You must provide under which insurance or ID number you have applied for a benefit from this country.]]></message>
						</validation>
						
						<validation
							expression="not(isNotNull(ResidenceHistory.residenceHistEndDate) and isNotNull(Person.dateOfDeath)) or ValidateDateBeforeDeath(ResidenceHistory.residenceHistEndDate, Person.dateOfDeath)">
							<message id="Validation.Message.DateCanNotBeLaterThanDateOfDeath"><![CDATA[=Date cannot be later than Date of Death.]]></message>
						</validation>

						<cluster>
							<title id="Cluster.Title.AddResidenceHistory">
									<![CDATA[Add Residence History]]>
							</title>

							<description
								id="Cluster.Description.AddResidenceHistory">
									<![CDATA[List all countries, including Canada, where the applicant has resided since age 18]]>
							</description>

							<question id="residenceHistCountry" mandatory="true">
								<label id="Question.Label.Country">
										<![CDATA[Country]]>
								</label>
								<layout>
									<width>70</width>
								</layout>
							</question>

							<question id="residenceHistStartDate"
								mandatory="true">
								<label id="Question.Label.StartDate">
										<![CDATA[From]]>
								</label>
								<layout>
									<type>date-picker</type>
									<class-names>wds-js-input-mask-yyyy-mm-dd</class-names>
								</layout>
								<hint-text id="Question.Label.StartDate.Hint">
									<![CDATA[YYYY-MM-DD]]>
								</hint-text>	
							</question>

							<question id="residenceHistEndDate">
								<label id="Question.Label.EndDate">
										<![CDATA[To]]>
								</label>
								<layout>
									<type>date-picker</type>
									<class-names>wds-js-input-mask-yyyy-mm-dd</class-names>
								</layout>
								<hint-text id="Question.Label.EndDate.Hint">
									<![CDATA[YYYY-MM-DD]]>
								</hint-text>	
							</question>

							<question id="didWorkInCountry" mandatory="true">
								<label id="Question.Label.DidApplicantWorkedInCountry">
										<![CDATA[Did you also work in this country?]]>
								</label>
								<layout>
									<type>radio</type>
								</layout>
							</question>

							<question id="didApplyForBenfInCountry" mandatory="true">
								<label
									id="Question.Label.DidApplicantAppliedForBenefitInCountry">
										<![CDATA[Have you applied for a benefit from this country?]]>
								</label>
								<layout>
									<type>radio</type>
								</layout>
							</question>

							<question id="foreignCountryIDNumber">
								<label id="Question.Label.InsuranceOrIDNumberFromCountry">
										<![CDATA[Under which insurance or identification number in this country?]]>
								</label>
								<layout>
									<width>60</width>
								</layout>
							</question>							
						</cluster>
						<cluster>
							<question id="hasMoreResidencePeriodToEnter"
								control-question="true" control-question-type="IEG_BOOLEAN">
								<label id="Question.Label.IsAnyResidencePeriodToEnter">
													<![CDATA[Is there another residence period to be entered?]]>
								</label>
							</question>
						</cluster>
					</question-page>
				</loop>

			</loop>
<!--START 96222 DEV: 225-18a Residence History & Absence Details Paper Application Intake Sections -->
			<summary-page id="ResidenceHistoryList" entity="Person"
				progress="0" show-back-button="true" show-exit-button="true"
				criteria="isPrimaryParticipant==true">

				<title id="QuestionPage.Title.ResidenceHistoryList">
								<![CDATA[Residence History]]>
				</title>

				<list entity="Person" criteria="isPrimaryParticipant==true">
					<title id="Cluster.Title.ResidenceHistory">
						<![CDATA[Residence History]]>
					</title>
					<description id="Cluster.Description.ResidenceHistory">
						<![CDATA[See below the details of the residence periods captured thus far in this form]]>
					</description>					
					<edit-link start-page="ResidenceHistory"
						skip-to-summary="true" />
					<delete-link />
					<list entity="ResidenceHistory">
						<column id="residenceHistCountry">
							<title id="Question.Label.Country">
								<![CDATA[Country]]>
							</title>
						</column>
						<column id="residenceHistStartDate">
							<title id="Question.Label.StartDate">
								<![CDATA[Start Date]]>
							</title>
						</column>
						<column id="residenceHistEndDate">
							<title id="Question.Label.EndDate">
								<![CDATA[End Date]]>
							</title>
						</column>
						<column id="didWorkInCountry">
							<title id="Question.Label.DidApplicantWorkedInCountry">
								<![CDATA[Did you also work in this country?]]>
							</title>
						</column>
						<column id="didApplyForBenfInCountry">
							<title
								id="Question.Label.DidApplicantAppliedForBenefitInCountry">
								<![CDATA[Have you applied for a benefit from this country?]]>
							</title>
						</column>
						<column id="foreignCountryIDNumber">
							<title id="Question.Label.InsuranceOrIDNumberFromCountry">
								<![CDATA[Under which insurance or identification number in this country?]]>
							</title>
						</column>						
					</list>
				</list>
			</summary-page>
			<!--END 96222 DEV: 225-18a Residence History Paper Application Intake Sections -->
		</condition>
	</section>
</ieg-script>
