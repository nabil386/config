<?xml version="1.0" encoding="UTF-8"?>

<ieg-script xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="ieg-schema.xsd"
	finish-page="CommonIntake_finishInternalIntakeScript" 
	quit-page="CommonIntake_quitInternalIntakeScript"		
	show-sections="true"
	show-progress-bar="true"
	validate-save-and-exit="false"
	>
		
	<identifier id="BDMOASGISApplicationAP" scriptversionnumber="V1" type="Intake" />

	
	<section>
		
		<title id="CommunicationPref.Title">
			<![CDATA[Contact Information]]>
		</title>
		<icon enabled-image="sample_about_you"
			current-image="sample_about_you" />
		<question-page 
			id="CommunicationPref" 
			entity="Person"
			progress="0" 
			show-back-button="true"
			show-exit-button="true"
			>
			
			<title id="CommunicationPref.Title">
					<![CDATA[Preferred Contact Information]]>
			</title>
						
			<description id="MandatoryFieldsDescription">
				<![CDATA[All fields marked with * are mandatory.]]>
			</description>
	
			<validation expression="not(isNotNull(CommunicationDetails.phoneExt)) or validateOnlyNumeric(CommunicationDetails.phoneExt)">
      			<message id="ExtensionNumber.Validation"><![CDATA[Extension must be numeric.]]></message>
    		</validation>
    		
    		<validation expression="not(isNotNull(CommunicationDetails.phoneNumber)) or (CommunicationDetails.phoneNumber==&quot;&quot;) or validateOnlyNumeric(CommunicationDetails.phoneNumber)">
      			<message id="PrimaryPhoneNumber.Validation"><![CDATA[Phone number must be numeric.]]></message>
    		</validation>
    		
			<validation expression="not(isNotNull(CommunicationDetails.countryCode)) or not(isNotNull(CommunicationDetails.phoneNumber)) or not((CommunicationDetails.countryCode==&quot;BDMPC80035&quot; or CommunicationDetails.countryCode==&quot;BDMPC80216&quot; or CommunicationDetails.countryCode==&quot;BDMPC80222&quot; or CommunicationDetails.countryCode==&quot;BDMPC80210&quot; or CommunicationDetails.countryCode==&quot;BDMPC80206&quot; or CommunicationDetails.countryCode==&quot;BDMPC80184&quot; or CommunicationDetails.countryCode==&quot;BDMPC80174&quot; or CommunicationDetails.countryCode==&quot;BDMPC80171&quot; or CommunicationDetails.countryCode==&quot;BDMPC80170&quot; or CommunicationDetails.countryCode==&quot;BDMPC80162&quot; or CommunicationDetails.countryCode==&quot;BDMPC80148&quot; or CommunicationDetails.countryCode==&quot;BDMPC80133&quot; or CommunicationDetails.countryCode==&quot;BDMPC80097&quot; or CommunicationDetails.countryCode==&quot;BDMPC80080&quot; or CommunicationDetails.countryCode==&quot;BDMPC80079&quot; or CommunicationDetails.countryCode==&quot;BDMPC80057&quot; or CommunicationDetails.countryCode==&quot;BDMPC80056&quot; or CommunicationDetails.countryCode==&quot;BDMPC80037&quot; or CommunicationDetails.countryCode==&quot;BDMPC80023&quot; or CommunicationDetails.countryCode==&quot;BDMPC80018&quot; or CommunicationDetails.countryCode==&quot;BDMPC80015&quot; or CommunicationDetails.countryCode==&quot;BDMPC80008&quot; or CommunicationDetails.countryCode==&quot;BDMPC80005&quot; or CommunicationDetails.countryCode==&quot;BDMPC80003&quot;)) or (CommunicationDetails.phoneNumber==&quot;&quot;) or validateLength2(CommunicationDetails.phoneNumber, &quot;7&quot;, &quot;7&quot;)">
			      <message id="PrimaryPhoneNumberOne.Validation"><![CDATA[Phone Number must be 7 digits for all countries which have a country phone code of + 1.]]></message>
			</validation> 
			
			<validation expression="not(isNotNull(CommunicationDetails.phoneAreaCode)) or validateOnlyNumeric(CommunicationDetails.phoneAreaCode)">
		    	<message id="AreaCode.Validation"><![CDATA[Area code must be numeric.]]></message>
		    </validation> 

			<validation expression="not(isNotNull(CommunicationDetails.countryCode)) or not(isNotNull(CommunicationDetails.phoneAreaCode)) or not((CommunicationDetails.countryCode==&quot;BDMPC80035&quot; or CommunicationDetails.countryCode==&quot;BDMPC80216&quot; or CommunicationDetails.countryCode==&quot;BDMPC80222&quot; or CommunicationDetails.countryCode==&quot;BDMPC80210&quot; or CommunicationDetails.countryCode==&quot;BDMPC80206&quot; or CommunicationDetails.countryCode==&quot;BDMPC80184&quot; or CommunicationDetails.countryCode==&quot;BDMPC80174&quot; or CommunicationDetails.countryCode==&quot;BDMPC80171&quot; or CommunicationDetails.countryCode==&quot;BDMPC80170&quot; or CommunicationDetails.countryCode==&quot;BDMPC80162&quot; or CommunicationDetails.countryCode==&quot;BDMPC80148&quot; or CommunicationDetails.countryCode==&quot;BDMPC80133&quot; or CommunicationDetails.countryCode==&quot;BDMPC80097&quot; or CommunicationDetails.countryCode==&quot;BDMPC80080&quot; or CommunicationDetails.countryCode==&quot;BDMPC80079&quot; or CommunicationDetails.countryCode==&quot;BDMPC80057&quot; or CommunicationDetails.countryCode==&quot;BDMPC80056&quot; or CommunicationDetails.countryCode==&quot;BDMPC80037&quot; or CommunicationDetails.countryCode==&quot;BDMPC80023&quot; or CommunicationDetails.countryCode==&quot;BDMPC80018&quot; or CommunicationDetails.countryCode==&quot;BDMPC80015&quot; or CommunicationDetails.countryCode==&quot;BDMPC80008&quot; or CommunicationDetails.countryCode==&quot;BDMPC80005&quot; or CommunicationDetails.countryCode==&quot;BDMPC80003&quot;))  or (CommunicationDetails.phoneAreaCode==&quot;&quot;) or validateLength2(CommunicationDetails.phoneAreaCode, &quot;3&quot;, &quot;3&quot;)">
		    	<message id="AreaCodeOne.Validation"><![CDATA[Area code must be 3 digits for all countries which have a country phone code of + 1.]]></message>
		    </validation>
		    
			<validation expression="validateValueConditionalMandatory(CommunicationDetails.phoneAreaCode,CommunicationDetails.phoneNumber)">
     				<message id="CommunicationDetails.PAreaCode.ValidationMsg"><![CDATA[Area code must be provided when Phone number is provided.]]></message>
   			</validation>
   			
   			<validation expression="validateValueConditionalMandatory(CommunicationDetails.phoneNumber, CommunicationDetails.phoneAreaCode)">
		      	<message id="CommunicationDetails.PAreaPhoneCode.msg"><![CDATA[Phone number must be provided when Area code is provided.]]></message>
		    </validation>

			<validation expression="ValidatePhoneType(CommunicationDetails.phoneType,CommunicationDetails.phoneNumber)">
				<message id="CommunicationDetails.PPhoneType.ValidationMsg"><![CDATA[Phone Type must be selected when Area code or Phone number has been provided.]]></message>
			</validation>

			<validation expression="ValidatePhoneType(CommunicationDetails.phoneType,CommunicationDetails.phoneAreaCode)">
				<message id="CommunicationDetails.PPhoneType.ValidationMsg"><![CDATA[Phone Type must be selected when Area code or Phone number has been provided.]]></message>
			</validation>	

    		<validation expression="ValidatePhoneNumberCountry(CommunicationDetails.countryCode,CommunicationDetails.phoneNumber)">
				<message id="CountryCode.Validation.Required"><![CDATA[Country code must be selected when Area code or Phone number has been provided.]]></message>
  				</validation>
    		<validation expression="ValidatePhoneNumberCountry(CommunicationDetails.countryCode,CommunicationDetails.phoneAreaCode)">
				<message id="CountryCode.Validation.Required"><![CDATA[Country code must be selected when Area code or Phone number has been provided.]]></message>
 			</validation>

   	
	    	<!-- Personal mobile phone number or Business mobile phone number cannot have extension -->
	    	<validation expression="(
	    		not(isNotNull(CommunicationDetails.phoneExt))	    		
	    		or 
	    		((isNotNull(CommunicationDetails.phoneExt) and not(CommunicationDetails.phoneType==&quot;BDMPH8000&quot; or CommunicationDetails.phoneType==&quot;BDMPH8001&quot;)))
	    		)">
				<message id="CommunicationDetails.phoneExtMobile.Validation"><![CDATA[Personal mobile phone number or Business mobile phone number cannot have extensions.]]></message>
			</validation>
	    	
			<set-attribute expression="true" id="CommunicationDetails.isPrimaryCommunication" />
			
			<set-attribute expression="CommunicationDetails.phoneNumber!=&quot;&quot;" id="Person.hasCommunications" />
			<set-attribute expression="concatenateThreeValues(CommunicationDetails.phoneAreaCode,&quot;-&quot;,CommunicationDetails.phoneNumber)" id="CommunicationDetails.fullPhoneNumber" />

			<cluster entity="CommunicationPref">
				<title id="CommunicationDetails.SectionOneTitle">
						<![CDATA[Language preferences ]]>
				</title>
				<question id="languageS" mandatory="true">
					<label id="CommunicationDetails.SectionOne.SpokenLanguageQuestion">
						<![CDATA[Preferred Language of Communication?]]>
					</label>
					<layout>
						<type>radio</type>
					</layout>
				</question>		
			</cluster>         

			<cluster  entity="CommunicationDetails">
				<title id="CommunicationDetails.SectionOne.PTelephoneTitle">
					<![CDATA[<h3>Preferred phone number</h3>]]>
				</title>
				<question id="phoneType" default-value-expression="&quot;BDMPH8000&quot;">
					<label id="CommunicationDetails.SectionOne.PTelephoneType">
						<![CDATA[Phone Type]]>
					</label>
					<layout>
						<width>70</width>							
					</layout>					
				</question>
				<question id="countryCode" default-value-expression="&quot;BDMPC80035&quot;">
					<label id="CommunicationDetails.SectionOne.PTelephoneCCode">
						<![CDATA[Country code]]>
					</label>
					<layout>
						<width>70</width>							
					</layout>						
				</question>
			</cluster>
			
			<cluster entity="CommunicationDetails">
				<layout>
					<type>flow</type>
				</layout>
				
				<question id="phoneAreaCode" mandatory="false" show-field-help="true">
					<label id="CommunicationDetails.SectionOne.PAreaCode">
						<![CDATA[Area Code (555)]]>
					</label>
						<layout>
							<width>50</width>
						</layout>
					<help-text id="CommunicationDetails.SectionOne.PAreaCode.Help">
						<![CDATA[Numeric value only with no spaces.]]>
					</help-text>					
				</question>
				<question id="phoneNumber" mandatory="false" show-field-help="true">
					<label id="CommunicationDetails.SectionOne.PTelephoneNumber">
						<![CDATA[Phone number (5551212)]]>
					</label>					
					<layout>
							<width>50</width>
					</layout>
					<help-text id="CommunicationDetails.SectionOne.PTelephoneNumber.Help">
						<![CDATA[Numeric value only with no spaces.]]>
					</help-text>					
				</question>
				<question id="phoneExt"  show-field-help="true">
					<label id="CommunicationDetails.SectionOne.PTelephoneExt">
						<![CDATA[Extension]]>
					</label>
					<layout>
							<width>50</width>
					</layout>
					<help-text id="CommunicationDetails.SectionOne.PTelephoneExt.Help">
						<![CDATA[Numeric value only with no spaces.]]>
					</help-text>					
				</question>		
			</cluster>            
		</question-page>
		
		<condition expression="CommunicationDetails.phoneNumber!=&quot;&quot;">
			<loop loop-type="for-each" 
			      entity="Person"
			      criteria="isPrimaryParticipant==true"
				>
				
				<loop loop-type="for" 
				      entity="CommunicationDetails"
				      loop-expression="1" 
				      criteria="isPrimaryCommunication==false"
					>
					
					<question-page 
						id="CommunicationAlternate"
						progress="0" 
						show-back-button="true"
						show-exit-button="true"
						>
						<title id="CommunicationDetails.Title.ContactInfoTitle">
							<![CDATA[Alternate Contact Information]]>
						</title>
								
						<description id="MandatoryFieldsDescription">
							<![CDATA[All fields marked with * are mandatory.]]>
						</description>			
						
						<validation expression="not(isNotNull(CommunicationDetails.phoneExt)) or validateOnlyNumeric(CommunicationDetails.phoneExt)">
			      			<message id="ExtensionNumber.Validation"><![CDATA[Extension must be numeric.]]></message>
			    		</validation>
			    		
			    		<validation expression="not(isNotNull(CommunicationDetails.phoneNumber)) or (CommunicationDetails.phoneNumber==&quot;&quot;) or validateOnlyNumeric(CommunicationDetails.phoneNumber)">
			      			<message id="AlternatePhoneNumber.Validation"><![CDATA[Phone number must be numeric.]]></message>
			    		</validation>
			    		
						<validation expression="not(isNotNull(CommunicationDetails.countryCode)) or not(isNotNull(CommunicationDetails.phoneNumber)) or not((CommunicationDetails.countryCode==&quot;BDMPC80035&quot; or CommunicationDetails.countryCode==&quot;BDMPC80216&quot; or CommunicationDetails.countryCode==&quot;BDMPC80222&quot; or CommunicationDetails.countryCode==&quot;BDMPC80210&quot; or CommunicationDetails.countryCode==&quot;BDMPC80206&quot; or CommunicationDetails.countryCode==&quot;BDMPC80184&quot; or CommunicationDetails.countryCode==&quot;BDMPC80174&quot; or CommunicationDetails.countryCode==&quot;BDMPC80171&quot; or CommunicationDetails.countryCode==&quot;BDMPC80170&quot; or CommunicationDetails.countryCode==&quot;BDMPC80162&quot; or CommunicationDetails.countryCode==&quot;BDMPC80148&quot; or CommunicationDetails.countryCode==&quot;BDMPC80133&quot; or CommunicationDetails.countryCode==&quot;BDMPC80097&quot; or CommunicationDetails.countryCode==&quot;BDMPC80080&quot; or CommunicationDetails.countryCode==&quot;BDMPC80079&quot; or CommunicationDetails.countryCode==&quot;BDMPC80057&quot; or CommunicationDetails.countryCode==&quot;BDMPC80056&quot; or CommunicationDetails.countryCode==&quot;BDMPC80037&quot; or CommunicationDetails.countryCode==&quot;BDMPC80023&quot; or CommunicationDetails.countryCode==&quot;BDMPC80018&quot; or CommunicationDetails.countryCode==&quot;BDMPC80015&quot; or CommunicationDetails.countryCode==&quot;BDMPC80008&quot; or CommunicationDetails.countryCode==&quot;BDMPC80005&quot; or CommunicationDetails.countryCode==&quot;BDMPC80003&quot;)) or (CommunicationDetails.phoneNumber==&quot;&quot;) or validateLength2(CommunicationDetails.phoneNumber, &quot;7&quot;, &quot;7&quot;)">
						      <message id="AlternatePhoneNumberOne.Validation"><![CDATA[Phone Number must be 7 digits for all countries which have a country phone code of + 1.]]></message>
						</validation> 
						
						<validation expression="not(isNotNull(CommunicationDetails.phoneAreaCode)) or validateOnlyNumeric(CommunicationDetails.phoneAreaCode)">
					    	<message id="AreaCode.Validation"><![CDATA[Area code must be numeric.]]></message>
					    </validation> 
			
						<validation expression="not(isNotNull(CommunicationDetails.countryCode)) or not(isNotNull(CommunicationDetails.phoneAreaCode)) or not((CommunicationDetails.countryCode==&quot;BDMPC80035&quot; or CommunicationDetails.countryCode==&quot;BDMPC80216&quot; or CommunicationDetails.countryCode==&quot;BDMPC80222&quot; or CommunicationDetails.countryCode==&quot;BDMPC80210&quot; or CommunicationDetails.countryCode==&quot;BDMPC80206&quot; or CommunicationDetails.countryCode==&quot;BDMPC80184&quot; or CommunicationDetails.countryCode==&quot;BDMPC80174&quot; or CommunicationDetails.countryCode==&quot;BDMPC80171&quot; or CommunicationDetails.countryCode==&quot;BDMPC80170&quot; or CommunicationDetails.countryCode==&quot;BDMPC80162&quot; or CommunicationDetails.countryCode==&quot;BDMPC80148&quot; or CommunicationDetails.countryCode==&quot;BDMPC80133&quot; or CommunicationDetails.countryCode==&quot;BDMPC80097&quot; or CommunicationDetails.countryCode==&quot;BDMPC80080&quot; or CommunicationDetails.countryCode==&quot;BDMPC80079&quot; or CommunicationDetails.countryCode==&quot;BDMPC80057&quot; or CommunicationDetails.countryCode==&quot;BDMPC80056&quot; or CommunicationDetails.countryCode==&quot;BDMPC80037&quot; or CommunicationDetails.countryCode==&quot;BDMPC80023&quot; or CommunicationDetails.countryCode==&quot;BDMPC80018&quot; or CommunicationDetails.countryCode==&quot;BDMPC80015&quot; or CommunicationDetails.countryCode==&quot;BDMPC80008&quot; or CommunicationDetails.countryCode==&quot;BDMPC80005&quot; or CommunicationDetails.countryCode==&quot;BDMPC80003&quot;))  or (CommunicationDetails.phoneAreaCode==&quot;&quot;) or validateLength2(CommunicationDetails.phoneAreaCode, &quot;3&quot;, &quot;3&quot;)">
					    	<message id="AreaCodeOne.Validation"><![CDATA[Area code must be 3 digits for all countries which have a country phone code of + 1.]]></message>
					    </validation>
					    
						<validation expression="validateValueConditionalMandatory(CommunicationDetails.phoneAreaCode,CommunicationDetails.phoneNumber)">
			     				<message id="CommunicationDetails.PAreaCode.ValidationMsg"><![CDATA[Area code must be provided when Phone number is provided.]]></message>
			   			</validation>
			   			
			   			<validation expression="validateValueConditionalMandatory(CommunicationDetails.phoneNumber, CommunicationDetails.phoneAreaCode)">
					      	<message id="CommunicationDetails.PAreaPhoneCode.msg"><![CDATA[Phone number must be provided when Area code is provided.]]></message>
					    </validation>
			
						<validation expression="ValidatePhoneType(CommunicationDetails.phoneType,CommunicationDetails.phoneNumber)">
							<message id="CommunicationDetails.PPhoneType.ValidationMsg"><![CDATA[Phone Type must be selected when Area code or Phone number has been provided.]]></message>
						</validation>
			
						<validation expression="ValidatePhoneType(CommunicationDetails.phoneType,CommunicationDetails.phoneAreaCode)">
							<message id="CommunicationDetails.PPhoneType.ValidationMsg"><![CDATA[Phone Type must be selected when Area code or Phone number has been provided.]]></message>
						</validation>		

			    		<validation expression="ValidatePhoneNumberCountry(CommunicationDetails.countryCode,CommunicationDetails.phoneNumber)">
							<message id="CountryCode.Validation.Required"><![CDATA[Country code must be selected when Area code or Phone number has been provided.]]></message>
	    				</validation>
			    		<validation expression="ValidatePhoneNumberCountry(CommunicationDetails.countryCode,CommunicationDetails.phoneAreaCode)">
							<message id="CountryCode.Validation.Required"><![CDATA[Country code must be selected when Area code or Phone number has been provided.]]></message>
	    				</validation>	  

						<!-- Personal mobile phone number or Business mobile phone number cannot have extension -->
	    		    	<validation expression="(
				    		 not(isNotNull(CommunicationDetails.phoneExt))				    		 
				    		or 
				    		((isNotNull(CommunicationDetails.phoneExt) and not(CommunicationDetails.phoneType==&quot;BDMPH8000&quot; or CommunicationDetails.phoneType==&quot;BDMPH8001&quot;)))
				    		)">
							<message id="CommunicationDetails.phoneExtMobile.Validation"><![CDATA[Personal mobile phone number or Business mobile phone number cannot have an extension.]]></message>
						</validation>
						
						<set-attribute expression="false" id="isPrimaryCommunication" />
				     	<set-attribute expression="concatenateThreeValues(CommunicationDetails.phoneAreaCode,&quot;-&quot;,CommunicationDetails.phoneNumber)" id="CommunicationDetails.fullPhoneNumber" />
				     					     		
						<!-- ALTERNATE PHONE NUMBER -->
						<cluster  entity="CommunicationDetails">
							<title id="CommunicationDetails.SectionOne.ATelephoneTitle">
								<![CDATA[<h3>Alternate phone number</h3>]]>
							</title>

							<question id="phoneType" default-value-expression="&quot;BDMPH8000&quot;">
								<label id="CommunicationDetails.SectionOne.ATelephoneType">
									<![CDATA[Phone Type]]>
									
								</label>
								<layout>
									<width>70</width>							
								</layout>								
							</question>
							<question id="countryCode" default-value-expression="&quot;BDMPC80035&quot;">
								<label id="CommunicationDetails.SectionOne.ATelephoneCCode">
									<![CDATA[Country code]]>
								</label>
								<layout>
									<width>70</width>							
								</layout>								
							</question>
						</cluster>
						
						<cluster  entity="CommunicationDetails">
							<layout>
								<type>flow</type>
								<!-- num-cols>2</num-cols -->
							</layout>
							
								<question id="phoneAreaCode" mandatory="false" show-field-help="true">
									<label id="CommunicationDetails.SectionOne.AAreaCode">
										<![CDATA[Area Code (555)]]>
									</label>
									<layout>
										<width>50</width>
									</layout>
									<help-text id="CommunicationDetails.SectionOne.AAreaCode.Help">
										<![CDATA[Numeric value only with no spaces.]]>
									</help-text>										
								</question>
								<question id="phoneNumber" mandatory="false" show-field-help="true">
									<label id="CommunicationDetails.SectionOne.ATelephoneNumber">
										<![CDATA[Phone number (5551212)]]>
									</label>
									<layout>
										<width>50</width>
									</layout>
									<help-text id="CommunicationDetails.SectionOne.ATelephoneNumber.Help">
										<![CDATA[Numeric value only with no spaces.]]>
									</help-text>									
								</question>
								<question id="phoneExt" show-field-help="true">
									<label id="CommunicationDetails.SectionOne.ATelephoneExt">
										<![CDATA[Extension]]>
									</label>
									<layout>
											<width>50</width>
									</layout>
									<help-text id="CommunicationDetails.SectionOne.ATelephoneExt.Help">
										<![CDATA[Numeric value only with no spaces.]]>
									</help-text>									
								</question>
							
						</cluster>
					</question-page>
				</loop>
			</loop>
		</condition>	
	</section>
</ieg-script>
