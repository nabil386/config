<?xml version="1.0" encoding="UTF-8"?>
<RuleSet name="BDMOASLegalStatusVerificationRuleSet"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
    <Class extends="VerificationDeterminator"
        extendsRuleSet="VerificationRuleSet"
        name="BDMOASLegalStatusVerificationDeterminator">

        <Attribute name="displayName">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <XmlMessage>BDMOASLegalStatusVerification</XmlMessage>
            </derivation>
        </Attribute>

        <Attribute name="determine">
            <type>
                <ruleclass
                    name="VerificationDeterminatorResult"
                    ruleset="VerificationRuleSet" />
            </type>
            <derivation>
                <create
                    ruleclass="VerificationDeterminatorResult"
                    ruleset="VerificationRuleSet">
                    <specify attribute="result">
                        <reference attribute="isLegalStatusVerificationRequired" />
                    </specify>
                    <specify attribute="reason">
                        <reference attribute="reasonSkipped" />
                    </specify>
                </create>
            </derivation>
        </Attribute>

        <Attribute name="reasonSkipped">
            <type>
                <codetableentry table="VerificationSkippedReason" />
            </type>
            <derivation>
                <Code table="VerificationSkippedReason">
                    <String value="BDMVSR2001" />
                </Code>
            </derivation>
        </Attribute>

        <Attribute name="legalStatusEvidenceRecord">
            <type>
                <ruleclass name="BDMOASLegalStatus"
                    ruleset="BDMOASLegalStatusVerDataRuleSet" />
            </type>
            <derivation>
                <singleitem onMultiple="returnFirst"
                    onEmpty="returnNull">
                    <readall ruleclass="BDMOASLegalStatus"
                        ruleset="BDMOASLegalStatusVerDataRuleSet">
                        <match
                            retrievedattribute="evidenceDescriptorID">
                            <reference
                                attribute="evidenceDescriptorID">
                                <reference
                                    attribute="verificationDeterminatorParams" />
                            </reference>
                        </match>
                    </readall>
                </singleitem>
            </derivation>
        </Attribute>
        
        <!-- Check for exception conditions only if needToVerify is true -->
        <Attribute name="isLegalStatusVerificationRequired">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="Boolean" />
                    </type>
                    <when>
                        <condition>
                            <reference attribute="needToVerify" />
                        </condition>
                        <value>
                            <not>
                                <reference attribute="areExceptionConditionsMet" />
                            </not>
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <false />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>
        
        <!-- Verification checks need to be performed only if legal status is neither of "Presumed Met", "Legacy Approved" -->
        <Attribute name="needToVerify">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="Boolean" />
                    </type>
                    <test>
                        <reference attribute="legalStatus">
                            <reference attribute="legalStatusEvidenceRecord" />
                        </reference>
                    </test>
                    <!-- Presumed Met -->
                    <when>
                        <condition>
                            <Code table="BDMOASLegalStatus">
                                <String value="LST7" />
                            </Code>
                        </condition>
                        <value>
                            <false />
                        </value>
                    </when>
                    <!-- Legacy Approved -->
                    <when>
                        <condition>
                            <Code table="BDMOASLegalStatus">
                                <String value="LST8" />
                            </Code>
                        </condition>
                        <value>
                            <false />
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <true />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>

        <!-- Exception conditions from 1 to 3 as per the verficiation decision tables, 
            exception condition 4 is covered in needToVerify attribute derivation -->
        <Attribute name="areExceptionConditionsMet">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <any>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <reference attribute="verificationExceptioncondition1Met" />
                            <reference attribute="verificationExceptioncondition2Met" />
                            <reference attribute="verificationExceptioncondition3Met" />
                        </members>
                    </fixedlist>
                </any>
            </derivation>
        </Attribute>
        
        <Attribute name="verificationExceptioncondition1Met">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <all>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <reference attribute="isVerificationExceptionLegalStatus" />
                            <reference attribute="isCanadianResidentialAddressOnCurrentDate" />
                            <reference attribute="doesNotHaveSponsorship" />
                        </members>
                    </fixedlist>
                </all>
            </derivation>
        </Attribute>
        
        <!-- Check of the legal statuses which can have verification exception, 
            they are "Canadian Citizen", "Permanent Resident", "Indian Status"-->
        <Attribute name="isVerificationExceptionLegalStatus">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <any>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <!-- Canadian Citizen -->
                            <equals>
                                <Code table="BDMOASLegalStatus">
                                    <String value="LST1" />
                                </Code>
                                <reference attribute="legalStatus">
                                    <reference attribute="legalStatusEvidenceRecord" />
                                </reference>
                            </equals>
                            <!-- Permanent Resident -->
                            <equals>
                                <Code table="BDMOASLegalStatus">
                                    <String value="LST2" />
                                </Code>
                                <reference attribute="legalStatus">
                                    <reference attribute="legalStatusEvidenceRecord" />
                                </reference>
                            </equals>
                            <!-- Indian Status -->
                            <equals>
                                <Code table="BDMOASLegalStatus">
                                    <String value="LST5" />
                                </Code>
                                <reference attribute="legalStatus">
                                    <reference attribute="legalStatusEvidenceRecord" />
                                </reference>
                            </equals>
                        </members>
                    </fixedlist>
                </any>
            </derivation>
        </Attribute>

        <Attribute name="isCanadianResidentialAddressOnCurrentDate">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <property name="valueOn">
                    <object>
                        <reference attribute="isCanadianResidentialAddressTimeline">
                            <reference attribute="participantCalculator" />
                        </reference>
                    </object>
                    <arguments>
                        <call class="curam.ca.gc.bdm.creole.impl.Statics"
                            method="getCurrentDate">
                            <type>
                                <javaclass name="curam.util.type.Date" />
                            </type>
                        </call>
                    </arguments>
                </property>
            </derivation>
        </Attribute>
        
        <Attribute name="doesNotHaveSponsorship">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <any>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <property name="isEmpty">
                                <object>
                                    <reference attribute="sponsorshipRecordList">
                                        <reference attribute="caseParticipantData">
                                            <reference attribute="participantCalculator" />
                                        </reference>
                                    </reference>
                                </object>
                            </property>
                            <equals>
                                <!-- No -->
                                <Code table="BDMYesNo">
                                    <String value="BOASYN002" />
                                </Code>
                                <reference attribute="isSponsored">
                                    <property name="get">
                                        <object>
                                            <reference attribute="sponsorshipRecordList">
                                                <reference attribute="caseParticipantData">
                                                    <reference attribute="participantCalculator" />
                                                </reference>
                                            </reference>
                                        </object>
                                        <arguments>
                                            <property name="intValue">
                                                <object>
                                                    <Number value="0" />
                                                </object>
                                            </property>
                                        </arguments>
                                    </property>
                                </reference>
                            </equals>
                        </members>
                    </fixedlist>
                </any>
            </derivation>
        </Attribute>

        <Attribute name="participantCalculator">
            <type>
                <ruleclass name="BDMOASParticipantCalculator"
                    ruleset="BDMOASParticipantCalculatorRuleSet" />
            </type>
            <derivation>
                <create ruleclass="BDMOASParticipantCalculator"
                    ruleset="BDMOASParticipantCalculatorRuleSet">
                    <reference attribute="caseParticipantRoleID">
                        <reference attribute="legalStatusEvidenceRecord" />
                    </reference>
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="verificationExceptioncondition2Met">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <all>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <reference attribute="isVerificationExceptionLegalStatus" />
                            <not>
                                <reference attribute="isCanadianResidentialAddressOnCurrentDate" />
                            </not>
                            <reference attribute="isBornInCanada" />
                            <reference attribute="residenceCheckInfoExists">
                                <reference attribute="residenceHelper" />
                            </reference>
                            <reference attribute="requiredResidenceHistoryPresent">
                                <reference attribute="residenceHelper" />
                            </reference>
                            <compare comparison="&lt;">
                                <reference attribute="nonResidenceYears">
                                    <reference attribute="residenceHelper" />
                                </reference>
                                <Number value="5" />
                            </compare>
                        </members>
                    </fixedlist>
                </all>
            </derivation>
        </Attribute>
        
        <Attribute name="isBornInCanada">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <all>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <not>
                                <equals>
                                    <null />
                                    <reference attribute="birthAndDeathDetailsRecord">
                                        <reference attribute="caseParticipantData">
                                            <reference attribute="participantCalculator" />
                                        </reference>
                                    </reference>
                                </equals>
                            </not>
                            <not>
                                <equals>
                                    <null />
                                    <reference attribute="countryOfBirth">
                                        <reference attribute="birthAndDeathDetailsRecord">
                                            <reference attribute="caseParticipantData">
                                                <reference attribute="participantCalculator" />
                                            </reference>
                                        </reference>
                                    </reference>
                                </equals>
                            </not>
                            <equals>
                                <Code table="Country">
                                    <String value="CA" />
                                </Code>
                                <reference attribute="countryOfBirth">
                                    <reference attribute="birthAndDeathDetailsRecord">
                                        <reference attribute="caseParticipantData">
                                            <reference attribute="participantCalculator" />
                                        </reference>
                                    </reference>
                                </reference>
                            </equals>
                        </members>
                    </fixedlist>
                </all>
            </derivation>
        </Attribute>
        
        <Attribute name="residenceHelper">
            <type>
                <ruleclass name="ResidenceHelper"/>
            </type>
            <derivation>
                <create ruleclass="ResidenceHelper">
                    <reference attribute="caseParticipantRoleID">
                        <reference attribute="legalStatusEvidenceRecord" />
                    </reference>
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="verificationExceptioncondition3Met">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <all>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <reference attribute="isVerificationExceptionLegalStatus" />
                            <not>
                                <reference attribute="isCanadianResidentialAddressOnCurrentDate" />
                            </not>
                            <reference attribute="isBornInCanada" />
                            <reference attribute="residenceCheckInfoExists">
                                <reference attribute="residenceHelper" />
                            </reference>
                            <reference attribute="requiredResidenceHistoryPresent">
                                <reference attribute="residenceHelper" />
                            </reference>
                            <not>
                                <reference attribute="isResidenceCountryChangingFromForeignToCanada">
                                    <reference attribute="residenceHelper" />
                                </reference>
                            </not>
                        </members>
                    </fixedlist>
                </all>
            </derivation>
        </Attribute>
    </Class>
    
    <!-- Helper class for residence period evidence calculations -->
    <Class name="ResidenceHelper">
        <Initialization>
            <Attribute name="caseParticipantRoleID">
                <type>
                    <javaclass name="Number" />
                </type>
            </Attribute>
        </Initialization>
        
        <Attribute name="residenceCalculator">
            <type>
                <ruleclass name="BDMOASResidenceCalculator" ruleset="BDMOASResidenceCalculatorRuleSet" />
            </type>
            <derivation>
                <create ruleclass="BDMOASResidenceCalculator" ruleset="BDMOASResidenceCalculatorRuleSet">
                    <reference attribute="caseParticipantRoleID" />
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="applicationHelper">
            <type >
                <ruleclass name="ApplicationHelper"/>
            </type>
            <derivation>
                <create ruleclass="ApplicationHelper">
                    <reference attribute="caseParticipantRoleID" />
                </create>
            </derivation>
        </Attribute>

        <Attribute name="participantCalculator">
            <type>
                <ruleclass name="BDMOASParticipantCalculator"
                    ruleset="BDMOASParticipantCalculatorRuleSet" />
            </type>
            <derivation>
                <create ruleclass="BDMOASParticipantCalculator"
                    ruleset="BDMOASParticipantCalculatorRuleSet">
                    <reference attribute="caseParticipantRoleID" />
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="eighteenthBirthdayDate">
            <type>
                <javaclass name="curam.util.type.Date" />
            </type>
            <derivation>
                <call class="curam.ca.gc.bdm.creole.impl.Statics"
                    method="addYearsToDate">
                    <type>
                        <javaclass name="curam.util.type.Date" />
                    </type>
                    <arguments>
                        <reference attribute="dateOfBirth">
                            <reference attribute="participantCalculator" />
                        </reference>
                        <Number value="18" />
                    </arguments>
                </call>
            </derivation>
        </Attribute>
        
        <!-- Check for existence of Residence Period Evidence and active Application Details Evidence -->
        <Attribute name="residenceCheckInfoExists">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <all>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <reference attribute="isAnyResidencePeriodPresent">
                                <reference attribute="residenceCalculator" />
                            </reference>
                            <reference attribute="activeApplicationExists">
                                <reference attribute="applicationHelper" />
                            </reference>
                        </members>
                    </fixedlist>
                </all>
            </derivation>
        </Attribute>
        
        <!-- True for period between 18th birthday to Application Date -->
        <Attribute name="isResidenceRequiredTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Boolean" />
                </javaclass>
            </type>
            <derivation>
                <existencetimeline>
                    <intervaltype>
                        <javaclass name="Boolean" />
                    </intervaltype>
                    <intervalfromdate>
                        <reference attribute="eighteenthBirthdayDate" />
                    </intervalfromdate>
                    <intervaltodate>
                        <reference attribute="earliestDateOfApplication">
                            <reference attribute="applicationHelper" />
                        </reference>
                    </intervaltodate>
                    <preExistenceValue>
                        <false />
                    </preExistenceValue>
                    <existenceValue>
                        <true />
                    </existenceValue>
                    <postExistenceValue>
                        <false />
                    </postExistenceValue>
                </existencetimeline>
            </derivation>
        </Attribute>
        
        <!-- True when residence period information is present for the entire residence required period -->
        <Attribute name="requiredResidenceHistoryPresent">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <equals>
                    <timelineoperation>
                        <all>
                            <fixedlist>
                                <listof>
                                    <javaclass name="Boolean" />
                                </listof>
                                <members>
                                    <intervalvalue>
                                        <reference attribute="isResidenceRequiredTimeline" />
                                    </intervalvalue>
                                    <intervalvalue>
                                        <reference
                                            attribute="residenceHistoryExistsTimeline">
                                            <reference attribute="residenceCalculator" />
                                        </reference>
                                    </intervalvalue>
                                </members>
                            </fixedlist>
                        </all>
                    </timelineoperation>
                    <reference attribute="isResidenceRequiredTimeline" />
                </equals>
            </derivation>
        </Attribute>
        
        <!-- Residence Period records with country not as Canada -->
        <Attribute name="canadianIneligiblePeriodList">
            <type>
                <javaclass name="List">
                    <ruleclass name="ResidencePeriodObject" ruleset="BDMOASResidenceCalculatorRuleSet"/>
                </javaclass>
            </type>
            <derivation>
                <filter>
                    <list>
                        <reference attribute="residencePeriodObjectList">
                            <reference attribute="residenceCalculator" />
                        </reference>
                    </list>
                    <listitemexpression>
                        <not>
                            <equals>
                                <Code table="Country">
                                    <String value="CA" />
                                </Code>
                                <reference attribute="country">
                                    <reference attribute="evidence">
                                        <current />
                                    </reference>
                                </reference>
                            </equals>
                        </not>
                    </listitemexpression>
                </filter>
            </derivation>
        </Attribute>
        
        <!-- Total non canadian residence in years timeline -->
        <Attribute name="aggregateNonResidenceYearTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Number" />
                </javaclass>
            </type>
            <derivation>
                <call class="curam.ca.gc.bdmoas.creole.impl.Statics"
                    method="getAggregateResidenceTimeline">
                    <type>
                        <javaclass name="curam.creole.value.Timeline">
                            <javaclass name="Number" />
                        </javaclass>
                    </type>
                    <arguments>
                        <reference attribute="canadianIneligiblePeriodList" />
                        <reference attribute="earliestDateOfApplication">
                            <reference attribute="applicationHelper" />
                        </reference>
                    </arguments>
                </call>
            </derivation>
        </Attribute>
        
        <!-- Non Candian residence in years on application date -->
        <Attribute name="nonResidenceYears">
            <type>
                <javaclass name="Number" />
            </type>
            <derivation>
                <property name="valueOn">
                    <object>
                        <reference attribute="aggregateNonResidenceYearTimeline" />
                    </object>
                    <arguments>
                        <reference attribute="earliestDateOfApplication">
                            <reference attribute="applicationHelper" />
                        </reference>
                    </arguments>
                </property>
            </derivation>
        </Attribute>
        
        <!-- Residence period country is Canada timeline -->
        <Attribute name="isCanadianResidenceTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Boolean" />
                </javaclass>
            </type>
            <derivation>
                <Timeline>
                    <intervaltype>
                        <javaclass name="Boolean" />
                    </intervaltype>
                    <initialvalue>
                        <false />
                    </initialvalue>
                    <intervals>
                        <dynamiclist>
                            <list>
                                <reference attribute="residencePeriodObjectList">
                                    <reference attribute="residenceCalculator" />
                                </reference>
                            </list>
                            <listitemexpression>
                                <Interval>
                                    <intervaltype>
                                        <javaclass name="Boolean" />
                                    </intervaltype>
                                    <start>
                                        <reference attribute="startDate">
                                            <current />
                                        </reference>
                                    </start>
                                    <value>
                                        <equals>
                                            <Code table="Country">
                                                <String value="CA" />
                                            </Code>
                                            <reference attribute="country">
                                                <reference attribute="evidence">
                                                    <current />
                                                </reference>
                                            </reference>
                                        </equals>
                                    </value>
                                </Interval>
                            </listitemexpression>
                        </dynamiclist>
                    </intervals>
                </Timeline>
            </derivation>
        </Attribute>
        
        <!-- Loop residence period records to check if there is a change in country from Foreign to Canada,
         by comparing current record's country to isCanadianResidenceTimeline value on the day after current record's 
         end date (i.e., next residence period start date)-->
        <Attribute name="isResidenceCountryChangingFromForeignToCanada">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <any>
                    <dynamiclist>
                        <list>
                            <reference attribute="residencePeriodObjectList">
                                <reference attribute="residenceCalculator" />
                            </reference>
                        </list>
                        <listitemexpression>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <not>
                                            <equals>
                                                <Code table="Country">
                                                    <String value="CA" />
                                                </Code>
                                                <reference attribute="country">
                                                    <reference attribute="evidence">
                                                        <current />
                                                    </reference>
                                                </reference>
                                            </equals>
                                        </not>
                                        <not>
                                            <equals>
                                                <null />
                                                <reference attribute="endDate">
                                                    <current />
                                                </reference>
                                            </equals>
                                        </not>
                                        <property name="valueOn">
                                            <object>
                                                <reference attribute="isCanadianResidenceTimeline" />
                                            </object>
                                            <arguments>
                                                <property name="addDays">
                                                    <object>
                                                        <reference attribute="endDate">
                                                            <current />
                                                        </reference>
                                                    </object>
                                                    <arguments>
                                                        <property name="intValue">
                                                            <object>
                                                                <Number value="1" />
                                                            </object>
                                                        </property>
                                                    </arguments>
                                                </property>
                                            </arguments>
                                        </property>
                                    </members>
                                </fixedlist>
                            </all>
                        </listitemexpression>
                    </dynamiclist>
                </any>
            </derivation>
        </Attribute>
    </Class>
    
    <!-- Helper class for Application Details evidence calculations -->
    <Class name="ApplicationHelper">
        <Initialization>
            <Attribute name="caseParticipantRoleID">
                <type>
                    <javaclass name="Number" />
                </type>
            </Attribute>
        </Initialization>
        
        <Attribute name="oasApplicationCalculator">
            <type>
                <ruleclass name="BDMOASApplicationCalculator" ruleset="BDMOASApplicationCalculatorRuleSet" />
            </type>
            <derivation>
                <create ruleclass="BDMOASApplicationCalculator" ruleset="BDMOASApplicationCalculatorRuleSet">
                    <reference attribute="caseParticipantRoleID" />
                    <Code table="BDMOASBenefitType">
                        <String value="BT1" />
                    </Code>
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="gisApplicationCalculator">
            <type>
                <ruleclass name="BDMOASApplicationCalculator" ruleset="BDMOASApplicationCalculatorRuleSet" />
            </type>
            <derivation>
                <create ruleclass="BDMOASApplicationCalculator" ruleset="BDMOASApplicationCalculatorRuleSet">
                    <reference attribute="caseParticipantRoleID" />
                    <Code table="BDMOASBenefitType">
                        <String value="BT2" />
                    </Code>
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="alwAlwsApplicationCalculator">
            <type>
                <ruleclass name="BDMOASApplicationCalculator" ruleset="BDMOASApplicationCalculatorRuleSet" />
            </type>
            <derivation>
                <create ruleclass="BDMOASApplicationCalculator" ruleset="BDMOASApplicationCalculatorRuleSet">
                    <reference attribute="caseParticipantRoleID" />
                    <Code table="BDMOASBenefitType">
                        <String value="BT3" />
                    </Code>
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="activeApplicationList">
            <type>
                <javaclass name="List">
                    <ruleclass name="BDMOASApplication" ruleset="BDMOASApplicationCalculatorRuleSet"/>
                </javaclass>
            </type>
            <derivation>
                <joinlists>
                    <dynamiclist>
                        <list>
                            <fixedlist>
                                <listof>
                                    <ruleclass name="BDMOASApplicationCalculator" ruleset="BDMOASApplicationCalculatorRuleSet" />
                                </listof>
                                <members>
                                    <reference attribute="oasApplicationCalculator" />
                                    <reference attribute="gisApplicationCalculator" />
                                    <reference attribute="alwAlwsApplicationCalculator" />
                                </members>
                            </fixedlist>
                        </list>
                        <listitemexpression>
                            <reference attribute="activeApplicationList">
                                <current />
                            </reference>
                        </listitemexpression>
                    </dynamiclist>
                </joinlists>
            </derivation>
        </Attribute>
        
        <Attribute name="activeApplicationExists">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <not>
                <property name="isEmpty">
                    <object>
                        <reference attribute="activeApplicationList" />
                    </object>
                </property>
                </not>
            </derivation>
        </Attribute>
        
        <Attribute name="earliestDateOfApplication">
            <type>
                <javaclass name="curam.util.type.Date" />
            </type>
            <derivation>
                <reference attribute="dateOfApplication">
                    <singleitem onMultiple="returnFirst" onEmpty="error">
                        <sort>
                            <list>
                                <reference attribute="activeApplicationList" />
                            </list>
                            <sortorder>
                                <sortitem direction="ascending">
                                    <reference attribute="dateOfApplication">
                                        <current />
                                    </reference>
                                </sortitem>
                            </sortorder>
                        </sort>
                    </singleitem>
                </reference>
            </derivation>
        </Attribute>
    </Class>
</RuleSet>