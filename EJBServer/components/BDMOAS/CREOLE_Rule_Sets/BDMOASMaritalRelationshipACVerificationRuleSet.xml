<?xml version="1.0" encoding="UTF-8"?>
<RuleSet name="BDMOASMaritalRelationshipACVerificationRuleSet"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
    <Class extends="VerificationDeterminator"
        extendsRuleSet="VerificationRuleSet"
        name="BDMOASMaritalRelationshipACVerificationDeterminator">

        <Attribute name="displayName">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <XmlMessage>BDMOASMaritalRelationshipACVerification</XmlMessage>
            </derivation>
        </Attribute>

        <Attribute name="determine">
            <type>
                <ruleclass
                    name="VerificationDeterminatorResult"
                    ruleset="VerificationRuleSet" />
            </type>
            <derivation>
                <create
                    ruleclass="VerificationDeterminatorResult"
                    ruleset="VerificationRuleSet">
                    <specify attribute="result">
                        <reference attribute="isVerificationRequired" />
                    </specify>
                    <specify attribute="reason">
                        <reference attribute="reasonSkipped" />
                    </specify>
                </create>
            </derivation>
        </Attribute>

        <Attribute name="reasonSkipped">
            <type>
                <codetableentry table="VerificationSkippedReason" />
            </type>
            <derivation>
                <Code table="VerificationSkippedReason">
                    <String value="BDMVSR2001" />
                </Code>
            </derivation>
        </Attribute>

        <Attribute name="maritalRelationshipEvidenceRecord">
            <type>
                <ruleclass name="BDMOASMaritalRelationship"
                    ruleset="BDMOASMaritalRelationshipVerDataRuleSet" />
            </type>
            <derivation>
                <singleitem onMultiple="returnFirst"
                    onEmpty="returnNull">
                    <readall ruleclass="BDMOASMaritalRelationship"
                        ruleset="BDMOASMaritalRelationshipVerDataRuleSet">
                        <match
                            retrievedattribute="evidenceDescriptorID">
                            <reference
                                attribute="evidenceDescriptorID">
                                <reference
                                    attribute="verificationDeterminatorParams" />
                            </reference>
                        </match>
                    </readall>
                </singleitem>
            </derivation>
        </Attribute>
        
        <Attribute name="isVerificationRequired">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <not>
                    <any>
                        <fixedlist>
                            <listof>
                                <javaclass name="Boolean" />
                            </listof>
                            <members>
                                <reference attribute="verificationExceptionCondition1Met" />
                                <reference attribute="verificationExceptionCondition2Met" />
                                <reference attribute="verificationExceptionCondition3Met" />
                            </members>
                        </fixedlist>
                    </any>
                </not>
            </derivation>
        </Attribute>
        
        <Attribute name="verificationExceptionCondition1Met">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <all>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <reference attribute="isRelationshipStatusMarriedOrCommonLaw" />
                            <reference attribute="isRelationshipChangeTypeEmpty" />
                            <reference attribute="isPrimaryParticipantOASPensionAppDetailsPresentOnIC">
                                <reference attribute="icApplicationDetailsHelper" />
                            </reference>
                            <reference attribute="isSpouseParticipantOASPensionAppDetailsPresentOnIC">
                                <reference attribute="icApplicationDetailsHelper" />
                            </reference>
                        </members>
                    </fixedlist>
                </all>
            </derivation>
        </Attribute>
        
        <Attribute name="isRelationshipStatusMarriedOrCommonLaw">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <any>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <equals>
                                <Code table="BDMOASMaritalRelation">
                                    <String value="MR1" />
                                </Code>
                                <reference attribute="relationshipStatus">
                                    <reference attribute="maritalRelationshipEvidenceRecord" />
                                </reference>
                            </equals>
                            <equals>
                                <Code table="BDMOASMaritalRelation">
                                    <String value="MR2" />
                                </Code>
                                <reference attribute="relationshipStatus">
                                    <reference attribute="maritalRelationshipEvidenceRecord" />
                                </reference>
                            </equals>
                        </members>
                    </fixedlist>
                </any>
            </derivation>
        </Attribute>
        
        <Attribute name="isRelationshipChangeTypeEmpty">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <equals>
                    <Code table="BDMOASMaritalChangeType">
                        <String value="" />
                    </Code>
                    <reference attribute="relationshipChangeType">
                        <reference attribute="maritalRelationshipEvidenceRecord" />
                    </reference>
                </equals>
            </derivation>
        </Attribute>
        
        <Attribute name="verificationExceptionCondition2Met">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <all>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <reference attribute="isCRAMaritalStatusMatchesMaritalRelationshipStatus">
                                <reference attribute="craMaritalStatusHelper" />
                            </reference>
                            <reference attribute="isRelationshipStatusMarriedOrCommonLaw" />
                            <reference attribute="isRelationshipChangeTypeEmpty" />
                            <reference attribute="isMaritalRelStartDateLaterThan12MonthsPriorToAppReceiptDate">
                                <reference attribute="acApplicationDetailsHelper" />
                            </reference>
                            <reference attribute="isResidentialAddressSame">
                                <reference attribute="addressHelper" />
                            </reference>
                        </members>
                    </fixedlist>
                </all>
            </derivation>
        </Attribute>
        
        <Attribute name="verificationExceptionCondition3Met">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <any>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <!-- Marital Relationship Status is Married and Marital Relationship Change Type is Divorce. -->
                                        <equals>
                                            <!-- Married -->
                                            <Code table="BDMOASMaritalRelation">
                                                <String value="MR1" />
                                            </Code>
                                            <reference attribute="relationshipStatus">
                                                <reference attribute="maritalRelationshipEvidenceRecord" />
                                            </reference>
                                        </equals>
                                        <not>
                                            <reference attribute="isRelationshipChangeTypeEmpty" />
                                        </not>
                                        <equals>
                                            <!-- Divorce -->
                                            <Code table="BDMOASMaritalChangeType">
                                                <String value="MCT1" />
                                            </Code>
                                            <reference attribute="relationshipChangeType">
                                                <reference attribute="maritalRelationshipEvidenceRecord" />
                                            </reference>
                                        </equals>
                                        <!-- Marital Status End Date is greater than or equal to the first day of the 12 months prior to application date of receipt -->
                                        <reference attribute="isMaritalRelEndDateLaterThan12MonthsPriorToAppReceiptDate">
                                            <reference attribute="acApplicationDetailsHelper" />
                                        </reference>
                                    </members>
                                </fixedlist>
                            </all>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <!-- Marital Relationship Status is Married or Common-Law and Marital Relationship Change Type is Death. -->
                                        <reference attribute="isRelationshipStatusMarriedOrCommonLaw" />
                                        <not>
                                            <reference attribute="isRelationshipChangeTypeEmpty" />
                                        </not>
                                        <equals>
                                            <!-- Death -->
                                            <Code table="BDMOASMaritalChangeType">
                                                <String value="MCT2" />
                                            </Code>
                                            <reference attribute="relationshipChangeType">
                                                <reference attribute="maritalRelationshipEvidenceRecord" />
                                            </reference>
                                        </equals>
                                        <!-- Marital Status End Date is greater than or equal to the first day of the 12 months prior to application date of receipt -->
                                        <reference attribute="isMaritalRelEndDateLaterThan12MonthsPriorToAppReceiptDate">
                                            <reference attribute="acApplicationDetailsHelper" />
                                        </reference>
                                    </members>
                                </fixedlist>
                            </all>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <!-- Marital Relationship Status is Married and Marital Relationship Change Type is Separated -->
                                        <equals>
                                            <!-- Married -->
                                            <Code table="BDMOASMaritalRelation">
                                                <String value="MR1" />
                                            </Code>
                                            <reference attribute="relationshipStatus">
                                                <reference attribute="maritalRelationshipEvidenceRecord" />
                                            </reference>
                                        </equals>
                                        <not>
                                            <reference attribute="isRelationshipChangeTypeEmpty" />
                                        </not>
                                        <equals>
                                            <!-- Separated -->
                                            <Code table="BDMOASMaritalChangeType">
                                                <String value="MCT3" />
                                            </Code>
                                            <reference attribute="relationshipChangeType">
                                                <reference attribute="maritalRelationshipEvidenceRecord" />
                                            </reference>
                                        </equals>
                                        <!-- Marital Status Effective Date is greater than or equal to the first day of the 12 months prior to application date of receipt -->
                                        <reference attribute="isMaritalRelEffectiveDateLaterThan12MonthsPriorToAppReceiptDate">
                                            <reference attribute="acApplicationDetailsHelper" />
                                        </reference>
                                    </members>
                                </fixedlist>
                            </all>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <!-- Marital Relationship Status is Common-Law and Marital Relationship Change Type is Separated -->
                                        <equals>
                                            <!-- Common-Law -->
                                            <Code table="BDMOASMaritalRelation">
                                                <String value="MR2" />
                                            </Code>
                                            <reference attribute="relationshipStatus">
                                                <reference attribute="maritalRelationshipEvidenceRecord" />
                                            </reference>
                                        </equals>
                                        <not>
                                            <reference attribute="isRelationshipChangeTypeEmpty" />
                                        </not>
                                        <equals>
                                            <!-- Separated -->
                                            <Code table="BDMOASMaritalChangeType">
                                                <String value="MCT3" />
                                            </Code>
                                            <reference attribute="relationshipChangeType">
                                                <reference attribute="maritalRelationshipEvidenceRecord" />
                                            </reference>
                                        </equals>
                                        <!-- Marital Status End Date is greater than or equal to the first day of the 12 months prior to application date of receipt -->
                                        <reference attribute="isMaritalRelEndDateLaterThan12MonthsPriorToAppReceiptDate">
                                            <reference attribute="acApplicationDetailsHelper" />
                                        </reference>
                                    </members>
                                </fixedlist>
                            </all>
                        </members>
                    </fixedlist>
                </any>
            </derivation>
        </Attribute>
        
        <Attribute name="primaryParticipantRoleID">
            <Annotations />
            <type>
                <javaclass name="java.lang.Number" />
            </type>
            <derivation>
                <reference attribute="participantRoleID">
                    <reference attribute="related_caseParticipantRoleID">
                        <reference attribute="maritalRelationshipEvidenceRecord" />
                    </reference>
                </reference>
            </derivation>
        </Attribute>
        
        <Attribute name="spouseParticipantRoleID">
            <Annotations />
            <type>
                <javaclass name="java.lang.Number" />
            </type>
            <derivation>
                <reference attribute="participantRoleID">
                    <reference attribute="related_relatedCaseParticipantRoleID">
                        <reference attribute="maritalRelationshipEvidenceRecord" />
                    </reference>
                </reference>
            </derivation>
        </Attribute>
        
        <Attribute name="icApplicationDetailsHelper">
            <type >
                <ruleclass name="ICApplicationDetailsHelper"/>
            </type>
            <derivation>
                <create ruleclass="ICApplicationDetailsHelper">
                    <reference attribute="primaryParticipantRoleID" />
                    <reference attribute="spouseParticipantRoleID" />
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="acApplicationDetailsHelper">
            <type >
                <ruleclass name="ACApplicationDetailsHelper"/>
            </type>
            <derivation>
                <create ruleclass="ACApplicationDetailsHelper">
                    <reference attribute="related_caseParticipantRoleID">
                        <reference attribute="maritalRelationshipEvidenceRecord" />
                    </reference>
                    <reference attribute="maritalRelationshipEvidenceRecord" />
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="craMaritalStatusHelper">
            <type >
                <ruleclass name="CRAMaritalStatusHelper"/>
            </type>
            <derivation>
                <create ruleclass="CRAMaritalStatusHelper">
                    <reference attribute="related_caseParticipantRoleID">
                        <reference attribute="maritalRelationshipEvidenceRecord" />
                    </reference>
                    <reference attribute="relationshipStatus">
                        <reference attribute="maritalRelationshipEvidenceRecord" />
                    </reference>
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="addressHelper">
            <type>
                <ruleclass name="AddressHelper" />
            </type>
            <derivation>
                <create ruleclass="AddressHelper">
                    <reference attribute="related_caseParticipantRoleID">
                        <reference attribute="maritalRelationshipEvidenceRecord" />
                    </reference>
                    <reference attribute="related_relatedCaseParticipantRoleID">
                        <reference attribute="maritalRelationshipEvidenceRecord" />
                    </reference>
                </create>
            </derivation>
        </Attribute>
    </Class>
    
    <!-- Helper class for IC Application Details evidence calculations -->
    <Class name="ICApplicationDetailsHelper">
        <Initialization>
            <Attribute name="primaryParticipantRoleID">
                <type>
                    <javaclass name="java.lang.Number" />
                </type>
            </Attribute>
            <Attribute name="spouseParticipantRoleID">
                <type>
                    <javaclass name="java.lang.Number" />
                </type>
            </Attribute>
        </Initialization>
        
        <Attribute name="primaryParticipantIntegratedCaseHeaders">
            <type>
                <javaclass name="List">
                    <ruleclass name="CaseHeader" ruleset="CaseEntitiesRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <filter>
                    <list>
                        <readall ruleclass="CaseHeader" ruleset="CaseEntitiesRuleSet">
                            <match retrievedattribute="concernRoleID">
                                <reference attribute="primaryParticipantRoleID" />
                            </match>
                        </readall>
                    </list>
                    <listitemexpression>
                        <equals>
                            <reference attribute="caseTypeCode">
                                <current />
                            </reference>
                            <Code table="CaseTypeCode">
                                <String value="CT5" />
                            </Code>
                        </equals>
                    </listitemexpression>
                </filter>
            </derivation>
        </Attribute>
        
        <Attribute name="spouseParticipantIntegratedCaseHeaders">
            <type>
                <javaclass name="List">
                    <ruleclass name="CaseHeader" ruleset="CaseEntitiesRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <filter>
                    <list>
                        <readall ruleclass="CaseHeader" ruleset="CaseEntitiesRuleSet">
                            <match retrievedattribute="concernRoleID">
                                <reference attribute="spouseParticipantRoleID" />
                            </match>
                        </readall>
                    </list>
                    <listitemexpression>
                        <equals>
                            <reference attribute="caseTypeCode">
                                <current />
                            </reference>
                            <Code table="CaseTypeCode">
                                <String value="CT5" />
                            </Code>
                        </equals>
                    </listitemexpression>
                </filter>
            </derivation>
        </Attribute>
        
        <!-- Primary participant's active application details records from ICs with beneift type as OAS Pension and method of application as paper or online -->
        <Attribute name="primaryParticipantOASPensionApplicationDetailsRecords">
            <type>
                <javaclass name="List">
                    <ruleclass name="BDMOASApplicationDetails" ruleset="BDMOASApplicationDetailsDataRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <filter>
                    <list alias="applicationDetails">
                        <joinlists>
                            <dynamiclist>
                                <list alias="integratedCase">
                                    <reference attribute="primaryParticipantIntegratedCaseHeaders" />
                                </list>
                                <listitemexpression>
                                    <readall ruleclass="BDMOASApplicationDetails" ruleset="BDMOASApplicationDetailsDataRuleSet">
                                        <match retrievedattribute="caseID">
                                            <reference attribute="caseID">
                                                <current alias="integratedCase" />
                                            </reference>
                                        </match>
                                    </readall>
                                </listitemexpression>
                            </dynamiclist>
                        </joinlists>
                    </list>
                    <listitemexpression>
                        <all>
                            <fixedlist>
                                <listof>
                                    <javaclass name="Boolean" />
                                </listof>
                                <members>
                                    <equals>
                                        <Code table="BDMOASBenefitType">
                                            <String value="BT1" />
                                        </Code>
                                        <reference attribute="benefitType">
                                            <current alias="applicationDetails" />
                                        </reference>
                                    </equals>
                                    <any>
                                        <fixedlist>
                                            <listof>
                                                <javaclass name="Boolean" />
                                            </listof>
                                            <members>
                                                <equals>
                                                    <!-- Paper -->
                                                    <Code table="BDMOASMethodOfApplication">
                                                        <String value="MOA27001" />
                                                    </Code>
                                                    <reference attribute="methodOfApplication">
                                                        <current alias="applicationDetails" />
                                                    </reference>
                                                </equals>
                                                <!-- Online -->
                                                <equals>
                                                    <Code table="BDMOASMethodOfApplication">
                                                        <String value="MOA27000" />
                                                    </Code>
                                                    <reference attribute="methodOfApplication">
                                                        <current alias="applicationDetails" />
                                                    </reference>
                                                </equals>
                                            </members>
                                        </fixedlist>
                                    </any>
                                </members>
                            </fixedlist>
                        </all>
                    </listitemexpression>
                </filter>
            </derivation>
        </Attribute>
        
        Spouse participant's active application details records from ICs with beneift type as OAS Pension and method of application as paper or online
        <Attribute name="spouseParticipantOASPensionApplicationDetailsRecords">
            <type>
                <javaclass name="List">
                    <ruleclass name="BDMOASApplicationDetails" ruleset="BDMOASApplicationDetailsDataRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <filter>
                    <list alias="applicationDetails">
                        <joinlists>
                            <dynamiclist>
                                <list alias="integratedCase">
                                    <reference attribute="spouseParticipantIntegratedCaseHeaders" />
                                </list>
                                <listitemexpression>
                                    <readall ruleclass="BDMOASApplicationDetails" ruleset="BDMOASApplicationDetailsDataRuleSet">
                                        <match retrievedattribute="caseID">
                                            <reference attribute="caseID">
                                                <current alias="integratedCase" />
                                            </reference>
                                        </match>
                                    </readall>
                                </listitemexpression>
                            </dynamiclist>
                        </joinlists>
                    </list>
                    <listitemexpression>
                        <all>
                            <fixedlist>
                                <listof>
                                    <javaclass name="Boolean" />
                                </listof>
                                <members>
                                    <equals>
                                        <Code table="BDMOASBenefitType">
                                            <String value="BT1" />
                                        </Code>
                                        <reference attribute="benefitType">
                                            <current alias="applicationDetails" />
                                        </reference>
                                    </equals>
                                    <any>
                                        <fixedlist>
                                            <listof>
                                                <javaclass name="Boolean" />
                                            </listof>
                                            <members>
                                                <equals>
                                                    <!-- Paper -->
                                                    <Code table="BDMOASMethodOfApplication">
                                                        <String value="MOA27001" />
                                                    </Code>
                                                    <reference attribute="methodOfApplication">
                                                        <current alias="applicationDetails" />
                                                    </reference>
                                                </equals>
                                                <!-- Online -->
                                                <equals>
                                                    <Code table="BDMOASMethodOfApplication">
                                                        <String value="MOA27000" />
                                                    </Code>
                                                    <reference attribute="methodOfApplication">
                                                        <current alias="applicationDetails" />
                                                    </reference>
                                                </equals>
                                            </members>
                                        </fixedlist>
                                    </any>
                                </members>
                            </fixedlist>
                        </all>
                    </listitemexpression>
                </filter>
            </derivation>
        </Attribute>
        
        <Attribute name="isPrimaryParticipantOASPensionAppDetailsPresentOnIC">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <not>
                    <property name="isEmpty">
                        <object>
                            <reference attribute="primaryParticipantOASPensionApplicationDetailsRecords" />
                        </object>
                    </property>
                </not>
            </derivation>
        </Attribute>
        
        <Attribute name="isSpouseParticipantOASPensionAppDetailsPresentOnIC">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <not>
                    <property name="isEmpty">
                        <object>
                            <reference attribute="spouseParticipantOASPensionApplicationDetailsRecords" />
                        </object>
                    </property>
                </not>
            </derivation>
        </Attribute>
    </Class>
    
    <Class name="ACApplicationDetailsHelper">
        <Initialization>
            <Attribute name="caseParticipantRole">
                <type>
                    <ruleclass name="CaseParticipantRole"
                        ruleset="CaseEntitiesRuleSet" />
                </type>
            </Attribute>
            <Attribute name="maritalRelationshipEvidenceRecord">
                <type>
                    <ruleclass name="BDMOASMaritalRelationship"
                        ruleset="BDMOASMaritalRelationshipVerDataRuleSet" />
                </type>
            </Attribute>
        </Initialization>
        
        <Attribute name="applicationDetailsRecord">
            <type>
                <ruleclass name="BDMOASApplicationDetails" ruleset="BDMOASApplicationDetailsDataRuleSet"/>
            </type>
            <derivation>
                <singleitem onMultiple="returnFirst" onEmpty="returnNull">
                    <reference attribute="applicationDetailsRecordList">
                        <create ruleclass="BDMOASCaseParticipantData"
                            ruleset="BDMOASDataRuleSet">
                            <reference attribute="caseParticipantRoleID">
                                <reference attribute="caseParticipantRole" />
                            </reference>
                        </create>
                    </reference>
                </singleitem>
            </derivation>
        </Attribute>
        
        <Attribute name="isApplicationDetailsRecordExists">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <not>
                    <equals>
                        <null />
                        <reference attribute="applicationDetailsRecord" />
                    </equals>
                </not>
            </derivation>
        </Attribute>
        
        <!-- Marital Status Start Date is greater than or equal to the first day of the 12 months prior to application date of receipt -->
        <Attribute name="isMaritalRelStartDateLaterThan12MonthsPriorToAppReceiptDate">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="Boolean" />
                    </type>
                    <when>
                        <condition>
                            <reference attribute="isApplicationDetailsRecordExists" />
                        </condition>
                        <value>
                            <compare comparison="&gt;=">
                                <reference attribute="startDate">
                                    <reference attribute="maritalRelationshipEvidenceRecord" />
                                </reference>
                                <call class="curam.ca.gc.bdm.creole.impl.Statics" method="getSubsequentMonthStart">
                                    <type>
                                        <javaclass name="curam.util.type.Date" />
                                    </type>
                                    <arguments>
                                        <call class="curam.ca.gc.bdm.creole.impl.Statics" method="addMonthsToDate">
                                            <type>
                                                <javaclass name="curam.util.type.Date" />
                                            </type>
                                            <arguments>
                                                <reference attribute="receiptDate">
                                                    <reference attribute="applicationDetailsRecord" />
                                                </reference>
                                                <Number value="-13" />
                                            </arguments>
                                        </call>
                                    </arguments>
                                </call>
                            </compare>
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <false />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>
        
        <!-- Marital Status End Date is greater than or equal to the first day of the 12 months prior to application date of receipt -->
        <Attribute name="isMaritalRelEndDateLaterThan12MonthsPriorToAppReceiptDate">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="Boolean" />
                    </type>
                    <when>
                        <condition>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <reference
                                            attribute="isApplicationDetailsRecordExists" />
                                        <not>
                                            <equals>
                                                <null />
                                                <reference attribute="endDate">
                                                    <reference attribute="maritalRelationshipEvidenceRecord" />
                                                </reference>
                                            </equals>
                                        </not>
                                    </members>
                                </fixedlist>
                            </all>
                        </condition>
                        <value>
                            <compare comparison="&gt;=">
                                <reference attribute="endDate">
                                    <reference attribute="maritalRelationshipEvidenceRecord" />
                                </reference>
                                <call class="curam.ca.gc.bdm.creole.impl.Statics" method="getSubsequentMonthStart">
                                    <type>
                                        <javaclass name="curam.util.type.Date" />
                                    </type>
                                    <arguments>
                                        <call class="curam.ca.gc.bdm.creole.impl.Statics" method="addMonthsToDate">
                                            <type>
                                                <javaclass name="curam.util.type.Date" />
                                            </type>
                                            <arguments>
                                                <reference attribute="receiptDate">
                                                    <reference attribute="applicationDetailsRecord" />
                                                </reference>
                                                <Number value="-13" />
                                            </arguments>
                                        </call>
                                    </arguments>
                                </call>
                            </compare>
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <false />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>
        
        <!-- Marital Status Effective Date is greater than or equal to the first day of the 12 months prior to application date of receipt -->
        <Attribute name="isMaritalRelEffectiveDateLaterThan12MonthsPriorToAppReceiptDate">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="Boolean" />
                    </type>
                    <when>
                        <condition>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <reference
                                            attribute="isApplicationDetailsRecordExists" />
                                        <not>
                                            <equals>
                                                <null />
                                                <reference attribute="effectiveDate">
                                                    <reference attribute="maritalRelationshipEvidenceRecord" />
                                                </reference>
                                            </equals>
                                        </not>
                                    </members>
                                </fixedlist>
                            </all>
                        </condition>
                        <value>
                            <compare comparison="&gt;=">
                                <reference attribute="effectiveDate">
                                    <reference attribute="maritalRelationshipEvidenceRecord" />
                                </reference>
                                <call class="curam.ca.gc.bdm.creole.impl.Statics" method="getSubsequentMonthStart">
                                    <type>
                                        <javaclass name="curam.util.type.Date" />
                                    </type>
                                    <arguments>
                                        <call class="curam.ca.gc.bdm.creole.impl.Statics" method="addMonthsToDate">
                                            <type>
                                                <javaclass name="curam.util.type.Date" />
                                            </type>
                                            <arguments>
                                                <reference attribute="receiptDate">
                                                    <reference attribute="applicationDetailsRecord" />
                                                </reference>
                                                <Number value="-13" />
                                            </arguments>
                                        </call>
                                    </arguments>
                                </call>
                            </compare>
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <false />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>
    </Class>
    
    <Class name="CRAMaritalStatusHelper">
        <Initialization>
            <Attribute name="caseParticipantRole">
                <type>
                    <ruleclass name="CaseParticipantRole"
                        ruleset="CaseEntitiesRuleSet" />
                </type>
            </Attribute>
            <Attribute name="maritalRelationshipStatus">
                <type>
                    <codetableentry table="BDMOASMaritalRelation"/>
                </type>
            </Attribute>
        </Initialization>
        
        <Attribute name="craMartialStatusRecord">
            <type>
                <ruleclass name="BDMOASCRAMaritalStatus" ruleset="BDMOASCRAMaritalStatusDataRuleSet"/>
            </type>
            <derivation>
                <reference attribute="craMaritalStatusRecord">
                    <reference attribute="caseParticipantData">
                        <create ruleclass="BDMOASParticipantCalculator"
                            ruleset="BDMOASParticipantCalculatorRuleSet">
                            <reference attribute="caseParticipantRoleID">
                                <reference attribute="caseParticipantRole" />
                            </reference>
                        </create>
                    </reference>
                </reference>
            </derivation>
        </Attribute>
        
        <Attribute name="isCRAMaritalStatusRecordExists">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <not>
                    <equals>
                        <null />
                        <reference attribute="craMartialStatusRecord" />
                    </equals>
                </not>
            </derivation>
        </Attribute>
        
        <Attribute name="isCRAMaritalStatusMatchesMaritalRelationshipStatus">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="Boolean" />
                    </type>
                    <when>
                        <condition>
                            <reference attribute="isCRAMaritalStatusRecordExists" />
                        </condition>
                        <value>
                            <any>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <all>
                                            <fixedlist>
                                                <listof>
                                                    <javaclass name="Boolean" />
                                                </listof>
                                                <members>
                                                    <equals>
                                                        <Code table="BDMOASMaritalRelation">
                                                            <String value="MR1" />
                                                        </Code>
                                                        <reference attribute="maritalRelationshipStatus" />
                                                    </equals>
                                                    <equals>
                                                        <Code table="BDMOASCRAMaritalStatus">
                                                            <String value="MST2" />
                                                        </Code>
                                                        <reference attribute="maritalStatus">
                                                            <reference attribute="craMartialStatusRecord" />
                                                        </reference>
                                                    </equals>
                                                </members>
                                            </fixedlist>
                                        </all>
                                        <all>
                                            <fixedlist>
                                                <listof>
                                                    <javaclass name="Boolean" />
                                                </listof>
                                                <members>
                                                    <equals>
                                                        <Code table="BDMOASMaritalRelation">
                                                            <String value="MR2" />
                                                        </Code>
                                                        <reference attribute="maritalRelationshipStatus" />
                                                    </equals>
                                                    <equals>
                                                        <Code table="BDMOASCRAMaritalStatus">
                                                            <String value="MST3" />
                                                        </Code>
                                                        <reference attribute="maritalStatus">
                                                            <reference attribute="craMartialStatusRecord" />
                                                        </reference>
                                                    </equals>
                                                </members>
                                            </fixedlist>
                                        </all>
                                    </members>
                                </fixedlist>
                            </any>
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <false />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>
    </Class>
    
    <Class name="AddressHelper">
        <Initialization>
            <Attribute name="primaryCaseParticipantRole">
                <type>
                    <ruleclass name="CaseParticipantRole"
                        ruleset="CaseEntitiesRuleSet" />
                </type>
            </Attribute>
            <Attribute name="spouseCaseParticipantRole">
                <type>
                    <ruleclass name="CaseParticipantRole"
                        ruleset="CaseEntitiesRuleSet" />
                </type>
            </Attribute>
        </Initialization>

        <Attribute name="primaryParticipantCalculator">
            <type>
                <ruleclass name="BDMOASParticipantCalculator"
                    ruleset="BDMOASParticipantCalculatorRuleSet" />
            </type>
            <derivation>
                <create ruleclass="BDMOASParticipantCalculator"
                    ruleset="BDMOASParticipantCalculatorRuleSet">
                    <reference attribute="caseParticipantRoleID">
                        <reference attribute="primaryCaseParticipantRole" />
                    </reference>
                </create>
            </derivation>
        </Attribute>

        <Attribute name="spouseParticipantCalculator">
            <type>
                <ruleclass name="BDMOASParticipantCalculator"
                    ruleset="BDMOASParticipantCalculatorRuleSet" />
            </type>
            <derivation>
                <create ruleclass="BDMOASParticipantCalculator"
                    ruleset="BDMOASParticipantCalculatorRuleSet">
                    <reference attribute="caseParticipantRoleID">
                        <reference attribute="spouseCaseParticipantRole" />
                    </reference>
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="primaryResidentialAddressRecordList">
            <type>
                <javaclass name="List">
                    <ruleclass name="PDCAddress" ruleset="PDCAddressDataRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <reference attribute="residentialAddressRecordList">
                    <reference attribute="caseParticipantData">
                        <reference attribute="primaryParticipantCalculator" />
                    </reference>
                </reference>
            </derivation>
        </Attribute>
        
        <Attribute name="spouseResidentialAddressRecordList">
            <type>
                <javaclass name="List">
                    <ruleclass name="PDCAddress" ruleset="PDCAddressDataRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <reference attribute="residentialAddressRecordList">
                    <reference attribute="caseParticipantData">
                        <reference attribute="spouseParticipantCalculator" />
                    </reference>
                </reference>
            </derivation>
        </Attribute>
        
        <Attribute name="primaryAddressIDTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Number" />
                </javaclass>
            </type>
            <derivation>
                <Timeline>
                    <intervaltype>
                        <javaclass name="Number" />
                    </intervaltype>
                    <initialvalue>
                        <Number value="0" />
                    </initialvalue>
                    <intervals>
                        <dynamiclist>
                            <list>
                                <reference attribute="primaryResidentialAddressRecordList" />
                            </list>
                            <listitemexpression>
                                <Interval>
                                    <intervaltype>
                                        <javaclass name="Number" />
                                    </intervaltype>
                                    <start>
                                        <reference attribute="fromDate">
                                            <current />
                                        </reference>
                                    </start>
                                    <value>
                                        <reference attribute="address">
                                            <current />
                                        </reference>
                                    </value>
                                </Interval>
                            </listitemexpression>
                        </dynamiclist>
                    </intervals>
                </Timeline>
            </derivation>
        </Attribute>
        
        <Attribute name="spouseAddressIDTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Number" />
                </javaclass>
            </type>
            <derivation>
                <Timeline>
                    <intervaltype>
                        <javaclass name="Number" />
                    </intervaltype>
                    <initialvalue>
                        <Number value="0" />
                    </initialvalue>
                    <intervals>
                        <dynamiclist>
                            <list>
                                <reference attribute="spouseResidentialAddressRecordList" />
                            </list>
                            <listitemexpression>
                                <Interval>
                                    <intervaltype>
                                        <javaclass name="Number" />
                                    </intervaltype>
                                    <start>
                                        <reference attribute="fromDate">
                                            <current />
                                        </reference>
                                    </start>
                                    <value>
                                        <reference attribute="address">
                                            <current />
                                        </reference>
                                    </value>
                                </Interval>
                            </listitemexpression>
                        </dynamiclist>
                    </intervals>
                </Timeline>
            </derivation>
        </Attribute>
        
        <Attribute name="primaryCurrentResidentialAddressID">
            <type>
                <javaclass name="Number" />
            </type>
            <derivation>
                <property name="valueOn">
                    <object>
                        <reference attribute="primaryAddressIDTimeline" />
                    </object>
                    <arguments>
                        <call class="curam.ca.gc.bdm.creole.impl.Statics"
                            method="getCurrentDate">
                            <type>
                                <javaclass name="curam.util.type.Date" />
                            </type>
                        </call>
                    </arguments>
                </property>
            </derivation>
        </Attribute>
        
        <Attribute name="spouseCurrentResidentialAddressID">
            <type>
                <javaclass name="Number" />
            </type>
            <derivation>
                <property name="valueOn">
                    <object>
                        <reference attribute="spouseAddressIDTimeline" />
                    </object>
                    <arguments>
                        <call class="curam.ca.gc.bdm.creole.impl.Statics"
                            method="getCurrentDate">
                            <type>
                                <javaclass name="curam.util.type.Date" />
                            </type>
                        </call>
                    </arguments>
                </property>
            </derivation>
        </Attribute>
        
        <Attribute name="isResidentialAddressSame">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="Boolean" />
                    </type>
                    <when>
                        <condition>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <compare comparison="&gt;">
                                            <reference attribute="primaryCurrentResidentialAddressID" />
                                            <Number value="0" />
                                        </compare>
                                        <compare comparison="&gt;">
                                            <reference attribute="spouseCurrentResidentialAddressID" />
                                            <Number value="0" />
                                        </compare>
                                    </members>
                                </fixedlist>
                            </all>
                        </condition>
                        <value>
                            <call class="curam.ca.gc.bdmoas.creole.impl.Statics" method="isSimilarAddressByAddressIDs">
                                <type>
                                    <javaclass name="Boolean" />
                                </type>
                                <arguments>
                                    <reference attribute="primaryCurrentResidentialAddressID" />
                                    <reference attribute="spouseCurrentResidentialAddressID" />
                                </arguments>
                            </call>
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <false />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>
    </Class>
</RuleSet>