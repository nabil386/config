<?xml version="1.0" encoding="UTF-8"?>
<!-- 90159 DEV: Implement Benefit Suspension Evidence -->
<RuleSet name="BDMOASBenefitSuspensionValidationRuleSet"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
    <Class extends="DefaultEvidenceValidationResult" extendsRuleSet="EvidenceValidationRuleSet" name="ValidationResult">
        
       <Attribute name="description">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <ResourceMessage key="Description"
                    resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASBenefitSuspensionValidationRuleSet" />
            </derivation>
        </Attribute>
        <Attribute name="evidence">
            <type>
                <ruleclass
                    name="BDMOASBenefitSuspension"
                    ruleset="BDMOASBenefitSuspensionRuleSet" />
            </type>
            <derivation>
                <specified />
            </derivation>
        </Attribute>
        <Attribute name="standardValidations">
            <type>
                <javaclass name="java.util.List">
                    <ruleclass name="Validation"
                        ruleset="EvidenceValidationRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <fixedlist>
                    <listof>
                        <ruleclass name="Validation"
                            ruleset="EvidenceValidationRuleSet" />
                    </listof>
                    <members>
                        <reference attribute="oneSuspensionPerBenefitForAPeriodValidation" />
                    </members>
                </fixedlist>
            </derivation>
        </Attribute>

         <Attribute name="oneSuspensionPerBenefitForAPeriodValidation">
            <type>
                <ruleclass name="Validation"
                    ruleset="EvidenceValidationRuleSet" />
            </type>
            <derivation>
                <create ruleclass="Validation"
                    ruleset="EvidenceValidationRuleSet">
                    <reference
                        attribute="oneSuspensionPerBenefitForAPeriodValidationFailure" />
                    <reference
                        attribute="oneSuspensionPerBenefitForAPeriodValidationFailureMessage" />
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="oneSuspensionPerBenefitForAPeriodValidationFailureMessage">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <ResourceMessage
                    key="ERR_ONE_SUSPENSION_PER_BENEFIT_FOR_A_PERIOD"
                    resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASBenefitSuspensionValidationRuleSet" />
            </derivation>
        </Attribute>
        
        <Attribute name="oneSuspensionPerBenefitForAPeriodValidationFailure">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="Boolean" />
                    </type>
                    <when>
                        <condition>
                            <compare comparison="&gt;">
                                <property name="size">
                                    <object>
                                        <reference attribute="otherActiveInEditBenefitSuspensionEvidenceList"/>
                                    </object>
                                </property>
                                <Number value="0" />
                            </compare>
                        </condition>
                        <value>
                            <reference attribute="overlapFailure" />
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <false />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>
        
        <Attribute name="overlapFailure">
            <type>
                <javaclass name="java.lang.Boolean" />
            </type>
            <derivation>
                <any>
                    <dynamiclist>
                        <list>
                            <reference attribute="otherActiveInEditBenefitSuspensionObjects" />
                        </list>
                        <listitemexpression>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <!-- Period Overlap -->
                                        <any>
                                            <fixedlist>
                                                <listof>
                                                    <javaclass name="Boolean" />
                                                </listof>
                                                <members>
                                                    <property name="valueOn">
                                                        <object>
                                                            <reference attribute="existenceTimeline">
                                                                <current />
                                                            </reference>
                                                        </object>
                                                        <arguments>
                                                            <reference attribute="startDate">
                                                                <reference attribute="benefitSuspensionObject" />
                                                            </reference>
                                                        </arguments>
                                                    </property>
                                                    <property name="valueOn">
                                                        <object>
                                                            <reference attribute="existenceTimeline">
                                                                <current />
                                                            </reference>
                                                        </object>
                                                        <arguments>
                                                            <reference attribute="endDate">
                                                                <reference attribute="benefitSuspensionObject" />
                                                            </reference>
                                                        </arguments>
                                                    </property>
                                                    <property name="valueOn">
                                                        <object>
                                                            <reference attribute="existenceTimeline">
                                                                <reference attribute="benefitSuspensionObject" />
                                                            </reference>
                                                        </object>
                                                        <arguments>
                                                            <reference attribute="startDate">
                                                                <current />
                                                            </reference>
                                                        </arguments>
                                                    </property>
                                                    <property name="valueOn">
                                                        <object>
                                                            <reference attribute="existenceTimeline">
                                                                <reference attribute="benefitSuspensionObject" />
                                                            </reference>
                                                        </object>
                                                        <arguments>
                                                            <reference attribute="endDate">
                                                                <current />
                                                            </reference>
                                                        </arguments>
                                                    </property>
                                                </members>
                                            </fixedlist>
                                        </any>
                                        <!-- Suspension Status is Suspended -->
                                        <equals>
                                            <Code table="BDMOASSuspensionStatus">
                                                <String value="SST1" />
                                            </Code>
                                            <reference attribute="suspensionStatus">
                                                <reference attribute="benefitSuspensionObject" />
                                            </reference>
                                        </equals>
                                        <equals>
                                            <Code table="BDMOASSuspensionStatus">
                                                <String value="SST1" />
                                            </Code>
                                            <reference attribute="suspensionStatus">
                                                <current />
                                            </reference>
                                        </equals>
                                        <any>
                                            <fixedlist>
                                                <listof>
                                                    <javaclass name="Boolean" />
                                                </listof>
                                                <members>
                                                    <!-- Either other or this evidence Suspended Benefit is All Benefits -->
                                                    <equals>
                                                        <Code table="BDMOASSuspendedBenefit">
                                                            <String value="SBT1" />
                                                        </Code>
                                                        <reference attribute="suspendedBenefit">
                                                            <current />
                                                        </reference>
                                                    </equals>
                                                    <equals>
                                                        <Code table="BDMOASSuspendedBenefit">
                                                            <String value="SBT1" />
                                                        </Code>
                                                        <reference attribute="suspendedBenefit">
                                                            <reference attribute="benefitSuspensionObject" />
                                                        </reference>
                                                    </equals>
                                                    <!-- Either other or this evidence Suspended Benefit is a Income Tested Benefit which are below-->
                                                    <!-- Income-Tested Benefits, Guaranteed Income Supplement, Allowance, Allowance for the Survivor -->
                                                    <all>
                                                        <fixedlist>
                                                            <listof>
                                                                <javaclass name="Boolean" />
                                                            </listof>
                                                            <members>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT2" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <reference attribute="benefitSuspensionObject" />
                                                                    </reference>
                                                                </equals>
                                                                <!-- Income tested benefits check for other evidence record -->
                                                                <reference attribute="isIncomeTestedSuspendedBenefit">
                                                                    <current />
                                                                </reference>
                                                            </members>
                                                        </fixedlist>
                                                    </all>
                                                    <all>
                                                        <fixedlist>
                                                            <listof>
                                                                <javaclass name="Boolean" />
                                                            </listof>
                                                            <members>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT2" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <current />
                                                                    </reference>
                                                                </equals>
                                                                <!-- Income tested benefits check for this evidence record -->
                                                                <reference attribute="isIncomeTestedSuspendedBenefit">
                                                                    <reference attribute="benefitSuspensionObject" />
                                                                </reference>
                                                            </members>
                                                        </fixedlist>
                                                    </all>
                                                    <!-- Old Age Security Pension -->
                                                    <all>
                                                        <fixedlist>
                                                            <listof>
                                                                <javaclass name="Boolean" />
                                                            </listof>
                                                            <members>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT3" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <current />
                                                                    </reference>
                                                                </equals>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT3" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <reference attribute="benefitSuspensionObject" />
                                                                    </reference>
                                                                </equals>
                                                            </members>
                                                        </fixedlist>
                                                    </all>
                                                    <!-- Guaranteed Income Supplement -->
                                                    <all>
                                                        <fixedlist>
                                                            <listof>
                                                                <javaclass name="Boolean" />
                                                            </listof>
                                                            <members>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT4" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <current />
                                                                    </reference>
                                                                </equals>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT4" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <reference attribute="benefitSuspensionObject" />
                                                                    </reference>
                                                                </equals>
                                                            </members>
                                                        </fixedlist>
                                                    </all>
                                                    <!-- Allowance -->
                                                    <all>
                                                        <fixedlist>
                                                            <listof>
                                                                <javaclass name="Boolean" />
                                                            </listof>
                                                            <members>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT5" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <current />
                                                                    </reference>
                                                                </equals>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT5" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <reference attribute="benefitSuspensionObject" />
                                                                    </reference>
                                                                </equals>
                                                            </members>
                                                        </fixedlist>
                                                    </all>
                                                    <!-- Allowance for the Survivor -->
                                                    <all>
                                                        <fixedlist>
                                                            <listof>
                                                                <javaclass name="Boolean" />
                                                            </listof>
                                                            <members>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT6" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <current />
                                                                    </reference>
                                                                </equals>
                                                                <equals>
                                                                    <Code table="BDMOASSuspendedBenefit">
                                                                        <String value="SBT6" />
                                                                    </Code>
                                                                    <reference attribute="suspendedBenefit">
                                                                        <reference attribute="benefitSuspensionObject" />
                                                                    </reference>
                                                                </equals>
                                                            </members>
                                                        </fixedlist>
                                                    </all>
                                                </members>
                                            </fixedlist>
                                        </any>
                                    </members>
                                </fixedlist>
                            </all>
                        </listitemexpression>
                    </dynamiclist>
                </any>
            </derivation>
        </Attribute>
        
        <Attribute name="otherActiveInEditBenefitSuspensionEvidenceList">
            <type>
                <javaclass name="java.util.List">
                    <ruleclass name="BDMOASBenefitSuspension"
                        ruleset="BDMOASBenefitSuspensionVerDataRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <filter>
                    <list>
                        <readall ruleclass="BDMOASBenefitSuspension"
                            ruleset="BDMOASBenefitSuspensionVerDataRuleSet">
                            <match retrievedattribute="caseID">
                                <reference attribute="caseID">
                                    <reference attribute="evidence" />
                                </reference>
                            </match>
                        </readall>
                    </list>
                    <listitemexpression>
                        <all>
                            <fixedlist>
                                <listof>
                                    <javaclass name="Boolean" />
                                </listof>
                                <members>
                                    <equals>
                                        <reference attribute="caseParticipantRole">
                                            <current />
                                        </reference>
                                        <reference attribute="caseParticipantRole">
                                            <reference attribute="evidence" />
                                        </reference>
                                    </equals>
                                    <not>
                                        <equals>
                                            <reference attribute="successionID">
                                                <reference attribute="evidence" />
                                            </reference>
                                            <reference attribute="successionID">
                                                <current />
                                            </reference>
                                        </equals>
                                    </not>
                                </members>
                            </fixedlist>
                        </all>
                    </listitemexpression>
                </filter>
            </derivation>
        </Attribute>
        
        <Attribute name="otherActiveInEditBenefitSuspensionObjects">
        <type>
            <javaclass name="java.util.List">
                <ruleclass name="BenefitSuspensionObject" />
            </javaclass>
        </type>
        <derivation>
            <dynamiclist>
                <list>
                    <reference attribute="otherActiveInEditBenefitSuspensionEvidenceList" />
                </list>
                <listitemexpression>
                    <create ruleclass="BenefitSuspensionObject">
                        <reference attribute="suspendedBenefit">
                            <current />
                        </reference>
                        <reference attribute="suspensionStatus">
                            <current />
                        </reference>
                        <reference attribute="startDate">
                            <current />
                        </reference>
                        <reference attribute="endDate">
                            <current />
                        </reference>
                    </create>
                </listitemexpression>
            </dynamiclist>
        </derivation>
        </Attribute>
        
        <Attribute name="benefitSuspensionObject">
            <type>
                <ruleclass name="BenefitSuspensionObject" />
            </type>
            <derivation>
                <create ruleclass="BenefitSuspensionObject">
                    <reference attribute="suspendedBenefit">
                        <reference attribute="evidence" />
                    </reference>
                    <reference attribute="suspensionStatus">
                        <reference attribute="evidence" />
                    </reference>
                    <reference attribute="startDate">
                        <reference attribute="evidence" />
                    </reference>
                    <reference attribute="endDate">
                        <reference attribute="evidence" />
                    </reference>
                </create>
            </derivation>
        </Attribute>
         
        <Attribute name="preCreateValidations">
            <type>
                <javaclass name="java.util.List">
                    <ruleclass name="Validation"
                        ruleset="EvidenceValidationRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <fixedlist>
                    <listof>
                        <ruleclass name="Validation"
                            ruleset="EvidenceValidationRuleSet" />
                    </listof>
                    <members>
                        <reference attribute="suspendedOnCreateValidation" />
                    </members>
                </fixedlist>
            </derivation>
        </Attribute>
        
        <Attribute name="suspendedOnCreateValidation">
            <type>
                <ruleclass name="Validation"
                    ruleset="EvidenceValidationRuleSet" />
            </type>
            <derivation>
                <create ruleclass="Validation"
                    ruleset="EvidenceValidationRuleSet">
                    <reference
                        attribute="suspendedOnCreateValidationFailure" />
                    <reference
                        attribute="suspendedOnCreateValidationFailureMessage" />
                </create>
            </derivation>
        </Attribute>
        
        <Attribute name="suspendedOnCreateValidationFailure">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <not>
                    <equals>
                        <Code table="BDMOASSuspensionStatus">
                            <String value="SST1" />
                        </Code>
                        <reference attribute="suspensionStatus">
                            <reference attribute="evidence" />
                        </reference>
                    </equals>
                </not>
            </derivation>
        </Attribute>
        
        <Attribute name="suspendedOnCreateValidationFailureMessage">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <ResourceMessage
                    key="ERR_INITIAL_SUSPENSION_STATUS"
                    resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASBenefitSuspensionValidationRuleSet" />
            </derivation>
        </Attribute>
        
    </Class>
    
    <Class name="BenefitSuspensionObject">
        <Initialization>
            <Attribute name="suspendedBenefit">
                <type>
                    <codetableentry
                        table="BDMOASSuspendedBenefit" />
                </type>
            </Attribute>
            <Attribute name="suspensionStatus">
                <type>
                    <codetableentry
                        table="BDMOASSuspensionStatus" />
                </type>
            </Attribute>
            <Attribute name="startDate">
                <type>
                    <javaclass name="curam.util.type.Date" />
                </type>
            </Attribute>
            <Attribute name="endDate">
                <type>
                    <javaclass name="curam.util.type.Date" />
                </type>
            </Attribute>
        </Initialization>
        <Attribute name="effectiveEndDate">
            <type>
                <javaclass name="curam.util.type.Date" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="curam.util.type.Date" />
                    </type>
                    <when>
                        <condition>
                            <equals>
                                <null />
                                <reference attribute="endDate" />
                            </equals>
                        </condition>
                        <value>
                            <Date value="9999-12-31" />
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <reference attribute="endDate" />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>
        <Attribute name="existenceTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Boolean" />
                </javaclass>
            </type>
            <derivation>
                <existencetimeline>
                    <intervaltype>
                        <javaclass name="java.lang.Boolean" />
                    </intervaltype>
                    <intervalfromdate>
                        <reference attribute="startDate" />
                    </intervalfromdate>
                    <intervaltodate>
                        <reference attribute="effectiveEndDate" />
                    </intervaltodate>
                    <preExistenceValue>
                        <false />
                    </preExistenceValue>
                    <existenceValue>
                        <true />
                    </existenceValue>
                    <postExistenceValue>
                        <false />
                    </postExistenceValue>
                </existencetimeline>
            </derivation>
        </Attribute>
        <Attribute name="isIncomeTestedSuspendedBenefit">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <any>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                            <members>
                                <equals>
                                    <Code table="BDMOASSuspendedBenefit">
                                        <String value="SBT2" />
                                    </Code>
                                    <reference attribute="suspendedBenefit" />
                                </equals>
                                <equals>
                                    <Code table="BDMOASSuspendedBenefit">
                                        <String value="SBT4" />
                                    </Code>
                                    <reference attribute="suspendedBenefit" />
                                </equals>
                                <equals>
                                    <Code table="BDMOASSuspendedBenefit">
                                        <String value="SBT5" />
                                    </Code>
                                    <reference attribute="suspendedBenefit" />
                                </equals>
                                <equals>
                                    <Code table="BDMOASSuspendedBenefit">
                                        <String value="SBT6" />
                                    </Code>
                                    <reference attribute="suspendedBenefit" />
                                </equals>
                            </members>
                    </fixedlist>
                </any>
            </derivation>
        </Attribute>
    </Class>
</RuleSet>
