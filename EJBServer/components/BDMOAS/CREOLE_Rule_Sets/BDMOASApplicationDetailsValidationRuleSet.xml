<RuleSet name="BDMOASApplicationDetailsValidationRuleSet"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="../../../build/svr/creole.gen/schema/RuleSet.xsd">
	<Class extends="DefaultEvidenceValidationResult"
		extendsRuleSet="EvidenceValidationRuleSet" name="ValidationResult">
		<Attribute name="evidence">
			<type>
				<ruleclass name="BDMOASApplicationDetails"
					ruleset="BDMOASApplicationDetailsRuleSet" />
			</type>
			<derivation>
				<specified />
			</derivation>
		</Attribute>
		<Attribute name="evidenceObject">
			<type>
				<ruleclass name="BDMOASApplicationDetails"
					ruleset="BDMOASApplicationDetailsDataRuleSet" />
			</type>
			<derivation>
				<singleitem onMultiple="error" onEmpty="error">
					<readall ruleclass="BDMOASApplicationDetails"
						ruleset="BDMOASApplicationDetailsDataRuleSet">
						<match retrievedattribute="successionID">
							<reference attribute="successionID">
								<reference attribute="evidence" />
							</reference>
						</match>
					</readall>
				</singleitem>
			</derivation>
		</Attribute>
		<Attribute name="standardValidations">
			<type>
				<javaclass name="java.util.List">
					<ruleclass name="Validation"
						ruleset="EvidenceValidationRuleSet" />
				</javaclass>
			</type>
			<derivation>
				<fixedlist>
					<listof>
						<ruleclass name="Validation"
							ruleset="EvidenceValidationRuleSet" />
					</listof>
					<members>
						<reference attribute="pensionStartDateValidation" />
					</members>
				</fixedlist>
			</derivation>
		</Attribute>
		<Attribute name="preModifyValidations">
			<type>
				<javaclass name="java.util.List">
					<ruleclass name="Validation"
						ruleset="EvidenceValidationRuleSet" />
				</javaclass>
			</type>
			<derivation>
				<fixedlist>
					<listof>
						<ruleclass name="Validation"
							ruleset="EvidenceValidationRuleSet" />
					</listof>
					<members>
						<reference attribute="receiptDateModificationValidation" />
					</members>
				</fixedlist>
			</derivation>
		</Attribute>
		<Attribute name="receiptDateModificationValidation">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference attribute="receiptDateModificationFailure" />
					<reference
						attribute="receiptDateModificationFailureMessage" />
				</create>
			</derivation>
		</Attribute>
		<Attribute name="receiptDateModificationFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<equals>
								<reference attribute="methodOfApplication">
									<reference attribute="evidence" />
								</reference>
								<Code table="BDMOASMethodOfApplication">
									<String value="MOA27000" />
								</Code>
							</equals>
						</condition>
						<value>
							<not>
								<equals>
									<reference attribute="receiptDate">
										<reference attribute="evidence" />
									</reference>
									<reference attribute="receiptDate">
										<reference attribute="evidenceObject" />
									</reference>
								</equals>
							</not>
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="receiptDateModificationFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_RECEIPT_DATE_CANNOT_BE_MODIFIED"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASApplicationDetailsValidationRuleSet">
					<reference attribute="methodOfApplication">
						<reference attribute="evidence" />
					</reference>
				</ResourceMessage>
			</derivation>
		</Attribute>
		<Attribute name="pensionStartDateValidation">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference attribute="pensionStartDateFailure" />
					<reference attribute="pensionStartDateFailureMessage" />
				</create>
			</derivation>
		</Attribute>
		<Attribute name="pensionStartDateFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<not>
								<equals>
									<null />
									<reference attribute="requestedPensionStartDate">
										<reference attribute="evidence" />
									</reference>
								</equals>
							</not> 
						</condition>
						<value>
							<not>
								<call class="curam.ca.gc.bdm.creole.impl.Statics"
									method="isFirstOfMonth">
									<type>
										<javaclass name="Boolean" />
									</type>
									<arguments>
										<reference attribute="requestedPensionStartDate">
											<reference attribute="evidence" />
										</reference>
									</arguments>
								</call>
							</not>
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="pensionStartDateFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_REQUEST_PENSION_START_DATE_NOT_FIRST"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASApplicationDetailsValidationRuleSet" />
			</derivation>
		</Attribute>
	</Class>
</RuleSet>