<RuleSet name="BDMOASResidenceCalculatorRuleSet"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
	<Class name="BDMOASResidenceCalculator">
		<Initialization>
			<Attribute name="caseParticipantRoleID">
				<type>
					<javaclass name="Number" />
				</type>
			</Attribute>
		</Initialization>
		<Attribute name="participantCalculator">
			<type>
				<ruleclass name="BDMOASParticipantCalculator"
					ruleset="BDMOASParticipantCalculatorRuleSet" />
			</type>
			<derivation>
				<create ruleclass="BDMOASParticipantCalculator"
					ruleset="BDMOASParticipantCalculatorRuleSet">
					<reference attribute="caseParticipantRoleID" />
				</create>
			</derivation>
		</Attribute>
		<Attribute name="isAnyResidencePeriodPresent">
			<type>
				<javaclass name="Boolean" />
			</type>
			<derivation>
				<compare comparison="&gt;">
					<property name="size">
						<object>
							<reference attribute="residencePeriodRecordList">
								<reference attribute="caseParticipantData">
									<reference attribute="participantCalculator" />
								</reference>
							</reference>
						</object>
					</property>
					<Number value="0" />
				</compare>
			</derivation>
		</Attribute>
		<Attribute name="residenceHistoryExistsTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.creole.value.Timeline">
							<javaclass name="Boolean" />
						</javaclass>
					</type>
					<when>
						<condition>
							<reference attribute="isAnyResidencePeriodPresent" />
						</condition>
						<value>
							<timelineoperation>
								<any>
									<dynamiclist>
										<list>
											<reference attribute="residencePeriodObjectList" />
										</list>
										<listitemexpression>
											<intervalvalue>
												<reference attribute="existenceTimeline">
													<current />
												</reference>
											</intervalvalue>
										</listitemexpression>
									</dynamiclist>
								</any>
							</timelineoperation>
						</value>
					</when>
					<otherwise>
						<value>
							<timelineoperation>
								<false />
							</timelineoperation>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="residencePeriodObjectList">
			<type>
				<javaclass name="List">
					<ruleclass name="ResidencePeriodObject" />
				</javaclass>
			</type>
			<derivation>
				<sort>
					<list>
						<dynamiclist>
							<list>
								<reference attribute="residencePeriodRecordList">
									<reference attribute="caseParticipantData">
										<reference attribute="participantCalculator" />
									</reference>
								</reference>
							</list>
							<listitemexpression>
								<create ruleclass="ResidencePeriodObject">
									<current />
								</create>
							</listitemexpression>
						</dynamiclist>
					</list>
					<sortorder>
						<sortitem direction="ascending">
							<reference attribute="startDate">
								<current />
							</reference>
						</sortitem>
					</sortorder>
				</sort>
			</derivation>
		</Attribute>
		<Attribute name="canadianEligiblePeriodList">
			<type>
				<javaclass name="List">
					<ruleclass name="ResidencePeriodObject" />
				</javaclass>
			</type>
			<derivation>
				<filter>
					<list>
						<reference attribute="residencePeriodObjectList" />
					</list>
					<listitemexpression>
						<choose>
							<type>
								<javaclass name="Boolean" />
							</type>
							<test>
								<reference attribute="residenceType">
									<reference attribute="evidence">
										<current />
									</reference>
								</reference>
							</test>
							<when>
								<condition>
									<Code table="OASResidenceType">
										<String value="RT001" />
									</Code>
								</condition>
								<value>
									<true />
								</value>
							</when>
							<when>
								<condition>
									<Code table="OASResidenceType">
										<String value="RT004" />
									</Code>
								</condition>
								<value>
									<true />
								</value>
							</when>
							<otherwise>
								<value>
									<false />
								</value>
							</otherwise>
						</choose>
					</listitemexpression>
				</filter>
			</derivation>
		</Attribute>
		<Attribute name="entitlementPeriodList">
			<type>
				<javaclass name="List">
					<ruleclass name="ResidencePeriodObject" />
				</javaclass>
			</type>
			<derivation>
				<filter>
					<list>
						<reference attribute="residencePeriodObjectList" />
					</list>
					<listitemexpression>
						<choose>
							<type>
								<javaclass name="Boolean" />
							</type>
							<test>
								<reference attribute="residenceType">
									<reference attribute="evidence">
										<current />
									</reference>
								</reference>
							</test>
							<when>
								<condition>
									<Code table="OASResidenceType">
										<String value="RT001" />
									</Code>
								</condition>
								<value>
									<true />
								</value>
							</when>
							<when>
								<condition>
									<Code table="OASResidenceType">
										<String value="RT004" />
									</Code>
								</condition>
								<value>
									<true />
								</value>
							</when>
							<otherwise>
								<value>
									<false />
								</value>
							</otherwise>
						</choose>
					</listitemexpression>
				</filter>
			</derivation>
		</Attribute>
		<Attribute name="countryOfResidenceTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<codetableentry table="Country" />
				</javaclass>
			</type>
			<derivation>
				<timelineoperation>
					<singleitem onMultiple="returnNull" onEmpty="returnNull">
						<dynamiclist>
							<list>
								<reference attribute="residencePeriodObjectList" />
							</list>
							<listitemexpression>
								<choose>
									<type>
										<codetableentry table="Country" />
									</type>
									<when>
										<condition>
											<intervalvalue>
												<reference attribute="existenceTimeline">
													<current />
												</reference>
											</intervalvalue>
										</condition>
										<value>
											<reference attribute="country">
												<reference attribute="evidence">
													<current />
												</reference>
											</reference>
										</value>
									</when>
									<otherwise>
										<value>
											<null />
										</value>
									</otherwise>
								</choose>
							</listitemexpression>
						</dynamiclist>
					</singleitem>
				</timelineoperation>
			</derivation>
		</Attribute>
	</Class>
	<Class name="ResidencePeriodObject">
		<Initialization>
			<Attribute name="evidence">
				<type>
					<ruleclass name="OASResidencePeriod"
						ruleset="OASResidencePeriodDataRuleSet" />
				</type>
			</Attribute>
		</Initialization>
		<Attribute name="existenceTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<existencetimeline>
					<intervaltype>
						<javaclass name="Boolean" />
					</intervaltype>
					<intervalfromdate>
						<reference attribute="startDate">
							<reference attribute="evidence" />
						</reference>
					</intervalfromdate>
					<intervaltodate>
						<reference attribute="endDate">
							<reference attribute="evidence" />
						</reference>
					</intervaltodate>
					<preExistenceValue>
						<false />
					</preExistenceValue>
					<existenceValue>
						<true />
					</existenceValue>
					<postExistenceValue>
						<false />
					</postExistenceValue>
				</existencetimeline>
			</derivation>
		</Attribute>
		<Attribute name="isCanadianResidenceOrDeemedResidence">
			<type>
				<javaclass name="Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<test>
						<reference attribute="residenceType">
							<reference attribute="evidence" />
						</reference>
					</test>
					<when>
						<condition>
							<Code table="OASResidenceType">
								<String value="RT1" />
							</Code>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<when>
						<condition>
							<Code table="OASResidenceType">
								<String value="RT2" />
							</Code>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="startDate">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<reference attribute="startDate">
					<reference attribute="evidence" />
				</reference>
			</derivation>
		</Attribute>
		<Attribute name="endDate">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<reference attribute="endDate">
					<reference attribute="evidence" />
				</reference>
			</derivation>
		</Attribute>
	</Class>
</RuleSet>