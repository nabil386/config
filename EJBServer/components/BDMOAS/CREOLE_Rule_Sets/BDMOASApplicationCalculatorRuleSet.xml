<RuleSet name="BDMOASApplicationCalculatorRuleSet"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
	<Class name="BDMOASApplicationCalculator">
		<Initialization>
			<Attribute name="caseParticipantRoleID">
				<type>
					<javaclass name="Number" />
				</type>
			</Attribute>
			<Attribute name="benefitType">
				<type>
					<codetableentry table="BDMOASBenefitType" />
				</type>
			</Attribute>
		</Initialization>
		<Attribute name="caseParticipantData">
			<type>
				<ruleclass name="BDMOASCaseParticipantData"
					ruleset="BDMOASDataRuleSet" />
			</type>
			<derivation>
				<create ruleclass="BDMOASCaseParticipantData"
					ruleset="BDMOASDataRuleSet">
					<reference attribute="caseParticipantRoleID" />
				</create>
			</derivation>
		</Attribute>
		<Attribute name="activeApplicationList">
			<type>
				<javaclass name="List">
					<ruleclass name="BDMOASApplication" />
				</javaclass>
			</type>
			<derivation>
				<dynamiclist>
					<list>
						<filter>
							<list>
								<reference attribute="applicationDetailsRecordList">
									<reference attribute="caseParticipantData" />
								</reference>
							</list>
							<listitemexpression>
								<all>
									<fixedlist>
										<listof>
											<javaclass name="Boolean" />
										</listof>
										<members>
											<equals>
												<reference attribute="benefitType">
													<current />
												</reference>
												<reference attribute="benefitType" />
											</equals>
											<equals>
												<reference attribute="applicationStatus">
													<current />
												</reference>
												<Code table="BDMOASApplicationStatus">
													<String value="AST1" />
												</Code>
											</equals>
										</members>
									</fixedlist>
								</all>
							</listitemexpression>
						</filter>
					</list>
					<listitemexpression>
						<create ruleclass="BDMOASApplication">
							<current />
						</create>
					</listitemexpression>
				</dynamiclist>
			</derivation>
		</Attribute>
		<Attribute name="earliestApplication">
			<type>
				<ruleclass name="BDMOASApplication" />
			</type>
			<derivation>
				<singleitem onMultiple="returnFirst" onEmpty="error">
					<sort>
						<list>
							<reference attribute="activeApplicationList" />
						</list>
						<sortorder>
							<sortitem direction="ascending">
								<reference attribute="dateOfApplication">
									<current />
								</reference>
							</sortitem>
						</sortorder>
					</sort>
				</singleitem>
			</derivation>
		</Attribute>
		<Attribute name="isApplicantTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<call class="curam.ca.gc.bdmoas.creole.impl.Statics"
					method="getSubsequentMonthTrueTimeline">
					<type>
						<javaclass name="curam.creole.value.Timeline">
							<javaclass name="Boolean" />
						</javaclass>
					</type>
					<arguments>
						<timelineoperation>
							<any>
								<dynamiclist>
									<list>
										<reference attribute="activeApplicationList" />
									</list>
									<listitemexpression>
										<intervalvalue>
											<reference attribute="isApplicantTimeline">
												<current />
											</reference>
										</intervalvalue>
									</listitemexpression>
								</dynamiclist>
							</any>
						</timelineoperation>
					</arguments>
				</call>
			</derivation>
		</Attribute>
	</Class>
	<Class name="BDMOASApplication">
		<Initialization>
			<Attribute name="evidence">
				<type>
					<ruleclass name="BDMOASApplicationDetails"
						ruleset="BDMOASApplicationDetailsDataRuleSet" />
				</type>
			</Attribute>
		</Initialization>
		<Attribute name="receiptDate">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<reference attribute="receiptDate">
					<reference attribute="evidence" />
				</reference>
			</derivation>
		</Attribute>
		<Attribute name="earliestDeemedDateRecord">
			<type>
				<ruleclass name="BDMOASDeemedDate"
					ruleset="BDMOASDeemedDateDataRuleSet" />
			</type>
			<derivation>
				<singleitem onMultiple="returnFirst" onEmpty="returnNull">
					<sort>
						<list>
							<reference attribute="related_BDMOASDeemedDate">
								<reference attribute="evidence" />
							</reference>
						</list>
						<sortorder>
							<sortitem direction="ascending">
								<reference attribute="deemedDate">
									<current />
								</reference>
							</sortitem>
						</sortorder>
					</sort>
				</singleitem>
			</derivation>
		</Attribute>
		<Attribute name="deemedDateRecordExists">
			<type>
				<javaclass name="Boolean" />
			</type>
			<derivation>
				<not>
					<equals>
						<null />
						<reference attribute="earliestDeemedDateRecord" />
					</equals>
				</not>
			</derivation>
		</Attribute>
		<Attribute name="deemedDate">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.util.type.Date" />
					</type>
					<when>
						<condition>
							<reference attribute="deemedDateRecordExists" />
						</condition>
						<value>
							<reference attribute="deemedDate">
								<reference attribute="earliestDeemedDateRecord" />
							</reference>
						</value>
					</when>
					<otherwise>
						<value>
							<null />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="deemedDateReason">
			<type>
				<codetableentry table="BDMOASDeemedDateReason" />
			</type>
			<derivation>
				<choose>
					<type>
						<codetableentry table="BDMOASDeemedDateReason" />
					</type>
					<when>
						<condition>
							<reference attribute="deemedDateRecordExists" />
						</condition>
						<value>
							<reference attribute="deemedDateReason">
								<reference attribute="earliestDeemedDateRecord" />
							</reference>
						</value>
					</when>
					<otherwise>
						<value>
							<null />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="dateOfApplication">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.util.type.Date" />
					</type>
					<when>
						<condition>
							<reference attribute="deemedDateRecordExists" />
						</condition>
						<value>
							<min>
								<fixedlist>
									<listof>
										<javaclass name="curam.util.type.Date" />
									</listof>
									<members>
										<reference attribute="receiptDate" />
										<reference attribute="deemedDate" />
									</members>
								</fixedlist>
							</min>
						</value>
					</when>
					<otherwise>
						<value>
							<reference attribute="receiptDate" />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="earliestApprovalDate">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<call class="curam.ca.gc.bdm.creole.impl.Statics"
					method="addMonthsToDate">
					<type>
						<javaclass name="curam.util.type.Date" />
					</type>
					<arguments>
						<reference attribute="dateOfApplication" />
						<Number value="-12" />
					</arguments>
				</call>
			</derivation>
		</Attribute>
		<Attribute name="latestApprovalDate">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<call class="curam.ca.gc.bdm.creole.impl.Statics"
					method="addMonthsToDate">
					<type>
						<javaclass name="curam.util.type.Date" />
					</type>
					<arguments>
						<reference attribute="dateOfApplication" />
						<Number value="11" />
					</arguments>
				</call>
			</derivation>
		</Attribute>
		<Attribute name="isPotentialApplicantTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<existencetimeline>
					<intervaltype>
						<javaclass name="Boolean" />
					</intervaltype>
					<intervalfromdate>
						<reference attribute="earliestApprovalDate" />
					</intervalfromdate>
					<intervaltodate>
						<null />
					</intervaltodate>
					<preExistenceValue>
						<false />
					</preExistenceValue>
					<existenceValue>
						<true />
					</existenceValue>
					<postExistenceValue>
						<true />
					</postExistenceValue>
				</existencetimeline>
			</derivation>
		</Attribute>
		<Attribute name="isCeasedTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<timelineoperation>
					<any>
						<dynamiclist>
							<list>
								<dynamiclist>
									<list>
										<reference
											attribute="related_BDMOASBenefitCessation">
											<reference attribute="evidence" />
										</reference>
									</list>
									<listitemexpression>
										<existencetimeline>
											<intervaltype>
												<javaclass name="Boolean" />
											</intervaltype>
											<intervalfromdate>
												<call class="curam.ca.gc.bdm.creole.impl.Statics"
													method="getSubsequentMonthStart">
													<type>
														<javaclass name="curam.util.type.Date" />
													</type>
													<arguments>
														<reference attribute="cessationDate">
															<current />
														</reference>
													</arguments>
												</call>
											</intervalfromdate>
											<intervaltodate>
												<choose>
													<type>
														<javaclass name="curam.util.type.Date" />
													</type>
													<when>
														<condition>
															<equals>
																<Code table="BDMOASBenefitType">
																	<String value="BT1" />
																</Code>
																<reference attribute="benefitType">
																	<reference attribute="evidence" />
																</reference>
															</equals>
														</condition>
														<value>
															<call class="curam.ca.gc.bdm.creole.impl.Statics"
																method="getEndOfMonth">
																<type>
																	<javaclass name="curam.util.type.Date" />
																</type>
																<arguments>
																	<reference attribute="reinstatementDate">
																		<current />
																	</reference>
																</arguments>
															</call>
														</value>
													</when>
													<otherwise>
														<value>
															<null />
														</value>
													</otherwise>
												</choose>
											</intervaltodate>
											<preExistenceValue>
												<false />
											</preExistenceValue>
											<existenceValue>
												<true />
											</existenceValue>
											<postExistenceValue>
												<false />
											</postExistenceValue>
										</existencetimeline>
									</listitemexpression>
								</dynamiclist>
							</list>
							<listitemexpression>
								<intervalvalue>
									<current />
								</intervalvalue>
							</listitemexpression>
						</dynamiclist>
					</any>
				</timelineoperation>
			</derivation>
		</Attribute>
		<Attribute name="isCancellationGranted">
			<type>
				<javaclass name="Boolean" />
			</type>
			<derivation>
				<any>
					<dynamiclist>
						<list>
							<reference
								attribute="related_BDMOASBenefitCancellationRequest">
								<reference attribute="evidence" />
							</reference>
						</list>
						<listitemexpression>
							<equals>
								<reference attribute="cancellationStatus">
									<current />
								</reference>
								<Code table="BDMOASCancellationStatus">
									<String value="CST2" />
								</Code>
							</equals>
						</listitemexpression>
					</dynamiclist>
				</any>
			</derivation>
		</Attribute>
		<Attribute name="isInitialEligibilityPeriodTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<existencetimeline>
					<intervaltype>
						<javaclass name="Boolean" />
					</intervaltype>
					<intervalfromdate>
						<reference attribute="earliestApprovalDate" />
					</intervalfromdate>
					<intervaltodate>
						<reference attribute="latestApprovalDate" />
					</intervaltodate>
					<preExistenceValue>
						<false />
					</preExistenceValue>
					<existenceValue>
						<true />
					</existenceValue>
					<postExistenceValue>
						<false />
					</postExistenceValue>
				</existencetimeline>
			</derivation>
		</Attribute>
		<Attribute name="isApplicantTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.creole.value.Timeline">
							<javaclass name="Boolean" />
						</javaclass>
					</type>
					<when>
						<condition>
							<equals>
								<reference attribute="applicationStatus">
									<reference attribute="evidence" />
								</reference>
								<Code table="BDMOASApplicationStatus">
									<String value="AST1" />
								</Code>
							</equals>
						</condition>
						<value>
							<choose>
								<type>
									<javaclass name="curam.creole.value.Timeline">
										<javaclass name="Boolean" />
									</javaclass>
								</type>
								<when>
									<condition>
										<equals>
											<Code table="BDMOASBenefitType">
												<String value="BT1" />
											</Code>
											<reference attribute="benefitType">
												<reference attribute="evidence" />
											</reference>
										</equals>
									</condition>
									<value>
										<reference attribute="isPotentialApplicantTimeline" />
									</value>
								</when>
								<otherwise>
									<value>
										<timelineoperation>
											<all>
												<fixedlist>
													<listof>
														<javaclass name="Boolean" />
													</listof>
													<members>
														<not>
															<intervalvalue>
																<reference attribute="isCeasedTimeline" />
															</intervalvalue>
														</not>
														<intervalvalue>
															<reference
																attribute="isPotentialApplicantTimeline" />
														</intervalvalue>
													</members>
												</fixedlist>
											</all>
										</timelineoperation>
									</value>
								</otherwise>
							</choose>
						</value>
					</when>
					<otherwise>
						<value>
							<Timeline>
								<intervaltype>
									<javaclass name="Boolean" />
								</intervaltype>
								<initialvalue>
									<false />
								</initialvalue>
							</Timeline>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
	</Class>
</RuleSet>