<?xml version="1.0" encoding="UTF-8"?>
<!-- Task 112287: DEV: Implement Manage CRA Income - R2 -->
<RuleSet name="BDMOASCRAIncomeSummaryRuleSet"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">

    <Class name="BDMOASCRAIncomeSummary"
        extends="DefaultEvidenceSummary"
        extendsRuleSet="EvidenceSummaryRuleSet">

        <Attribute name="evidence">
            <type>
                <ruleclass name="BDMOASCRAIncome"
                    ruleset="BDMOASCRAIncomeRuleSet" />
            </type>
            <derivation>
                <specified />
            </derivation>
        </Attribute>

        <Attribute name="summary">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass
                            name="curam.creole.value.Message" />
                    </type>
                    <when>
                        <condition>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean" />
                                    </listof>
                                    <members>
                                        <reference attribute="isBankruptcy" />
                                        <reference attribute="isReassessment" />
                                    </members>
                                </fixedlist>
                            </all>
                        </condition>
                        <value>
                            <reference attribute="bankruptcyAndReassessmentSummary" />
                        </value>
                    </when>
                    <when>
                        <condition>
                            <reference attribute="isBankruptcy" />
                        </condition>
                        <value>
                            <reference attribute="bankruptcySummary" />
                        </value>
                    </when>
                    <when>
                        <condition>
                            <reference attribute="isReassessment" />
                        </condition>
                        <value>
                            <reference attribute="reassessmentSummary" />
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <reference attribute="standardSummary" />
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>

        <Attribute name="isBankruptcy">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <all>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <not>
                                <equals>
                                    <null />
                                    <reference
                                        attribute="isPrePostBankruptcy">
                                        <reference
                                            attribute="evidence" />
                                    </reference>
                                </equals>
                            </not>
                            <reference
                                attribute="isPrePostBankruptcy">
                                <reference
                                    attribute="evidence" />
                            </reference>
                        </members>
                    </fixedlist>
                </all>
            </derivation>
        </Attribute>

        <Attribute name="isReassessment">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <all>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <not>
                                <equals>
                                    <null />
                                    <reference
                                        attribute="reassessment">
                                        <reference
                                            attribute="evidence" />
                                    </reference>
                                </equals>
                            </not>
                            <compare comparison="&gt;">
                                <reference
                                    attribute="reassessment">
                                    <reference
                                        attribute="evidence" />
                                </reference>
                                <Number value="0" />
                            </compare>
                        </members>
                    </fixedlist>
                </all>
            </derivation>
        </Attribute>

        <Attribute name="bankruptcyAndReassessmentSummary">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <ResourceMessage
                    key="BankruptcyAndReassessmentSummary"
                    resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASCRAIncomeSummaryRuleSet">
                    <reference attribute="totalIncome">
                        <reference attribute="evidence" />
                    </reference>
                    <reference attribute="taxYear">
                        <reference attribute="evidence" />
                    </reference>
                </ResourceMessage>
            </derivation>
        </Attribute>

        <Attribute name="bankruptcySummary">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <ResourceMessage key="BankruptcySummary"
                    resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASCRAIncomeSummaryRuleSet">
                    <reference attribute="totalIncome">
                        <reference attribute="evidence" />
                    </reference>
                    <reference attribute="taxYear">
                        <reference attribute="evidence" />
                    </reference>
                </ResourceMessage>
            </derivation>
        </Attribute>

        <Attribute name="reassessmentSummary">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <ResourceMessage
                    key="ReassessmentSummary"
                    resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASCRAIncomeSummaryRuleSet">
                    <reference attribute="totalIncome">
                        <reference attribute="evidence" />
                    </reference>
                    <reference attribute="taxYear">
                        <reference attribute="evidence" />
                    </reference>
                </ResourceMessage>
            </derivation>
        </Attribute>

        <Attribute name="standardSummary">
            <type>
                <javaclass name="curam.creole.value.Message" />
            </type>
            <derivation>
                <ResourceMessage
                    key="StandardSummary"
                    resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASCRAIncomeSummaryRuleSet">
                    <reference attribute="totalIncome">
                        <reference attribute="evidence" />
                    </reference>
                    <reference attribute="taxYear">
                        <reference attribute="evidence" />
                    </reference>
                </ResourceMessage>
            </derivation>
        </Attribute>

    </Class>

</RuleSet>