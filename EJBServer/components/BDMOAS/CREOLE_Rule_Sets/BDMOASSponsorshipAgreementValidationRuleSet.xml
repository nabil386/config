<?xml version="1.0" encoding="UTF-8"?>
<!-- Task 61872 DEV: Implement Sponsorship Evidence -->
<RuleSet name="BDMOASSponsorshipAgreementValidationRuleSet"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="../../../build/svr/creole.gen/schema/RuleSet.xsd">

	<Class name="ValidationResult"
		extends="DefaultEvidenceValidationResult"
		extendsRuleSet="EvidenceValidationRuleSet">

		<Attribute name="description">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage key="Description"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASSponsorshipAgreementValidationRuleSet" />
			</derivation>
		</Attribute>

		<Attribute name="evidence">
			<type>
				<ruleclass name="BDMOASSponsorshipAgreement"
					ruleset="BDMOASSponsorshipAgreementRuleSet" />
			</type>
			<derivation>
				<specified />
			</derivation>
		</Attribute>
		

		<Attribute name="standardValidations">
			<type>
				<javaclass name="java.util.List">
					<ruleclass name="Validation"
						ruleset="EvidenceValidationRuleSet" />
				</javaclass>
			</type>
			<derivation>
				<fixedlist>
					<listof>
						<ruleclass name="Validation"
							ruleset="EvidenceValidationRuleSet" />
					</listof>
					<members>
						<reference
							attribute="isoverlapSponsorshipAgreementExists" />
						<reference
							attribute="enteredUnderAgreementValidator" />
					</members>
				</fixedlist>
			</derivation>
		</Attribute>
		
		<Attribute name="enteredUnderAgreementValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference attribute="enteredUnderAgreementFailure" />
					<reference
						attribute="enteredUnderAgreementFailureMessage" />
				</create>
			</derivation>
		</Attribute>
		
		<Attribute name="enteredUnderAgreementFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<equals>
					<Code table="BDMYesNo">
						<String value="BOASYN002" />
					</Code>
					<reference attribute="isSponsored">
						<reference attribute="sponsorship">
							<reference attribute="evidence" />
						</reference>
					</reference>
				</equals>
			</derivation>
		</Attribute>
		
		<Attribute name="enteredUnderAgreementFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_DID_NOT_ENTER_UNDER_AGREEMENT"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASSponsorshipAgreementValidationRuleSet" />
			</derivation>
		</Attribute>

		<Attribute name="isoverlapSponsorshipAgreementExists">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference attribute="overlapSponsorshipAgreementFailure" />
					<reference
						attribute="overlapSponsorshipAgreementFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute name="overlapSponsorshipAgreementFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="java.lang.Boolean" />
					</type>
					<when>
						<condition>
							<all>
								<fixedlist>
									<listof>
										<javaclass name="java.lang.Boolean" />
									</listof>
									<members>
										<not>
											<equals>
												<null />
												<reference attribute="evidence" />
											</equals>
										</not>
										<reference
											attribute="anySponsorshipAgreementEvidencesPresent" />
									</members>
								</fixedlist>
							</all>
						</condition>
						<value>
							<any>
								<dynamiclist>
									<list>
										<reference
											attribute="existingSponsorshipAgreementObjectList" />
									</list>
									<listitemexpression>
										<any>
											<fixedlist>
												<listof>
													<javaclass name="Boolean" />
												</listof>
												<members>
													<property name="valueOn">
														<object>
															<reference attribute="existenceTimeline">
																<current />
															</reference>
														</object>
														<arguments>
															<reference attribute="startDate">
																<reference
																	attribute="sponsorshipAgreementObject" />
															</reference>
														</arguments>
													</property>
													<property name="valueOn">
														<object>
															<reference attribute="existenceTimeline">
																<current />
															</reference>
														</object>
														<arguments>
															<reference attribute="endDate">
																<reference
																	attribute="sponsorshipAgreementObject" />
															</reference>
														</arguments>
													</property>
													<property name="valueOn">
														<object>
															<reference attribute="existenceTimeline">
																<current />
															</reference>
														</object>
														<arguments>
															<reference attribute="breakdownDate">
																<reference
																	attribute="sponsorshipAgreementObject" />
															</reference>
														</arguments>
													</property>
													<property name="valueOn">
														<object>
															<reference attribute="existenceTimeline">
																<reference
																	attribute="sponsorshipAgreementObject" />
															</reference>
														</object>
														<arguments>
															<reference attribute="startDate">
																<current />
															</reference>
														</arguments>
													</property>
													<property name="valueOn">
														<object>
															<reference attribute="existenceTimeline">
																<reference
																	attribute="sponsorshipAgreementObject" />
															</reference>
														</object>
														<arguments>
															<reference attribute="endDate">
																<current />
															</reference>
														</arguments>
													</property>
												</members>
											</fixedlist>
										</any>
									</listitemexpression>
								</dynamiclist>
							</any>
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute name="overlapSponsorshipAgreementFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_OVERLAP_SPONSORSHIP_AGREEMENT_EXITS"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASSponsorshipAgreementValidationRuleSet" />
			</derivation>
		</Attribute>

		<Attribute name="sponsorshipAgreementObject">
			<type>
				<ruleclass name="SponsorshipAgreementObject" />
			</type>
			<derivation>
				<create ruleclass="SponsorshipAgreementObject">
					<reference attribute="evidence" />
				</create>
			</derivation>
		</Attribute>
		
		<Attribute name="anySponsorshipAgreementEvidencesPresent">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="java.lang.Boolean" />
					</type>
					<when>
						<condition>
							<not>
								<equals>
									<reference
										attribute="related_BDMOASSponsorshipAgreement">
										<reference attribute="sponsorship">
											<reference attribute="evidence" />
										</reference>
									</reference>
									<null />
								</equals>
							</not>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		

		<Attribute name="sponsorshipAgreementEvidenceList">
			<type>
				<javaclass name="java.util.List">
					<ruleclass name="BDMOASSponsorshipAgreement"
						ruleset="BDMOASSponsorshipAgreementRuleSet" />
				</javaclass>
			</type>
			<derivation>
				<filter>
					<list alias="allSponsorshipAgreements">
						<reference
							attribute="related_BDMOASSponsorshipAgreement">
							<reference attribute="sponsorship">
								<reference attribute="evidence" />
							</reference>
						</reference>
					</list>
					<listitemexpression>

						<equals>
							<reference attribute="caseParticipantRole">
								<reference attribute="sponsorship">
									<current alias="allSponsorshipAgreements" />
								</reference>
							</reference>
							<reference attribute="caseParticipantRole">
								<reference attribute="sponsorship">
									<reference attribute="evidence" />
								</reference>
							</reference>
						</equals>
					</listitemexpression>
				</filter>
			</derivation>
		</Attribute>

		<Attribute name="existingSponsorshipAgreementObjectList">
			<type>
				<javaclass name="java.util.List">
					<ruleclass name="SponsorshipAgreementObject" />
				</javaclass>
			</type>
			<derivation>
				<dynamiclist>
					<list>
						<reference attribute="sponsorshipAgreementEvidenceList" />
					</list>
					<listitemexpression>
						<choose>
							<type>
								<ruleclass name="SponsorshipAgreementObject" />
							</type>
							<when>
								<condition>
									<equals>
										<reference attribute="successionID">
											<reference attribute="evidence" />
										</reference>
										<reference attribute="successionID">
											<current />
										</reference>
									</equals>
								</condition>
								<value>
									<create ruleclass="SponsorshipAgreementObject">
										<reference attribute="evidence" />
										<specify attribute="startDate">
											<Date value="0001-01-01" />
										</specify>
										<specify attribute="endDate">
											<Date value="0001-01-01" />
										</specify>
										<specify attribute="breakdownDate">
											<Date value="0001-01-01" />
										</specify>
										<specify attribute="existenceTimeline">
											<Timeline>
												<intervaltype>
													<javaclass name="Boolean" />
												</intervaltype>
												<initialvalue>
													<false />
												</initialvalue>
											</Timeline>
										</specify>
									</create>
								</value>
							</when>
							<otherwise>
								<value>
									<create ruleclass="SponsorshipAgreementObject">
										<create ruleclass="BDMOASSponsorshipAgreement"
											ruleset="BDMOASSponsorshipAgreementRuleSet">
											<specify attribute="sponsorName">
												<reference attribute="sponsorName">
													<current />
												</reference>
											</specify>
											<specify attribute="breakdownReason">
												<reference attribute="breakdownReason">
													<current />
												</reference>
											</specify>
											<specify attribute="startDate">
												<reference attribute="startDate">
													<current />
												</reference>
											</specify>
											<specify attribute="endDate">
												<reference attribute="endDate">
													<current />
												</reference>
											</specify>
											<specify attribute="breakdownDate">
												<reference attribute="breakdownDate">
													<current />
												</reference>
											</specify>
										</create>
									</create>
								</value>
							</otherwise>
						</choose>
					</listitemexpression>
				</dynamiclist>
			</derivation>
		</Attribute>
	</Class>

	<Class name="SponsorshipAgreementObject">
		<Initialization>
			<Attribute name="evidence">
				<type>
					<ruleclass name="BDMOASSponsorshipAgreement"
						ruleset="BDMOASSponsorshipAgreementRuleSet" />
				</type>
			</Attribute>
		</Initialization>
		<Attribute name="startDate">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<reference attribute="startDate">
					<reference attribute="evidence" />
				</reference>
			</derivation>
		</Attribute>
		<Attribute name="breakdownDate">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<reference attribute="breakdownDate">
					<reference attribute="evidence" />
				</reference>
			</derivation>
		</Attribute>
		<Attribute name="endDate">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.util.type.Date" />
					</type>
					<when>
						<condition>
							<not>
								<equals>
									<null />
									<reference attribute="breakdownDate">
										<reference attribute="evidence" />
									</reference>
								</equals>
							</not>
						</condition>
						<value>
							<reference attribute="breakdownDate">
								<reference attribute="evidence" />
							</reference>
						</value>
					</when>
					<otherwise>
						<value>
							<reference attribute="endDate">
								<reference attribute="evidence" />
							</reference>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="existenceTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<existencetimeline>
					<intervaltype>
						<javaclass name="java.lang.Boolean" />
					</intervaltype>
					<intervalfromdate>
						<reference attribute="startDate">
							<reference attribute="evidence" />
						</reference>
					</intervalfromdate>
					<intervaltodate>
						<reference attribute="endDate">
						</reference>
					</intervaltodate>
					<preExistenceValue>
						<false />
					</preExistenceValue>
					<existenceValue>
						<true />
					</existenceValue>
					<postExistenceValue>
						<false />
					</postExistenceValue>
				</existencetimeline>
			</derivation>
		</Attribute>
	</Class>

</RuleSet>