<RuleSet name="BDMOASEligibilityCalculatorRuleSet"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
	<Class name="BDMOASAbstractEligibilityCalculator" abstract="true">
		<Initialization>
			<Attribute name="caseParticipantRoleID">
				<type>
					<javaclass name="Number" />
				</type>
			</Attribute>
		</Initialization>
		<Attribute name="benefitType">
			<type>
				<codetableentry table="BDMOASBenefitType" />
			</type>
			<derivation>
				<abstract />
			</derivation>
		</Attribute>
		<Attribute name="isEligibleTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<abstract />
			</derivation>
		</Attribute>
		<Attribute name="minimumAge">
			<type>
				<javaclass name="Number" />
			</type>
			<derivation>
				<Number value="0" />
			</derivation>
		</Attribute>
		<Attribute name="maximumAge">
			<type>
				<javaclass name="Number" />
			</type>
			<derivation>
				<Number value="199" />
			</derivation>
		</Attribute>
		<Attribute name="participantCalculator">
			<type>
				<ruleclass name="BDMOASParticipantCalculator"
					ruleset="BDMOASParticipantCalculatorRuleSet" />
			</type>
			<derivation>
				<create ruleclass="BDMOASParticipantCalculator"
					ruleset="BDMOASParticipantCalculatorRuleSet">
					<reference attribute="caseParticipantRoleID" />
				</create>
			</derivation>
		</Attribute>
		<Attribute name="applicationCalculator">
			<type>
				<ruleclass name="BDMOASApplicationCalculator"
					ruleset="BDMOASApplicationCalculatorRuleSet" />
			</type>
			<derivation>
				<create ruleclass="BDMOASApplicationCalculator"
					ruleset="BDMOASApplicationCalculatorRuleSet">
					<reference attribute="caseParticipantRoleID" />
					<reference attribute="benefitType" />
				</create>
			</derivation>
		</Attribute>
		<Attribute name="legalStatusCalculator">
			<type>
				<ruleclass name="BDMOASLegalStatusCalculator"
					ruleset="BDMOASLegalStatusCalculatorRuleSet" />
			</type>
			<derivation>
				<create ruleclass="BDMOASLegalStatusCalculator"
					ruleset="BDMOASLegalStatusCalculatorRuleSet">
					<reference attribute="caseParticipantRoleID" />
				</create>
			</derivation>
		</Attribute>
		<Attribute name="isApplyingWithinCanada">
			<type>
				<javaclass name="Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<compare comparison="&lt;">
								<reference attribute="dateOfApplication">
									<reference attribute="earliestApplication">
										<reference attribute="applicationCalculator" />
									</reference>
								</reference>
								<reference
									attribute="earliestResidentialAddressFromDate">
									<reference attribute="participantCalculator" />
								</reference>
							</compare>
						</condition>
						<value>
							<property name="valueOn">
								<object>
									<reference
										attribute="isCanadianResidentialAddressTimeline">
										<reference attribute="participantCalculator" />
									</reference>
								</object>
								<arguments>
									<reference
										attribute="earliestResidentialAddressFromDate">
										<reference attribute="participantCalculator" />
									</reference>
								</arguments>
							</property>
						</value>
					</when>
					<otherwise>
						<value>
							<property name="valueOn">
								<object>
									<reference
										attribute="isCanadianResidentialAddressTimeline">
										<reference attribute="participantCalculator" />
									</reference>
								</object>
								<arguments>
									<reference attribute="dateOfApplication">
										<reference attribute="earliestApplication">
											<reference attribute="applicationCalculator" />
										</reference>
									</reference>
								</arguments>
							</property>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="meetsAgeRequirementTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<timelineoperation>
					<all>
						<fixedlist>
							<listof>
								<javaclass name="Boolean" />
							</listof>
							<members>
								<compare comparison="&gt;=">
									<intervalvalue>
										<reference attribute="ageTimeline">
											<reference attribute="participantCalculator" />
										</reference>
									</intervalvalue>
									<reference attribute="minimumAge" />
								</compare>
								<compare comparison="&lt;=">
									<intervalvalue>
										<reference attribute="ageTimeline">
											<reference attribute="participantCalculator" />
										</reference>
									</intervalvalue>
									<reference attribute="maximumAge" />
								</compare>
							</members>
						</fixedlist>
					</all>
				</timelineoperation>
			</derivation>
		</Attribute>
		<Attribute name="meetsLegalStatusRequirementTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.creole.value.Timeline">
							<javaclass name="Boolean" />
						</javaclass>
					</type>
					<when>
						<condition>
							<property name="valueOn">
								<object>
									<reference
										attribute="rawMeetsLegalStatusRequirementTimeline" />
								</object>
								<arguments>
									<reference attribute="latestApprovalDate">
										<reference attribute="earliestApplication">
											<reference attribute="applicationCalculator" />
										</reference>
									</reference>
								</arguments>
							</property>
						</condition>
						<value>
							<reference
								attribute="rawMeetsLegalStatusRequirementTimeline" />
						</value>
					</when>
					<otherwise>
						<value>
							<timelineoperation>
								<false />
							</timelineoperation>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="rawMeetsLegalStatusRequirementTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.creole.value.Timeline">
							<javaclass name="Boolean" />
						</javaclass>
					</type>
					<when>
						<condition>
							<reference attribute="isApplyingWithinCanada" />
						</condition>
						<value>
							<reference attribute="isValidLegalStatusTimeline">
								<reference attribute="legalStatusCalculator" />
							</reference>
						</value>
					</when>
					<when>
						<condition>
							<equals>
								<null />
								<reference attribute="dateOfDeparture" />
							</equals>
						</condition>
						<value>
							<timelineoperation>
								<false />
							</timelineoperation>
						</value>
					</when>
					<otherwise>
						<value>
							<timelineoperation>
								<choose>
									<type>
										<javaclass name="Boolean" />
									</type>
									<when>
										<condition>
											<intervalvalue>
												<reference attribute="isPostDepartureTimeline" />
											</intervalvalue>
										</condition>
										<value>
											<property name="valueOn">
												<object>
													<reference attribute="isValidLegalStatusTimeline">
														<reference attribute="legalStatusCalculator" />
													</reference>
												</object>
												<arguments>
													<call class="curam.ca.gc.bdm.creole.impl.Statics"
														method="addDaysToDate">
														<type>
															<javaclass name="curam.util.type.Date" />
														</type>
														<arguments>
															<reference attribute="dateOfDeparture" />
															<Number value="-1" />
														</arguments>
													</call>
												</arguments>
											</property>
										</value>
									</when>
									<otherwise>
										<value>
											<intervalvalue>
												<reference attribute="isValidLegalStatusTimeline">
													<reference attribute="legalStatusCalculator" />
												</reference>
											</intervalvalue>
										</value>
									</otherwise>
								</choose>
							</timelineoperation>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="isPostDepartureTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.creole.value.Timeline">
							<javaclass name="Boolean" />
						</javaclass>
					</type>
					<when>
						<condition>
							<equals>
								<null />
								<reference attribute="dateOfDeparture" />
							</equals>
						</condition>
						<value>
							<timelineoperation>
								<false />
							</timelineoperation>
						</value>
					</when>
					<otherwise>
						<value>
							<existencetimeline>
								<intervaltype>
									<javaclass name="Boolean" />
								</intervaltype>
								<intervalfromdate>
									<reference attribute="dateOfDeparture" />
								</intervalfromdate>
								<intervaltodate>
									<null />
								</intervaltodate>
								<preExistenceValue>
									<false />
								</preExistenceValue>
								<existenceValue>
									<true />
								</existenceValue>
								<postExistenceValue>
									<true />
								</postExistenceValue>
							</existencetimeline>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="dateOfDeparture">
			<type>
				<javaclass name="curam.util.type.Date" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="curam.util.type.Date" />
					</type>
					<when>
						<condition>
							<equals>
								<null />
								<reference
									attribute="latestCanadianResidentialAddress" />
							</equals>
						</condition>
						<value>
							<null />
						</value>
					</when>
					<otherwise>
						<value>
							<reference attribute="toDate">
								<reference
									attribute="latestCanadianResidentialAddress" />
							</reference>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="latestCanadianResidentialAddress">
			<type>
				<ruleclass name="PDCAddress"
					ruleset="PDCAddressDataRuleSet" />
			</type>
			<derivation>
				<singleitem onMultiple="returnFirst" onEmpty="returnNull">
					<sort>
						<list>
							<filter>
								<list>
									<reference attribute="residentialAddressRecordList">
										<reference attribute="caseParticipantData">
											<reference attribute="participantCalculator" />
										</reference>
									</reference>
								</list>
								<listitemexpression>
									<all>
										<fixedlist>
											<listof>
												<javaclass name="Boolean" />
											</listof>
											<members>
												<equals>
													<Code table="AddressCountry">
														<String value="CA" />
													</Code>
													<reference attribute="countryCode">
														<reference attribute="related_address">
															<current />
														</reference>
													</reference>
												</equals>
												<compare comparison="&lt;">
													<reference attribute="toDate">
														<current />
													</reference>
													<reference attribute="dateOfApplication">
														<reference attribute="earliestApplication">
															<reference attribute="applicationCalculator" />
														</reference>
													</reference>
												</compare>
											</members>
										</fixedlist>
									</all>
								</listitemexpression>
							</filter>
						</list>
						<sortorder>
							<sortitem direction="descending">
								<reference attribute="toDate">
									<current />
								</reference>
							</sortitem>
						</sortorder>
					</sort>
				</singleitem>
			</derivation>
		</Attribute>
	</Class>
</RuleSet>