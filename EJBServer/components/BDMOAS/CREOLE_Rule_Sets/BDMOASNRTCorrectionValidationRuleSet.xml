<?xml version="1.0" encoding="UTF-8"?>
<!-- BEGIN Feature 106244: Manage NRT -->
<RuleSet name="BDMOASNRTCorrectionValidationRuleSet"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">

	<Class extends="DefaultEvidenceValidationResult"
		extendsRuleSet="EvidenceValidationRuleSet" name="ValidationResult">

		<Attribute name="description">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage key="Description"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet" />
			</derivation>
		</Attribute>

		<Attribute name="evidence">
			<type>
				<ruleclass name="BDMOASNRTCorrection"
					ruleset="BDMOASNRTCorrectionRuleSet" />
			</type>
			<derivation>
				<specified />
			</derivation>
		</Attribute>
		<Attribute name="standardValidations">
			<type>
				<javaclass name="java.util.List">
					<ruleclass name="Validation"
						ruleset="EvidenceValidationRuleSet" />
				</javaclass>
			</type>
			<derivation>
				<fixedlist>
					<listof>
						<ruleclass name="Validation"
							ruleset="EvidenceValidationRuleSet" />
					</listof>
					<members>
						<reference
							attribute="fiftyPercentageCheckForNonDeemedResidentValidator" />
						<reference
							attribute="percentageIsMandatoryForNonDeemedResidentValidator" />
						<reference
							attribute="percentageMustBeBlankForDeemedResidentValidator" />
						<reference
							attribute="retroActiveNRTRecoveryStartDateMustBeCurrentOrAfterCurrentDateValidator" />
						<reference
							attribute="endDateIsMoreThanEndDateOfYearForDeemedResidentAndRetroactiveNRTRecoveryValidator" />
						<reference
							attribute="countryIsMandatoryForDeemedResidentValidator" />
					</members>
				</fixedlist>
			</derivation>
		</Attribute>
		<Attribute
			name="fiftyPercentageCheckForNonDeemedResidentValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference
						attribute="fiftyPercentageCheckForNonDeemedResidentFailure" />
					<reference
						attribute="fiftyPercentageCheckForNonDeemedResidentFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute
			name="fiftyPercentageCheckForNonDeemedResidentFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<all>
								<fixedlist>
									<listof>
										<javaclass name="Boolean" />
									</listof>
									<members>
										<not>
											<equals>
												<null />
												<reference attribute="correctionReason">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<not>
											<equals>
												<Code table="BDMOASNRTCorrectionReason">
													<String value="OASNRTCR02" />
												</Code>
												<reference attribute="correctionReason">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<compare comparison="&gt;">
											<reference attribute="percentage">
												<reference attribute="evidence" />
											</reference>
											<Number value="50" />
										</compare>
									</members>
								</fixedlist>
							</all>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute
			name="fiftyPercentageCheckForNonDeemedResidentFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_PERCENTAGE_CAN_NOT_MORE_THAN_FIFTY_PERCENT_FOR_CORRECTION_REASON_NON_DEEMED_RESIDENT"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>


		<Attribute
			name="percentageIsMandatoryForNonDeemedResidentValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference
						attribute="percentageIsMandatoryForNonDeemedResidentFailure" />
					<reference
						attribute="percentageIsMandatoryForNonDeemedResidentFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute
			name="percentageIsMandatoryForNonDeemedResidentFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<all>
								<fixedlist>
									<listof>
										<javaclass name="Boolean" />
									</listof>
									<members>
										<not>
											<equals>
												<null />
												<reference attribute="correctionReason">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<not>
											<equals>
												<Code table="BDMOASNRTCorrectionReason">
													<String value="OASNRTCR02" />
												</Code>
												<reference attribute="correctionReason">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<equals>
											<reference attribute="percentage">
												<reference attribute="evidence" />
											</reference>
											<Number value="0" />
										</equals>
									</members>
								</fixedlist>
							</all>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute
			name="percentageIsMandatoryForNonDeemedResidentFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_PERCENTAGE_MUST_BE_ENTERED_FOR_CORRECTION_REASON_NON_DEEMED_RESIDENT"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>

		<Attribute
			name="percentageMustBeBlankForDeemedResidentValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference
						attribute="percentageMustBeBlankForDeemedResidentFailure" />
					<reference
						attribute="percentageMustBeBlankForDeemedResidentFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute
			name="percentageMustBeBlankForDeemedResidentFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<all>
								<fixedlist>
									<listof>
										<javaclass name="Boolean" />
									</listof>
									<members>
										<not>
											<equals>
												<null />
												<reference attribute="correctionReason">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<equals>
											<Code table="BDMOASNRTCorrectionReason">
												<String value="OASNRTCR02" />
											</Code>
											<reference attribute="correctionReason">
												<reference attribute="evidence" />
											</reference>
										</equals>
										<not>
											<equals>
												<reference attribute="percentage">
													<reference attribute="evidence" />
												</reference>
												<Number value="0" />
											</equals>
										</not>
									</members>
								</fixedlist>
							</all>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute
			name="percentageMustBeBlankForDeemedResidentFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_PERCENTAGE_MUST_BLANK_DEEMED_RESIDENT"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>

		<Attribute
			name="retroActiveNRTRecoveryStartDateMustBeCurrentOrAfterCurrentDateValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference
						attribute="retroActiveNRTRecoveryStartDateMustBeCurrentOrAfterCurrentDateFailure" />
					<reference
						attribute="retroActiveNRTRecoveryStartDateMustBeCurrentOrAfterCurrentDateFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute
			name="retroActiveNRTRecoveryStartDateMustBeCurrentOrAfterCurrentDateFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<all>
								<fixedlist>
									<listof>
										<javaclass name="Boolean" />
									</listof>
									<members>
										<not>
											<equals>
												<null />
												<reference attribute="startDate">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<not>
											<equals>
												<null />
												<reference attribute="correctionReason">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<equals>
											<Code table="BDMOASNRTCorrectionReason">
												<String value="OASNRTCR03" />
											</Code>
											<reference attribute="correctionReason">
												<reference attribute="evidence" />
											</reference>
										</equals>
										<compare comparison="&lt;">
											<reference attribute="startDate">
												<reference attribute="evidence" />
											</reference>
											<call class="curam.ca.gc.bdm.creole.impl.Statics"
												method="getCurrentDate">
												<type>
													<javaclass name="Boolean" />
												</type>
												<arguments />
											</call>
										</compare>
									</members>
								</fixedlist>
							</all>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute
			name="retroActiveNRTRecoveryStartDateMustBeCurrentOrAfterCurrentDateFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_START_DATE_MUST_BE_CURRENT_OR_AFTER_CURRENT_DATE"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>


		<Attribute
			name="endDateIsMoreThanEndDateOfYearForDeemedResidentAndRetroactiveNRTRecoveryValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference
						attribute="endDateIsMoreThanEndDateOfYearForDeemedResidentAndRetroactiveNRTRecoveryFailure" />
					<reference
						attribute="endDateIsMoreThanEndDateOfYearForDeemedResidentAndRetroactiveNRTRecoveryFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute
			name="endDateIsMoreThanEndDateOfYearForDeemedResidentAndRetroactiveNRTRecoveryFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<all>
								<fixedlist>
									<listof>
										<javaclass name="Boolean" />
									</listof>
									<members>
										<not>
											<equals>
												<null />
												<reference attribute="correctionReason">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<any>
											<fixedlist>
												<listof>
													<javaclass name="Boolean" />
												</listof>
												<members>
													<!-- OASNRTCR03 is Retroactive NRT Recovery -->
													<equals>
														<Code table="BDMOASNRTCorrectionReason">
															<String value="OASNRTCR03" />
														</Code>
														<reference attribute="correctionReason">
															<reference attribute="evidence" />
														</reference>
													</equals>

													<!-- OASNRTCR02 is Deemed Resident -->
													<equals>
														<Code table="BDMOASNRTCorrectionReason">
															<String value="OASNRTCR02" />
														</Code>
														<reference attribute="correctionReason">
															<reference attribute="evidence" />
														</reference>
													</equals>
												</members>
											</fixedlist>
										</any>
										<not>
											<equals>
												<null />
												<reference attribute="endDate">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<not>
											<equals>
												<null />
												<reference attribute="startDate">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>

										<compare comparison="&gt;">
											<call class="curam.ca.gc.bdmoas.creole.impl.Statics"
												method="getDateYearValue">
												<type>
													<javaclass name="Number" />
												</type>
												<arguments>
													<reference attribute="endDate">
														<reference attribute="evidence" />
													</reference>
												</arguments>
											</call>
											<call class="curam.ca.gc.bdmoas.creole.impl.Statics"
												method="getDateYearValue">
												<type>
													<javaclass name="Number" />
												</type>
												<arguments>
													<reference attribute="startDate">
														<reference attribute="evidence" />
													</reference>
												</arguments>
											</call>
										</compare>
									</members>
								</fixedlist>
							</all>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute
			name="endDateIsMoreThanEndDateOfYearForDeemedResidentAndRetroactiveNRTRecoveryFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_END_DATE_IS_MORE_THAN_START_DATE_YEAR_MAX_DATE"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>

		<Attribute
			name="countryIsMandatoryForDeemedResidentValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference
						attribute="countryIsMandatoryForDeemedResidentFailure" />
					<reference
						attribute="countryIsMandatoryForDeemedResidentFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute name="countryIsMandatoryForDeemedResidentFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<all>
								<fixedlist>
									<listof>
										<javaclass name="Boolean" />
									</listof>
									<members>
										<equals>
											<null />
											<reference attribute="country">
												<reference attribute="evidence" />
											</reference>
										</equals>

										<!-- OASNRTCR02 is Deemed Resident -->
										<equals>
											<Code table="BDMOASNRTCorrectionReason">
												<String value="OASNRTCR02" />
											</Code>
											<reference attribute="correctionReason">
												<reference attribute="evidence" />
											</reference>
										</equals>
									</members>
								</fixedlist>
							</all>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute
			name="countryIsMandatoryForDeemedResidentFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_COUNTRY_MANDATORY_FOR_DEEMED_RESIDENT"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>
		
		<Attribute name="overlapDeductionExistsValidationValidator">
		<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference
						attribute="overlapDeductionExistsFailure" />
					<reference
						attribute="overlapDeductionExistsFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute name="overlapDeductionExistsFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<!-- OASNRTCR02 is Deemed Resident -->
							<equals>
								<Code table="BDMOASNRTCorrectionReason">
									<String value="OASNRTCR02" />
								</Code>
								<reference attribute="correctionReason">
									<reference attribute="evidence" />
								</reference>
							</equals>
						</condition>
						<value>
							<false/>
						</value>
					</when>
					<when>
						<condition>
							<call class="curam.ca.gc.bdmoas.creole.impl.Statics"
								method="isNRTCorrectionAndDeductionOverlap">
								<type>
									<javaclass name="Boolean" />
								</type>
								<arguments>
									<reference attribute="caseID">
										<reference
											attribute="participantOASProductDeliveryCaseHeader">
										</reference>
									</reference>
									<reference attribute="startDate">
										<reference attribute="evidence" />
									</reference>
									<reference attribute="endDate">
										<reference attribute="evidence" />
									</reference>
								</arguments>
							</call>
						</condition>
						<value>
							<false/>
						</value>
					</when>
					<otherwise>
						<value>
							<true/>
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute
			name="overlapDeductionExistsFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_NO_OVERLAPPING_DEDUCTION_EXISTS"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>
		
		<Attribute name="preModifyValidations">
			<type>
				<javaclass name="java.util.List">
					<ruleclass name="Validation"
						ruleset="EvidenceValidationRuleSet" />
				</javaclass>
			</type>
			<derivation>
				<fixedlist>
					<listof>
						<ruleclass name="Validation"
							ruleset="EvidenceValidationRuleSet" />
					</listof>
					<members>
						<reference attribute="endDateLapsedValidator" />
						<reference 
							attribute="overlapDeductionExistsValidationValidator" />
					</members>
				</fixedlist>
			</derivation>
		</Attribute>

		<Attribute name="endDateLapsedValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference attribute="endDateLapsedFailure" />
					<reference attribute="endDateLapsedFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute name="endDateLapsedFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<compare comparison="&lt;">
					<reference attribute="endDate">
						<reference attribute="evidence" />
					</reference>
					<call class="curam.ca.gc.bdm.creole.impl.Statics"
						method="getCurrentDate">
						<type>
							<javaclass name="Boolean" />
						</type>
						<arguments />
					</call>
				</compare>
			</derivation>
		</Attribute>

		<Attribute name="endDateLapsedFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage key="ERR_END_DATE_LAPSED"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>
		
		
		<Attribute name="preCreateValidations">
			<type>
				<javaclass name="java.util.List">
					<ruleclass name="Validation"
						ruleset="EvidenceValidationRuleSet" />
				</javaclass>
			</type>
			<derivation>
				<fixedlist>
					<listof>
						<ruleclass name="Validation"
							ruleset="EvidenceValidationRuleSet" />
					</listof>
					<members>
						<reference attribute="validateCountryForUSOrUKForDeemedResidentsdValidator" />
						<reference attribute="participantShouldBePayeeValidator"/>
						<reference 
							attribute="overlapDeductionExistsValidationValidator" />
					</members>
				</fixedlist>
			</derivation>
		</Attribute>

		<Attribute name="validateCountryForUSOrUKForDeemedResidentsdValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference attribute="validateCountryForUSOrUKForDeemedResidentsFailure" />
					<reference attribute="validateCountryForUSOrUKForDeemedResidentsFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute name="validateCountryForUSOrUKForDeemedResidentsFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<all>
								<fixedlist>
									<listof>
										<javaclass name="Boolean" />
									</listof>
									<members>
										<not>
											<equals>
												<null />
												<reference attribute="correctionReason">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<not>
											<equals>
												<Code table="BDMOASNRTCorrectionReason">
													<String value="OASNRTCR02" />
												</Code>
												<reference attribute="correctionReason">
													<reference attribute="evidence" />
												</reference>
											</equals>
										</not>
										<any>
										<fixedlist>
											<listof>
												<javaclass name="Boolean" />
											</listof>
											<members>
												<equals>
													<Code table="BDMSourceCountry">
														<String value="US" />
													</Code>
													<reference attribute="country">
														<reference attribute="evidence" />
													</reference>
												</equals>
												<equals>
													<Code table="BDMSourceCountry">
														<String value="GB" />
													</Code>
													<reference attribute="country">
														<reference attribute="evidence" />
													</reference>
												</equals>
											</members>
										</fixedlist>
									  </any>
									</members>
								</fixedlist>
							</all>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>

		<Attribute name="validateCountryForUSOrUKForDeemedResidentsFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage key="ERR_COUNTRY_US_OR_UK_FOR_NON_DEEMED_RESIDENT"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>
		
		<Attribute
			name="participantShouldBePayeeValidator">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference
						attribute="participantShouldBePayeeFailure" />
					<reference
						attribute="participantShouldBePayeeFailureMessage" />
				</create>
			</derivation>
		</Attribute>

		<Attribute name="participantShouldBePayeeFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="Boolean" />
					</type>
					<when>
						<condition>
							<equals>
								<reference attribute="participantOASProductDeliveryCaseHeader"/>
								<null/>
							</equals>
						</condition>
						<value>
							<true/>
						</value>
					</when>
					<when>
						<condition>
							<not>
								<reference attribute="participantIsPayee"/>
							</not>
						</condition>
						<value>
							<true />
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		
		<Attribute name="participantProductDeliveryCaseHeaders">
            <type>
                <javaclass name="List">
                    <ruleclass name="ProductDelivery"
                        ruleset="CaseEntitiesRuleSet" />
                </javaclass>
            </type>
            <derivation>
                <filter>
                    <list>
                        <readall ruleclass="ProductDelivery"
                            ruleset="CaseEntitiesRuleSet">
                            <match
                                retrievedattribute="recipConcernRoleID">
                                <reference attribute="participantRoleID">
                                    <reference
                                        attribute="related_caseParticipantRole">
                                        <reference attribute="evidence" />
                                    </reference>
                                </reference>
                            </match>
                        </readall>
                    </list>
                    <listitemexpression>
                        <equals>
                            <reference
                                attribute="productType">
                                <current />
                            </reference>
                            <Code table="ProductType">
                                <String value="OASPT00001" />
                            </Code>
                        </equals>
                    </listitemexpression>
                </filter>
            </derivation>
        </Attribute>
        
        <Attribute
			name="participantOASProductDeliveryCaseHeader">
			<type>
				<ruleclass name="ProductDelivery"
                        ruleset="CaseEntitiesRuleSet" />
			</type>
			<derivation>
				<singleitem onEmpty="returnNull" onMultiple="returnFirst">
					<reference
						attribute="participantProductDeliveryCaseHeaders" />
				</singleitem>
			</derivation>
		</Attribute>
        
        <Attribute name="caseNomineeParticipantRoleTypes">
        	<type>
                <javaclass name="List">
                    <ruleclass name="CaseParticipantRole"
                        ruleset="CaseEntitiesRuleSet" />
                </javaclass>
            </type>
            <derivation>
            	<filter>
                    <list>
                        <readall ruleclass="CaseParticipantRole"
                            ruleset="CaseEntitiesRuleSet">
                            <match
                                retrievedattribute="caseID">
                                <reference attribute="caseID">
                                    <reference
                                        attribute="participantOASProductDeliveryCaseHeader">
                                    </reference>
                                </reference>
                            </match>
                        </readall>
                    </list>
                    <listitemexpression>
                        <equals>
                            <reference
                                attribute="typeCode">
                                <current />
                            </reference>
                            <Code table="CaseParticipantRoleType">
                                <String value="NOM" />
                            </Code>
                        </equals>
                    </listitemexpression>
                </filter>
            </derivation>
        </Attribute>
        
        <Attribute name="participantIsPayee">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<compare comparison="&gt;">
					<property name="size">
						<object>
							<reference attribute="caseNomineeParticipantRoleTypes">
							</reference>
						</object>
					</property>
					<Number value="0" />
				</compare>
			</derivation>
		</Attribute>

		<Attribute
			name="participantShouldBePayeeFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage
					key="ERR_PARTICIPANT_SHOULD_BE_PAYEE"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASNRTCorrectionValidationRuleSet">
				</ResourceMessage>
			</derivation>
		</Attribute>



	</Class>
</RuleSet>