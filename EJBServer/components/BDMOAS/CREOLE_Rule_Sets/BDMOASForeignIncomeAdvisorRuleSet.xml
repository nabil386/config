<?xml version="1.0" encoding="UTF-8"?>
<RuleSet name="BDMOASForeignIncomeAdvisorRuleSet"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">

 <!--
    Represents advice for foreign income evidence type and income is blank.
-->

	<Class extends="AbstractAdviceContext"
		extendsRuleSet="CoreAdvisorRuleSet"
		name="BDMOASForeignIncomeAdviceContext"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">

		<!-- This attribute value would be prepopulated by the propagator. -->
		<Attribute name="caseID">
			<type>
				<ruleclass name="NumberParameter"
					ruleset="CoreAdvisorRuleSet" />
			</type>
			<derivation>
				<specified />
			</derivation>
		</Attribute>

		<!-- This attribute value would be prepopulated by the propagator -->
		<Attribute name="adviceContextID">
			<type>
				<javaclass name="Number" />
			</type>
			<derivation>
				<specified />
			</derivation>
		</Attribute>

		<!-- This attribute will hold the list of advices which will be sent back 
			to the client -->
		<Attribute name="advice">
			<type>
				<javaclass name="List">
					<ruleclass name="AbstractAdviceItem"
						ruleset="CoreAdvisorRuleSet" />
				</javaclass>
			</type>
			<derivation>
			
			 <fixedlist>
					<listof>
						<ruleclass name="AbstractAdviceItem"
							ruleset="CoreAdvisorRuleSet" />
					</listof>
                   <members>
                        <create ruleclass="BDMOASForeignIncomeAdviceItem">
                            <reference attribute="value">
                                <reference attribute="caseID" />
                            </reference>
                            <reference attribute="adviceContextID" />                         
                        </create>
                   </members>
                </fixedlist>
			</derivation>
		</Attribute>
		
	</Class>


	<Class name="BDMOASForeignIncomeAdviceItem"
		extends="AbstractAdviceItem" extendsRuleSet="CoreAdvisorRuleSet"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">

		<Initialization>
			<Attribute name="caseIDParam">
				<type>
					<javaclass name="Number" />
				</type>
			</Attribute>
			<Attribute name="adviceContextID">
				<type>
					<javaclass name="Number" />
				</type>
			</Attribute>
		</Initialization>
		
		<Attribute name="caseID">
			<type>
				<javaclass name="Number" />
			</type>
			<derivation>
				<reference attribute="caseIDParam" />
			</derivation>
		</Attribute>

		<Attribute name="adviceText">
			<type>
				<javaclass name="String" />
			</type>
			<derivation>
				<String value="ForeignIncomeValidation" />
			</derivation>
		</Attribute>

		<Attribute name="category">
			<type>
				<codetableentry table="AdviceCategory" />
			</type>
			<derivation>
				<Code table="AdviceCategory">
					<String value="AC2000" />
				</Code>
			</derivation>
		</Attribute>

		<Attribute name="priority">
			<type>
				<codetableentry table="AdvicePriority" />
			</type>
			<derivation>
				<Code table="AdvicePriority">
					<String value="AP2000" />
				</Code>
			</derivation>
		</Attribute>

		<Attribute name="status">
			<type>
				<codetableentry table="AdviceStatus" />
			</type>
			<derivation>
				<Code table="AdviceStatus">
					<String value="AS2000" />
				</Code>
			</derivation>
		</Attribute>

		<Attribute name="evidenceType">
			<type>
				<codetableentry table="EvidenceType" />
			</type>
			<derivation>
				<Code table="EvidenceType">
					<String value="OASDET0014" />
				</Code>
			</derivation>
		</Attribute>

		
	<Attribute name="relatedID">
			<type>
				<javaclass name="Number" />
			</type>
			<derivation>
				<Number value="0" />
			</derivation>
		</Attribute>
		
		<Attribute name="showAdvice">
			<type>
				<javaclass name="Boolean" />
			</type>
			<derivation>
				<reference
					attribute="isAdviceToBeDisplayed" />
			</derivation>
		</Attribute>
	
	<Attribute name="foreignIncomeEvdRecords">
			<type>
				<javaclass name="List">
					<ruleclass name="BDMOASForeignIncome"
						ruleset="BDMOASForeignIncomeVerDataRuleSet" />
				</javaclass>
			</type>
			<derivation>
				<readall ruleclass="BDMOASForeignIncome"
					ruleset="BDMOASForeignIncomeVerDataRuleSet">
					<match retrievedattribute="caseID">
						<reference attribute="caseID" />
					</match>
				</readall>
			</derivation>
		</Attribute>
		
	<Attribute name="isAdviceToBeDisplayed">
            <type>
                <javaclass name="Boolean" />
            </type>
            <derivation>
                <any>
                    <fixedlist>
                        <listof>
                            <javaclass name="Boolean" />
                        </listof>
                        <members>
                            <reference attribute="containsEmptyForeignIncomeTypeOrAmount" />
                        </members>
                    </fixedlist>
                </any>
            </derivation>
        </Attribute>
	
		<Attribute name="containsEmptyForeignIncomeTypeOrAmount">
			<type>
				<javaclass name="Boolean" />
			</type>
			<derivation>
				<any>
					<dynamiclist>
						<list alias="foreignIncomeRecord">
							<reference attribute="foreignIncomeEvdRecords" />
						</list>
						<listitemexpression>
							<choose>
								<type>
									<javaclass name="Boolean" />
								</type>
								<when>
									<condition>
										<any>
											<fixedlist>
												<listof>
													<javaclass name="Boolean" />
												</listof>
												<members>
													<equals>
														<reference attribute="amount">
															<current alias="foreignIncomeRecord" />
														</reference>
														<null />
													</equals>
													<equals>
														<reference attribute="amount">
															<current alias="foreignIncomeRecord" />
														</reference>
														<Number value="0"/>
													</equals>
													
													<equals>	
														<reference attribute="incomeType">
															<current alias="foreignIncomeRecord" />
														</reference>
														<Code table="IncomeTypeCode">
															<String value="" />
														</Code>	
													</equals>
												</members>
											</fixedlist>
										</any>
									</condition>
									<value>
										<true />
									</value>
								</when>
								<otherwise>
									<value>
										<false />
									</value>
								</otherwise>
							</choose>
						</listitemexpression>
					</dynamiclist>
				</any>
			</derivation>
		</Attribute>	
	</Class>
</RuleSet>