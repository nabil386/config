<RuleSet
	name="BDMOASBenefitCancellationRequestValidationRuleSet"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="../../../build/svr/creole.gen/schema/RuleSet.xsd">
	<Class extends="DefaultEvidenceValidationResult"
		extendsRuleSet="EvidenceValidationRuleSet" name="ValidationResult">
		<Attribute name="evidence">
			<type>
				<ruleclass name="BDMOASBenefitCancellationRequest"
					ruleset="BDMOASBenefitCancellationRequestRuleSet" />
			</type>
			<derivation>
				<specified />
			</derivation>
		</Attribute>
		<Attribute name="standardValidations">
			<type>
				<javaclass name="java.util.List">
					<ruleclass name="Validation"
						ruleset="EvidenceValidationRuleSet" />
				</javaclass>
			</type>
			<derivation>
				<fixedlist>
					<listof>
						<ruleclass name="Validation"
							ruleset="EvidenceValidationRuleSet" />
					</listof>
					<members>
						<reference attribute="singleGrantedValidation" />
						<reference attribute="allowanceValidation" />
					</members>
				</fixedlist>
			</derivation>
		</Attribute>
		<Attribute name="singleGrantedValidation">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference attribute="singleGrantedFailure" />
					<reference attribute="singleGrantedFailureMessage" />
				</create>
			</derivation>
		</Attribute>
		<Attribute name="singleGrantedFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<choose>
					<type>
						<javaclass name="java.lang.Boolean" />
					</type>
					<when>
						<condition>
							<equals>
								<reference attribute="cancellationStatus">
									<reference attribute="evidence" />
								</reference>
								<Code table="BDMOASCancellationStatus">
									<String value="CST2" />
								</Code>
							</equals>
						</condition>
						<value>
							<choose>
								<type>
									<javaclass name="Boolean" />
								</type>
								<when>
									<condition>
										<equals>
											<null />
											<reference
												attribute="related_BDMOASBenefitCancellationRequest">
												<reference attribute="applicationDetails">
													<reference attribute="evidence" />
												</reference>
											</reference>
										</equals>
									</condition>
									<value>
										<false />
									</value>
								</when>
								<otherwise>
									<value>
										<any>
											<dynamiclist>
												<list>
													<reference
														attribute="related_BDMOASBenefitCancellationRequest">
														<reference attribute="applicationDetails">
															<reference attribute="evidence" />
														</reference>
													</reference>
												</list>
												<listitemexpression>
													<all>
														<fixedlist>
															<listof>
																<javaclass name="java.lang.Boolean" />
															</listof>
															<members>
																<not>
																	<equals>
																		<reference attribute="successionID">
																			<current />
																		</reference>
																		<reference attribute="successionID">
																			<reference attribute="evidence" />
																		</reference>
																	</equals>
																</not>
																<equals>
																	<reference attribute="cancellationStatus">
																		<current />
																	</reference>
																	<reference attribute="cancellationStatus">
																		<reference attribute="evidence" />
																	</reference>
																</equals>
															</members>
														</fixedlist>
													</all>
												</listitemexpression>
											</dynamiclist>
										</any>
									</value>
								</otherwise>
							</choose>
						</value>
					</when>
					<otherwise>
						<value>
							<false />
						</value>
					</otherwise>
				</choose>
			</derivation>
		</Attribute>
		<Attribute name="singleGrantedFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage key="ERR_EXISTING_GRANTED"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASBenefitCancellationRequestValidationRuleSet" />
			</derivation>
		</Attribute>
		<Attribute name="allowanceValidation">
			<type>
				<ruleclass name="Validation"
					ruleset="EvidenceValidationRuleSet" />
			</type>
			<derivation>
				<create ruleclass="Validation"
					ruleset="EvidenceValidationRuleSet">
					<reference attribute="allowanceFailure" />
					<reference attribute="allowanceFailureMessage" />
				</create>
			</derivation>
		</Attribute>
		<Attribute name="allowanceFailure">
			<type>
				<javaclass name="java.lang.Boolean" />
			</type>
			<derivation>
				<equals>
					<reference attribute="benefitType">
						<reference attribute="applicationDetails">
							<reference attribute="evidence" />
						</reference>
					</reference>
					<Code table="BDMOASBenefitType">
						<String value="BT3" />
					</Code>
				</equals>
			</derivation>
		</Attribute>
		<Attribute name="allowanceFailureMessage">
			<type>
				<javaclass name="curam.creole.value.Message" />
			</type>
			<derivation>
				<ResourceMessage key="ERR_ALW_CANCELLATION"
					resourceBundle="curam.ca.gc.bdmoas.evidence.BDMOASBenefitCancellationRequestValidationRuleSet" />
			</derivation>
		</Attribute>
	</Class>
</RuleSet>