<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM
 
  Copyright IBM Corporation 2012. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure 
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!--  BEGIN CR00168004 , AK  -->
<workflow-process
  category="PC1"
  createdBy="unauthenticated"
  creationDate="20070404T151255"
  id="65"
  language-version="1.0"
  process-version="1"
  released="true"
>
  <!-- END CR00168004 -->
  <name>ISSUERESOLUTIONSUBMITTEDTASK</name>


  <!--BEGIN, CR00361282, CL -->
  <process-display-name>
    <localized-text>
      <locale language="en">Issue Resolution Submitted Task</locale>
    </localized-text>
  </process-display-name>
  <!--END, CR00361282 -->


  <!-- BEGIN, CR00248295, NS -->
  <description>
    <localized-text>
      <locale language="en">Creates a task for the supervisor of the case owner of an Issue case when an Issue Resolution has been submitted for approval, to inform the supervisor to review the case and determine if the Issue Resolution should be approved or rejected. When the supervisor approves or rejects the Issue Resolution, a notification is then sent to notify the case owner that the case has been closed upon approval of the Resolution or that the Resolution has been rejected, respectively.</locale>
    </localized-text>
  </description>
  <!-- END, CR00248295 -->


  <enactment-mappings>
    <mapping>
      <source-attribute
        name="caseKey.caseID"
        struct-name="curam.core.sl.struct.IssueResApprovalDetails"
      />
      <target-attribute
        name="caseID"
        wdo-name="CaseIDApprovalRequestID"
      />
    </mapping>
    <mapping>
      <source-attribute
        name="appReqKey.key.approvalRequestID"
        struct-name="curam.core.sl.struct.IssueResApprovalDetails"
      />
      <target-attribute
        name="approvalRequestID"
        wdo-name="CaseIDApprovalRequestID"
      />
    </mapping>
  </enactment-mappings>
  <wdos>
    <wdo is-list-wdo="false">
      <wdo-name>ApprovalDetails</wdo-name>
      <display-name>
        <localized-text>
          <locale language="en">ApprovalDetails</locale>
        </localized-text>
      </display-name>
      <attributes>
        <attribute>
          <attribute-name>issueTypeDesc</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">issueTypeDesc</locale>
            </localized-text>
          </display-name>
          <type>STRING</type>
          <required-at-enactment>false</required-at-enactment>
        </attribute>
        <attribute>
          <attribute-name>requestedDate</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">requestedDate</locale>
            </localized-text>
          </display-name>
          <type>DATE</type>
          <required-at-enactment>false</required-at-enactment>
        </attribute>
        <attribute>
          <attribute-name>approvalStatusDesc</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">approvalStatusDesc</locale>
            </localized-text>
          </display-name>
          <type>STRING</type>
          <required-at-enactment>false</required-at-enactment>
        </attribute>
        <attribute>
          <attribute-name>resolutionID</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">resolutionID</locale>
            </localized-text>
          </display-name>
          <type>INT64</type>
          <required-at-enactment>false</required-at-enactment>
        </attribute>
        <attribute>
          <attribute-name>description</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">description</locale>
            </localized-text>
          </display-name>
          <type>STRING</type>
          <required-at-enactment>false</required-at-enactment>
        </attribute>
        <attribute>
          <attribute-name>requestedByUser</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">requestedByUser</locale>
            </localized-text>
          </display-name>
          <type>STRING</type>
          <required-at-enactment>false</required-at-enactment>
        </attribute>
        <attribute>
          <attribute-name>caseReference</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">caseReference</locale>
            </localized-text>
          </display-name>
          <type>STRING</type>
          <required-at-enactment>false</required-at-enactment>
        </attribute>
      </attributes>
    </wdo>
    <wdo is-list-wdo="false">
      <wdo-name>CaseIDApprovalRequestID</wdo-name>
      <display-name>
        <localized-text>
          <locale language="en">CaseIDApprovalRequestID</locale>
        </localized-text>
      </display-name>
      <attributes>
        <attribute>
          <attribute-name>caseID</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">caseID</locale>
            </localized-text>
          </display-name>
          <type>INT64</type>
          <required-at-enactment>true</required-at-enactment>
        </attribute>
        <attribute>
          <attribute-name>approvalRequestID</attribute-name>
          <display-name>
            <localized-text>
              <locale language="en">approvalRequestID</locale>
            </localized-text>
          </display-name>
          <type>INT64</type>
          <required-at-enactment>true</required-at-enactment>
        </attribute>
      </attributes>
    </wdo>
  </wdos>
  <activities>
    <start-process-activity id="1">
      <name>
        <localized-text>
          <locale language="en">Start Process Activity</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">The start process activity</locale>
        </localized-text>
      </description>
      <split type="none">
        <transition-id idref="1"/>
      </split>
    </start-process-activity>
    <end-process-activity id="2">
      <name>
        <localized-text>
          <locale language="en">End Process Activity</locale>
        </localized-text>
      </name>
      <description>
        <localized-text>
          <locale language="en">The end process activity</locale>
        </localized-text>
      </description>
      <join type="none"/>
    </end-process-activity>
    <automatic-activity id="3">
      <name>
        <localized-text>
          <locale language="en">getDataForTaskAndNotification</locale>
        </localized-text>
      </name>
      <join type="none"/>
      <split type="none">
        <transition-id idref="2"/>
      </split>
      <bpo-mapping
        interface-name="curam.core.sl.intf.IssueDelivery"
        method-name="getRequiredDataForApproval"
      >
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.core.sl.struct.IssueResApprovalDetails">
              <field name="caseKey">
                <struct type="curam.core.sl.struct.CaseIDKey">
                  <field name="caseID">
                    <base-type type="INT64">
                      <wdo-attribute
                        name="caseID"
                        wdo-name="CaseIDApprovalRequestID"
                      />
                    </base-type>
                  </field>
                </struct>
              </field>
              <field name="appReqKey">
                <struct type="curam.core.sl.struct.ApprovalRequestKey">
                  <field name="key">
                    <struct type="curam.core.sl.entity.struct.ApprovalRequestKey">
                      <field name="approvalRequestID">
                        <base-type type="INT64">
                          <wdo-attribute
                            name="approvalRequestID"
                            wdo-name="CaseIDApprovalRequestID"
                          />
                        </base-type>
                      </field>
                    </struct>
                  </field>
                </struct>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
        <return>
          <struct>
            <field name="requestedDate">
              <base-type>
                <wdo-attribute
                  name="requestedDate"
                  wdo-name="ApprovalDetails"
                />
              </base-type>
            </field>
            <field name="resolutionID">
              <base-type>
                <wdo-attribute
                  name="resolutionID"
                  wdo-name="ApprovalDetails"
                />
              </base-type>
            </field>
            <field name="description">
              <base-type>
                <wdo-attribute
                  name="description"
                  wdo-name="ApprovalDetails"
                />
              </base-type>
            </field>
            <field name="issueTypeDescription">
              <base-type>
                <wdo-attribute
                  name="issueTypeDesc"
                  wdo-name="ApprovalDetails"
                />
              </base-type>
            </field>
            <field name="caseReference">
              <base-type>
                <wdo-attribute
                  name="caseReference"
                  wdo-name="ApprovalDetails"
                />
              </base-type>
            </field>
            <field name="requestedByUser">
              <base-type>
                <wdo-attribute
                  name="requestedByUser"
                  wdo-name="ApprovalDetails"
                />
              </base-type>
            </field>
          </struct>
        </return>
      </bpo-mapping>
    </automatic-activity>
    <automatic-activity id="6">
      <name>
        <localized-text>
          <locale language="en">getApprovalRequestStatusDescription</locale>
        </localized-text>
      </name>
      <join type="none"/>
      <split type="none">
        <transition-id idref="6"/>
      </split>
      <bpo-mapping
        interface-name="curam.core.sl.intf.ApprovalRequest"
        method-name="getStatusDescription"
      >
        <formal-parameters>
          <formal-parameter index="0">
            <struct type="curam.core.sl.entity.struct.ApprovalRequestKey">
              <field name="approvalRequestID">
                <base-type type="INT64">
                  <wdo-attribute
                    name="approvalRequestID"
                    wdo-name="CaseIDApprovalRequestID"
                  />
                </base-type>
              </field>
            </struct>
          </formal-parameter>
        </formal-parameters>
        <return>
          <struct>
            <field name="description">
              <base-type>
                <wdo-attribute
                  name="approvalStatusDesc"
                  wdo-name="ApprovalDetails"
                />
              </base-type>
            </field>
          </struct>
        </return>
      </bpo-mapping>
    </automatic-activity>
    <manual-activity id="4">
      <name>
        <localized-text>
          <locale language="en">approveIssueResolution</locale>
        </localized-text>
      </name>
      <join type="none"/>
      <split type="none">
        <transition-id idref="5"/>
      </split>
      <task>
        <message>
          <message-text>
            <localized-text>
              <locale language="en">Issue of type %1s requires approval.</locale>
            </localized-text>
          </message-text>
          <message-parameters>
            <wdo-attribute
              name="issueTypeDesc"
              wdo-name="ApprovalDetails"
            />
          </message-parameters>
        </message>
        <actions>
          <action
            open-modal="true"
            page-id="IssueDelivery_approveResolution"
            principal-action="true"
          >
            <message>
              <message-text>
                <localized-text>
                  <locale language="en">Approve Issue Resolution</locale>
                </localized-text>
              </message-text>
            </message>
            <link-parameter name="caseID">
              <wdo-attribute
                name="caseID"
                wdo-name="CaseIDApprovalRequestID"
              />
            </link-parameter>
            <link-parameter name="resolutionID">
              <wdo-attribute
                name="resolutionID"
                wdo-name="ApprovalDetails"
              />
            </link-parameter>
            <link-parameter name="description">
              <wdo-attribute
                name="description"
                wdo-name="ApprovalDetails"
              />
            </link-parameter>
          </action>
          <action
            open-modal="true"
            page-id="IssueDelivery_rejectResolution"
            principal-action="true"
          >
            <message>
              <message-text>
                <localized-text>
                  <locale language="en">Reject Issue Resolution</locale>
                </localized-text>
              </message-text>
            </message>
            <link-parameter name="caseID">
              <wdo-attribute
                name="caseID"
                wdo-name="CaseIDApprovalRequestID"
              />
            </link-parameter>
            <link-parameter name="resolutionID">
              <wdo-attribute
                name="resolutionID"
                wdo-name="ApprovalDetails"
              />
            </link-parameter>
            <link-parameter name="description">
              <wdo-attribute
                name="description"
                wdo-name="ApprovalDetails"
              />
            </link-parameter>
          </action>
        </actions>
        <allow-deadline-override>false</allow-deadline-override>
        <allow-task-forwarding>true</allow-task-forwarding>
      </task>
      <allocation-strategy
        identifier="curam.core.sl.intf.WorkflowAllocationFunction.caseSupervisorAllocationStrategy"
        type="function"
      >
        <function-mappings>
          <formal-parameters>
            <formal-parameter index="0">
              <struct type="curam.core.sl.struct.CaseIDKey">
                <field name="caseID">
                  <base-type type="INT64">
                    <wdo-attribute
                      name="caseID"
                      wdo-name="CaseIDApprovalRequestID"
                    />
                  </base-type>
                </field>
              </struct>
            </formal-parameter>
          </formal-parameters>
        </function-mappings>
      </allocation-strategy>
      <event-wait wait-on-all-events="false">
        <events>
          <event
            event-class="TASK"
            event-type="CLOSED"
            identifier="1"
          >
            <event-match-attribute
              name="taskID"
              wdo-name="Context_Task"
            />
          </event>
        </events>
      </event-wait>
    </manual-activity>
    <route-activity id="5">
      <name>
        <localized-text>
          <locale language="en">notifyUserOfOutcome</locale>
        </localized-text>
      </name>
      <notification delivery-mechanism="DM1">
        <subject>
          <message>
            <message-text>
              <localized-text>
                <locale language="en">Issue Approval Outcome %1s %2s.</locale>
              </localized-text>
            </message-text>
            <message-parameters>
              <wdo-attribute
                name="issueTypeDesc"
                wdo-name="ApprovalDetails"
              />
              <wdo-attribute
                name="caseReference"
                wdo-name="ApprovalDetails"
              />
            </message-parameters>
          </message>
        </subject>
        <body>
          <message>
            <message-text>
              <localized-text>
                <locale language="en">Issue of type %1s which you submitted for approval on %2d was actioned, the outcome was that it was %3s.</locale>
              </localized-text>
            </message-text>
            <message-parameters>
              <wdo-attribute
                name="issueTypeDesc"
                wdo-name="ApprovalDetails"
              />
              <wdo-attribute
                name="requestedDate"
                wdo-name="ApprovalDetails"
              />
              <wdo-attribute
                name="approvalStatusDesc"
                wdo-name="ApprovalDetails"
              />
            </message-parameters>
          </message>
        </body>
        <allocation-strategy
          identifier="curam.core.sl.intf.NotificationAllocationFunction.defaultStrategy"
          type="function"
        >
          <function-mappings>
            <formal-parameters>
              <formal-parameter index="0">
                <base-type type="STRING">
                  <wdo-attribute
                    name="requestedByUser"
                    wdo-name="ApprovalDetails"
                  />
                </base-type>
              </formal-parameter>
            </formal-parameters>
          </function-mappings>
        </allocation-strategy>
        <actions>
          <action
            page-id="IssueDelivery_home"
            principal-action="false"
          >
            <message>
              <message-text>
                <localized-text>
                  <locale language="en">Issue home page</locale>
                </localized-text>
              </message-text>
            </message>
            <link-parameter name="caseID">
              <wdo-attribute
                name="caseID"
                wdo-name="CaseIDApprovalRequestID"
              />
            </link-parameter>
          </action>
        </actions>
      </notification>
      <join type="none"/>
      <split type="none">
        <transition-id idref="4"/>
      </split>
    </route-activity>
  </activities>
  <transitions>
    <transition
      from-activity-idref="1"
      id="1"
      to-activity-idref="3"
    />
    <transition
      from-activity-idref="3"
      id="2"
      to-activity-idref="4"
    />
    <transition
      from-activity-idref="5"
      id="4"
      to-activity-idref="2"
    />
    <transition
      from-activity-idref="4"
      id="5"
      to-activity-idref="6"
    />
    <transition
      from-activity-idref="6"
      id="6"
      to-activity-idref="5"
    />
  </transitions>
</workflow-process>
