<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
Copyright © 2006 Curam Software Ltd.
All rights reserved.

This software is the confidential and proprietary information of Curam
Software, Ltd. ("Confidential Information"). You shall not disclose
such Confidential Information and shall use it only in accordance with the
terms of the license agreement you entered into with Curam Software.
-->
<!--
Creates a web site for the project by invoking all of the reporting targets
and creating an "index.html" file that links to all of the reports.
-->
<project name="build.site">
  <!--
  These properties are fixed relative to the base directory of the component,
  as the project structure does not vary.
  -->
  <property name="dir.site" value="${dir.target}/site"/>

  <!--
  Import some handy macro definitions.
  -->
  <import file="build-site-macros.xml" />

  <!--
  Invoke the reporting targets (the "clover" target will create the test
  report also) and then create a simple index file that links to the reports.
  -->
  <target name="site" depends="-site-setup, javadoc, checkstyle">
    <mkdir dir="${dir.site}"/>
    <!-- Load the summary properties for the various reports reports. -->
    <property file="${dir.target}/test-report/report.properties"/>
    <property file="${dir.target}/checkstyle-report/report.properties"/>

    <echo file="${dir.site}/index.html"><![CDATA[
      <html>
        <head>
          <title>Component Building Site: ${ant.project.name}</title>
        </head>
        <body>
          <h1>Component Building Site: ${ant.project.name}</h1>
          <h2>Documentation</h2>
          <ul>
            <li><a href="../javadoc/index.html">JavaDoc API
                Documentation</a></li>
          </ul>
          <h2>Reports</h2>
          <table border="1">
            <tr>
              <th>Report</th>
              <th>Details</th>
              <th>Result</th>
            </tr>
    ]]></echo>

    <reportresult title="Unit Test Report" uri="../test-report/html/index.html"
                  details="${test.tests} tests: ${test.errors} errors,
                           ${test.failures} failures"
                  passwidth="${test.pass.rate}" failwidth="${test.fail.rate}"
                  file="${dir.site}/index.html"/>

    <reportresult title="Checkstyle Coding Standards Report"
                  uri="../checkstyle-report/html/index.html"
                  details="${style.files} files: ${style.errors} errors
                           in ${style.files.in.error} files"
                  passwidth="${style.pass.rate}" failwidth="${style.fail.rate}"
                  file="${dir.site}/index.html"/>

    <reportresult title="JavaDoc Validation Report"
                  uri="../javadoc-report/index.html" details=""
                  passwidth="100%" failwidth="0%"
                  file="${dir.site}/index.html"/>

    <echo file="${dir.site}/index.html" append="true"><![CDATA[
          </table>
          <h2>Configuration</h2>
          <table border="1">
            <tr>
              <th>Description</th>
              <th>Value</th>
            </tr>
    ]]></echo>
    <configpath desc="Component base directory" value="${basedir}"
                file="${dir.site}/index.html"/>
    <configpath desc="JDE root directory"       value="${dir.jde}"
                file="${dir.site}/index.html"/>
    <configpath desc="CDEJ release directory"   value="${dir.cdej}"
                file="${dir.site}/index.html"/>
    <configpath desc="SDEJ release directory"   value="${dir.sdej}"
                file="${dir.site}/index.html"/>
    <configpath desc="Java directory"           value="${java.home}"
                file="${dir.site}/index.html"/>
    <configitem desc="Java version"             value="${ant.java.version}"
                file="${dir.site}/index.html"/>
    <configpath desc="J2EE JAR file"            value="${jar.j2ee}"
                file="${dir.site}/index.html"/>
    <configpath desc="Compile classpath"        value="${cp.compile}"
                file="${dir.site}/index.html"/>
    <configpath desc="Compile boot classpath"   value="${cp.boot.compile}"
                file="${dir.site}/index.html"/>
    <configpath desc="Compile test classpath"   value="${cp.compile.test}"
                file="${dir.site}/index.html"/>
    <configpath desc="Compile test boot classpath"
                value="${cp.boot.compile.test}"
                file="${dir.site}/index.html"/>
    <configpath desc="Run test classpath"       value="${cp.run.test}"
                file="${dir.site}/index.html"/>
    <configpath desc="Run test boot classpath"  value="${cp.boot.run.test}"
                file="${dir.site}/index.html"/>
    <configitem desc="Test suite"               value="${test.suite}"
                file="${dir.site}/index.html"/>
    <echo file="${dir.site}/index.html" append="true"><![CDATA[
          </table>
        </body>
      </html>]]></echo>
  </target>

  <!--
  Prevents the checkstyle failures for stopping the site generation. There is
  no simple way to do this for the "javadoc" target, as the task cannot set a
  property to indicate if an error occurred.
  -->
  <target name="-site-setup">
    <property name="no.checkstyle.failure.on.error" value="true" />
  </target>

</project>
