<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2012. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:curam="http://www.curamsoftware.com/curam"
          version="2.0">
  <jsp:directive.page buffer="32kb"
                      contentType="text/html;charset=UTF-8"
                      isErrorPage="false"
                      language="java"
                      pageEncoding="UTF-8"
                      isELIgnored="false"/>
  <jsp:output omit-xml-declaration="yes"/>
  <curam:userPreferences/>
      <jsp:scriptlet>
        String ctx =
              request.getParameter(curam.omega3.taglib.ScreenContext.CTX_PARAM);
        String modalprev = request.getParameter("o3modalprev");
        curam.omega3.taglib.ScreenContext treeContext =
                                        new curam.omega3.taglib.ScreenContext();
        treeContext.clearLayout();
        if (ctx != null &amp;&amp; !ctx.equals("")) {
          treeContext.set(ctx); //allow to override the layout
        }
        if (modalprev != null &amp;&amp; !modalprev.equals("")
             &amp;&amp; treeContext.hasContextBits(curam.omega3.taglib.ScreenContext.MODAL 
                                                    | curam.omega3.taglib.ScreenContext.ACTION)) {
          pageContext.setAttribute("closeFrameset","true");
        } else {
          pageContext.setAttribute("closeFrameset","false");
        }
        treeContext.clearStates();
        treeContext.clear(curam.omega3.taglib.ScreenContext.AGENDA);
        treeContext.clear(curam.omega3.taglib.ScreenContext.TAB);
        treeContext.addContextBits(curam.omega3.taglib.ScreenContext.TREE);
        pageContext.setAttribute("currentContext",treeContext.getValue());
        
        pageContext.setAttribute("treecontrol_frameset_title",
          curam.omega3.util.CDEJResources.getProperty("treecontrol.frameset.title"));
        pageContext.setAttribute("treecontrol_navigation_frame_title",
          curam.omega3.util.CDEJResources.getProperty("treecontrol.navigation.frame.title"));
        pageContext.setAttribute("treecontrol_content_frame_title",
          curam.omega3.util.CDEJResources.getProperty("treecontrol.content.frame.title"));
        
      </jsp:scriptlet>
  <c:url value="" var="navUrl">
    <c:forEach var="current" items="${param}">
      <c:forEach var="paramValue" items="${paramValues[current.key]}">
        <c:choose>
        <c:when test="${current.key=='o3ctx'}">
          <c:param name="o3ctx" value="${currentContext}"/>
        </c:when>
        <c:otherwise>
          <c:param name="${current.key}" value="${paramValue}"/>
        </c:otherwise>
        </c:choose>
      </c:forEach>
    </c:forEach>
    <c:if test="${empty param.o3ctx}">
      <c:param name="o3ctx" value="${currentContext}"/>
    </c:if>
  </c:url>
<jsp:text><![CDATA[<!DOCTYPE html>]]></jsp:text>
  <html>
    <head>
      <title><c:out value="${treecontrol_frameset_title}"/></title>
      <script type="text/javascript" src="/CDEJ/jscript/dojotk/dojo/dojo.js" data-dojo-config="async:0,parseOnLoad:true"/>
      <script type="text/javascript">
        <jsp:scriptlet><![CDATA[out.print("var closeIndicator =");]]></jsp:scriptlet>
        <c:out value="${closeFrameset}"/>
        <jsp:scriptlet><![CDATA[out.print(";");]]></jsp:scriptlet>
      </script>
      <script type="text/javascript">
      <jsp:scriptlet>curam.util.client.jsp.JspUtil.outputJSModulePaths(pageContext);</jsp:scriptlet>
      </script>
      <script type="text/javascript" src="/CDEJ/jscript/cdej-cm.js">// script content</script>
      <script type="text/javascript" src="/CDEJ/jscript/cdej.js">// script content</script>
      <script type="text/javascript">
        require(["curam/core-uim"]);
        <jsp:scriptlet><![CDATA[out.print("var iegtree ='");]]></jsp:scriptlet>
        <c:out value="${navUrl}" escapeXml="true"/>
        <jsp:scriptlet><![CDATA[out.print("';");]]></jsp:scriptlet>
        window.rootObject = 'iegtree';
        var jsBaseURL = curam.util.retrieveBaseURL();
        var jsScreenContext = new curam.util.ScreenContext();
        <jsp:scriptlet><![CDATA[out.print("jsScreenContext.setContext('");]]></jsp:scriptlet>
        <c:out value="${currentContext}"/>
        <jsp:scriptlet><![CDATA[out.print("');");]]></jsp:scriptlet>

        if (jsScreenContext.hasContextBits('MODAL')) {
        	require(["curam/wizard"]);
        	curam.wizard.setupTargetFrameForModals('<c:out value="${treecontrol_frameset_title}"/>');
        }
        if (closeIndicator) {
          curam.util.Dialog.close(true);
        }
		require(["curam/util/onLoad"]);
		var treeURL = window.location.href;
		var pgId = treeURL.substring(treeURL.lastIndexOf("/")+1, treeURL.indexOf("Page"));
        var topmostWin = curam.util.getTopmostWindow();
		topmostWin.dojo.publish(curam.util.onLoad.EVENT, [window.frameElement.id, {pageID:pgId}]);
      </script>
    </head>
    <jsp:scriptlet>
      if(pageContext.getAttribute("htmlDirection").equals("rtl")) {
        </jsp:scriptlet>
          <frameset cols="*,30%" class="outer-frame" frameBorder="1" frameSpacing="5" borderColor="#e1ebfb">
            <frame frameBorder="0" src="loading.jspx?o3ctx=${currentContext}" name="contentframe" id="contentframe" title="${treecontrol_content_frame_title}"/>
            <jsp:scriptlet><![CDATA[out.print("<frame src=\"");]]></jsp:scriptlet><c:out value="${navUrl}" escapeXml="true"/><jsp:scriptlet><![CDATA[out.print("\" frameBorder=\"0\" name=\"navframe\" id=\"navframe\" title=\"");]]></jsp:scriptlet><c:out value="${treecontrol_navigation_frame_title}"/><jsp:scriptlet><![CDATA[out.print("\"/>");]]></jsp:scriptlet>
          </frameset>
        <jsp:scriptlet>
      } else {
        </jsp:scriptlet>
          <frameset cols="30%,*" class="outer-frame" frameBorder="1" frameSpacing="5" borderColor="#e1ebfb">
            <jsp:scriptlet><![CDATA[out.print("<frame src=\"");]]></jsp:scriptlet><c:out value="${navUrl}" escapeXml="true"/><jsp:scriptlet><![CDATA[out.print("\" frameBorder=\"0\" name=\"navframe\" id=\"navframe\" title=\"");]]></jsp:scriptlet><c:out value="${treecontrol_navigation_frame_title}"/><jsp:scriptlet><![CDATA[out.print("\"/>");]]></jsp:scriptlet>
            <frame frameBorder="0" src="loading.jspx?o3ctx=${currentContext}" name="contentframe" id="contentframe" title="${treecontrol_content_frame_title}"/>
          </frameset>
        <jsp:scriptlet>
      }
    </jsp:scriptlet>
  </html>
</jsp:root>
