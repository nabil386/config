-- Licensed Materials - Property of IBM
--
-- PID 5725-H26
--
-- Copyright IBM Corporation 2020. All rights reserved.
--
-- US Government Users Restricted Rights - Use, duplication or disclosure
-- restricted by GSA ADP Schedule Contract with IBM Corp.
--

--
-- Cleanup any existing EJB Timer tables
--
DROP TABLE EJBTimer_PART;
DROP TABLE EJBTimer_TASK;
DROP TABLE EJBTimer_PROP;

--
-- This SQL was generated based on the information here: https://developer.ibm.com/answers/questions/424672/manual-creation-of-ejbpersistenttimer-databases.html
--
CREATE TABLE EJBTimer_PART (ID BIGINT GENERATED ALWAYS AS IDENTITY NOT NULL, EXECUTOR VARCHAR(100) FOR MIXED DATA NOT NULL, EXPIRY BIGINT NOT NULL, HOSTNAME VARCHAR(100) FOR MIXED DATA NOT NULL, LSERVER VARCHAR(100) FOR MIXED DATA NOT NULL, STATES BIGINT NOT NULL, USERDIR VARCHAR(254) FOR MIXED DATA NOT NULL, PRIMARY KEY (ID));

CREATE TABLE EJBTimer_TASK (ID BIGINT GENERATED ALWAYS AS IDENTITY NOT NULL, INAME VARCHAR(254) FOR MIXED DATA NOT NULL, LOADER VARCHAR(254) FOR MIXED DATA NOT NULL, MBITS SMALLINT NOT NULL, NEXTEXEC BIGINT NOT NULL, ORIGSUBMT BIGINT NOT NULL, OWNR VARCHAR(120) FOR MIXED DATA NOT NULL, PARTN BIGINT NOT NULL, PREVSCHED BIGINT, PREVSTART BIGINT, PREVSTOP BIGINT, RESLT BLOB(64000), RFAILS SMALLINT NOT NULL, STATES SMALLINT NOT NULL, TASKB BLOB(64000), TASKINFO BLOB(64000) NOT NULL, TRIG BLOB(64000), TXTIMEOUT INTEGER NOT NULL, VERSION INTEGER NOT NULL, PRIMARY KEY (ID));

CREATE TABLE EJBTimer_PROP (ID VARCHAR(254) FOR MIXED DATA NOT NULL, VAL VARCHAR(254) FOR MIXED DATA NOT NULL, PRIMARY KEY (ID));

ALTER TABLE EJBTimer_PART ADD CONSTRAINT EJBTimer_PART0 UNIQUE (EXECUTOR, HOSTNAME, LSERVER, USERDIR);
