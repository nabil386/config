<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2020. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->

<server description="Server security configuration">

  <ssl clientAuthentication="false" clientAuthenticationSupported="false" id="defaultSSLConfig" keyStoreRef="defaultKeyStore"
       securityLevel="HIGH" sslProtocol="TLSv1.2"  />
  <keyStore id="defaultKeyStore" location="key.jks" password="{xor}Lz4sLCgwLTs=" type="JKS"/>

  <basicRegistry id="basic" realm="BasicRegistry">
    <user name="${%security.username%}" password="${%security.password%}" />
    <user name="${%curam.security.credentials.async.username%}" password="${%curam.security.credentials.async.password%}" />

    <group name="everyone"/>
  </basicRegistry>

  <administrator-role>
    <user>${%security.username%}</user>
  </administrator-role>

  <authentication id="Basic" cacheEnabled="true"/>
  <authCache initialSize="100" maxSize="50000" timeout="15m"/>


  <library description="Custom login module shared library" filesetRef="registryFileSet" id="customLoginLib" name="customLoginLib"/>
  <fileset dir="${shared.resource.dir}" id="registryFileSet" includes="*.jar"/>

  <jaasLoginContextEntry id="system.WEB_INBOUND" loginModuleRef="myCustomWebInbound,hashtable,userNameAndPassword,certificate,token" name="system.WEB_INBOUND"/>
  <jaasLoginModule className="curam.util.security.CuramLoginModule" controlFlag="REQUIRED" id="myCustomWebInbound" libraryRef="customLoginLib">
    <options exclude_usernames="${%security.username%},${%curam.security.credentials.async.username%}" 
      login_trace="${%curam.security.login.trace%}" 
      enable_saml="${%curam.security.login.saml%}"
      exclude_usernames_delimiter="${%curam.security.usernames.delimiter%}"
      check_identity_only="${%curam.security.check.identity.only%}"
      user_registry_enabled="${%curam.security.user.registry.enabled%}"
      user_registry_enabled_types="${%curam.security.user.registry.enabled.types%}"
      user_registry_disabled_types="${%curam.security.user.registry.disabled.types%}"/>
  </jaasLoginModule>

  <jaasLoginContextEntry id="system.DEFAULT" loginModuleRef="myCustomDefault,hashtable,userNameAndPassword,certificate,token" name="system.DEFAULT"/>
  <jaasLoginModule className="curam.util.security.CuramLoginModule" controlFlag="REQUIRED" id="myCustomDefault" libraryRef="customLoginLib">
    <options exclude_usernames="${%security.username%},${%curam.security.credentials.async.username%}" 
      login_trace="${%curam.security.login.trace%}" 
      enable_saml="${%curam.security.login.saml%}"
      exclude_usernames_delimiter="${%curam.security.usernames.delimiter%}"
      check_identity_only="${%curam.security.check.identity.only%}"
      user_registry_enabled="${%curam.security.user.registry.enabled%}"
      user_registry_enabled_types="${%curam.security.user.registry.enabled.types%}"
      user_registry_disabled_types="${%curam.security.user.registry.disabled.types%}"/>
  </jaasLoginModule>

  <orb id="defaultOrb">
    <serverPolicy.csiv2>
      <layers>
        <authenticationLayer mechanisms="LTPA" establishTrustInClient="Supported"/>
      </layers>
    </serverPolicy.csiv2>
  </orb>

</server>
