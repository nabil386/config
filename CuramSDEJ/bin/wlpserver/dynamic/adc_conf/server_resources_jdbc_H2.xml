<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2020. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->

<server description="Server JDBC Resource Configuration">

  <!-- ========================== Libraries ========================== -->
  <library id="H2Lib">
    <fileset dir="${shared.resource.dir}/drivers"
      includes="h2-${%h2.jar.version%}.jar" />
  </library>

  <!-- ========================== Drivers ========================== -->
  <jdbcDriver id="CuramJdbcDriverH2" libraryRef="H2Lib"
    javax.sql.XADataSource="org.h2.jdbcx.JdbcDataSource"
    javax.sql.ConnectionPoolDataSource="org.h2.jdbcx.JdbcDataSource"
    javax.sql.DataSource="org.h2.jdbcx.JdbcDataSource" />

  <!-- ========================== Data Sources ========================== -->
  <dataSource id="curamdb" jndiName="jdbc/curamdb"
    isolationLevel="TRANSACTION_READ_COMMITTED"
    jdbcDriverRef="CuramJdbcDriverH2"
  >
    <properties 
      user="${%curam.db.username%}"
      password="${%curam.db.password%}"
      url="jdbc:h2:${%curam.db.h2.protocol%}${%curam.db.h2.directory%}/${%curam.db.name%};MVCC=${%curam.db.h2.mvcc%};MV_STORE=false;FILE_LOCK=SOCKET;SCHEMA=${%curam.db.username%}" />
  </dataSource>

  <dataSource id="curamsib" jndiName="jdbc/curamsib"
    isolationLevel="TRANSACTION_READ_COMMITTED"
    jdbcDriverRef="CuramJdbcDriverH2"
  >
    <properties
      user="${%curam.db.username%}"
      password="${%curam.db.password%}"
      url="jdbc:h2:${%curam.db.h2.protocol%}${%curam.db.h2.directory%}/${%curam.db.name%};MVCC=${%curam.db.h2.mvcc%};MV_STORE=false;FILE_LOCK=SOCKET;SCHEMA=${%curam.db.username%}" />
  </dataSource>

  <!-- For EJB timer support -->
  <!-- ID of DefaultDataSource IS REQUIRED TO SUPPORT EJB TIMERS -->
  <dataSource id="DefaultDataSource"
    isolationLevel="TRANSACTION_READ_COMMITTED"
    jdbcDriverRef="CuramJdbcDriverH2" jndiName="jdbc/curamtimerdb"
  >
    <properties
      user="${%curam.db.username%}"
      password="${%curam.db.password%}"
      url="jdbc:h2:${%curam.db.h2.protocol%}${%curam.db.h2.directory%}/${%curam.db.name%};MVCC=${%curam.db.h2.mvcc%};MV_STORE=false;FILE_LOCK=SOCKET;SCHEMA=${%curam.db.username%}" />
  </dataSource>
  <!-- Note: createTables is set to "false" as the EJB timer tables are created via the configure target using static SQL. -->
  <databaseStore id="EJBTimerDatabaseStore" tablePrefix="EJBTimer_" dataSourceRef="DefaultDataSource" createTables="false" />
  <persistentExecutor id="defaultEJBPersistentTimerExecutor" taskStoreRef="EJBTimerDatabaseStore" missedTaskThreshold="5m"/>

  
  <!-- DataSource for Liberty session persistence -->
  <dataSource id="curamsessdb"
    isolationLevel="TRANSACTION_READ_COMMITTED"
    jdbcDriverRef="CuramJdbcDriverH2" jndiName="jdbc/curamsessdb"
  >
    <properties
      user="${%curam.db.username%}"
      password="${%curam.db.password%}"
      url="jdbc:h2:${%curam.db.h2.protocol%}${%curam.db.h2.directory%}/${%curam.db.name%};MVCC=${%curam.db.h2.mvcc%};MV_STORE=false;FILE_LOCK=SOCKET;SCHEMA=${%curam.db.username%}" />
  </dataSource>
  
  <httpSessionDatabase
    id="SessionDB" dataSourceRef="curamsessdb" tableName="WLP_SESSION"
    skipIndexCreation="true"
  />

</server>
