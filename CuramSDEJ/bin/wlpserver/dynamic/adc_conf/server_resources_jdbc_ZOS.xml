<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2020. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->

<server description="Server JDBC Resource Configuration">

  <!-- ========================== Libraries ========================== -->
  <library id="DB2JCC4Lib">
    <fileset dir="${shared.resource.dir}/drivers"
      includes="db2jcc4.jar db2jcc_license_cu.jar" />
  </library>

  <!-- ========================== Drivers ========================== -->
  <jdbcDriver id="CuramJdbcDriverDB2" libraryRef="DB2JCC4Lib" />

  <!-- ========================== Data Sources ========================== -->
  <dataSource id="curamdb" jndiName="jdbc/curamdb"
    isolationLevel="TRANSACTION_READ_COMMITTED"
    jdbcDriverRef="CuramJdbcDriverDB2" type="javax.sql.XADataSource"
  >
    <properties.db2.jcc databaseName="${%curam.db.name%}"
      fullyMaterializeLobData="false" portNumber="${%curam.db.serverport%}"
      serverName="${%curam.db.servername%}" password="${%curam.db.password%}"
      user="${%curam.db.username%}" sslConnection="${%curam.db2.ssl%}" ${%sslTrustStoreLocation%} ${%sslTrustStorePassword%} />
  </dataSource>

  <dataSource id="curamsib" jndiName="jdbc/curamsib"
    isolationLevel="TRANSACTION_READ_COMMITTED"
    jdbcDriverRef="CuramJdbcDriverDB2" type="javax.sql.XADataSource"
  >
    <properties.db2.jcc databaseName="${%curam.db.name%}"
      fullyMaterializeLobData="false" portNumber="${%curam.db.serverport%}"
      serverName="${%curam.db.servername%}" password="${%curam.db.password%}"
      user="${%curam.db.username%}" sslConnection="${%curam.db2.ssl%}" ${%sslTrustStoreLocation%} ${%sslTrustStorePassword%} />
  </dataSource>

  <!-- For EJB timer support -->
  <!-- ID of DefaultDataSource IS REQUIRED TO SUPPORT EJB TIMERS -->
  <dataSource id="DefaultDataSource"
    isolationLevel="TRANSACTION_READ_COMMITTED"
    jdbcDriverRef="CuramJdbcDriverDB2" jndiName="jdbc/curamtimerdb"
    type="javax.sql.XADataSource"
  >
    <properties.db2.jcc databaseName="${%curam.db.name%}"
      fullyMaterializeLobData="false" portNumber="${%curam.db.serverport%}"
      serverName="${%curam.db.servername%}" password="${%curam.db.password%}"
      user="${%curam.db.username%}" sslConnection="${%curam.db2.ssl%}" ${%sslTrustStoreLocation%} ${%sslTrustStorePassword%} />
  </dataSource>
  <!-- Note: createTables is set to "false" as the EJB timer tables are created via the configure target using static SQL. -->
  <databaseStore id="EJBTimerDatabaseStore" tablePrefix="EJBTimer_" dataSourceRef="DefaultDataSource" createTables="false" />
  <persistentExecutor id="defaultEJBPersistentTimerExecutor" taskStoreRef="EJBTimerDatabaseStore" missedTaskThreshold="5m"/>

  
  <!-- DataSource for Liberty session persistence -->
  <dataSource id="curamsessdb"
    isolationLevel="TRANSACTION_READ_COMMITTED"
    jdbcDriverRef="CuramJdbcDriverDB2" jndiName="jdbc/curamsessdb"
    type="javax.sql.XADataSource"
  >
    <properties.db2.jcc databaseName="${%curam.db.name%}"
      fullyMaterializeLobData="false" portNumber="${%curam.db.serverport%}"
      serverName="${%curam.db.servername%}" password="${%curam.db.password%}"
      user="${%curam.db.username%}" sslConnection="${%curam.db2.ssl%}" ${%sslTrustStoreLocation%} ${%sslTrustStorePassword%} />
  </dataSource>
  
  <httpSessionDatabase
    id="SessionDB" dataSourceRef="curamsessdb" db2RowSize="32KB" tableName="WLP_SESSION"
    skipIndexCreation="true"
  />

</server>
