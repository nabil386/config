<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2012,2020. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!--

  This is the ant macros file for Curam projects.
  It contains any useful macros used by the application build.

-->
<project name="app_macros" default="exec.os.windows">

  <!--  *****************************************************************  -->
  <!--  ***  Macro to control failure on error for Windows bat files  ***  -->
  <!--  *****************************************************************  -->
  <macrodef name="execos">

    <attribute name="command"       default=""/>
    <attribute name="options"       default=""/>
    <attribute name="dir"           default="."/>
    <attribute name="fail.required" default=""/>

    <sequential>
      <condition property="os.windows">
        <os family="windows"/>
      </condition>

      <antcall target="exec.os.windows">
        <param name="command"       value="@{command}"/>
        <param name="options"       value="@{options}"/>
        <param name="dir"           value="@{dir}"/>
        <param name="fail.required" value="@{fail.required}"/>
      </antcall>

      <antcall target="exec.os.unix">
        <param name="command"       value="@{command}"/>
        <param name="options"       value="@{options}"/>
        <param name="dir"           value="@{dir}"/>
        <param name="fail.required" value="@{fail.required}"/>
      </antcall>

    </sequential>
  </macrodef>

  <target name="exec.os.windows" if="os.windows">
    <exec executable="cmd.exe" failonerror="${fail.required}" dir="${dir}">
      <arg line="/c call ${command} ${options}"/>
    </exec>
  </target>

  <target name="exec.os.unix" unless="os.windows">
    <exec executable="${command}" failonerror="${fail.required}" dir="${dir}">
      <arg line="${options}"/>
    </exec>
  </target>

  <macrodef name="deleteFromZip">
    <attribute name="zip"/>
    <attribute name="verbose" default="false" />
    <element name="members"
           implicit="true"
           optional="false"/>
    <sequential>
      <mkdir dir="@{zip}-TEMP"/>
      <unzip dest="@{zip}-TEMP" src="@{zip}"/>
      <delete file="@{zip}" verbose="@{verbose}"/>
      <delete verbose="@{verbose}">
        <fileset dir="@{zip}-TEMP">
          <members/>
        </fileset>
      </delete>
      <zip destfile="@{zip}"
           basedir="@{zip}-TEMP"/>
      <delete dir="@{zip}-TEMP"/>
    </sequential>
  </macrodef>

  <!--  ***************************************************************************  -->
  <!--  ***  Macro to check whether a file is available or not and fail if not  ***  -->
  <!--  ***************************************************************************  -->
  <macrodef name="fileavailable">
    <attribute name="file"       default=""/>
    <attribute name="type"       default=""/>
    <sequential>
    <available property="@{file}.file.available" value="true" file="@{file}" type="@{type}"/>
    <fail message="The following @{type} - @{file} could not be located." unless="@{file}.file.available"/>
    </sequential>
  </macrodef>

</project>