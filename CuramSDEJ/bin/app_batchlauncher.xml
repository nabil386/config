<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2012,2014. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!--

  This is the ant file for starting the Batch Launcher.

-->
<project name="app_batchlauncher" default="main">

  <!--  ***************************  -->
  <!--  ***  Import Properties  ***  -->
  <!--  ***************************  -->
  <import file="./app_properties.xml" />

  <!-- build utilities -->
  <import file="./app_utilities.xml" />

  <!--  **************************************  -->
  <!--  ***   B A T C H   L A U N C H E R  ***  -->
  <!--  **************************************  -->
  <target name="main" description="Start the Batch Launcher">
    <antcall target="dispmsg" inheritall="false">
      <param name="prm.msg" value="Starting batchlauncher"/>
    </antcall>

    <!-- Set the starting time stamp for use in file names -->
    <tstamp><format property="tim.start.sort" pattern="yyyyMMddHHmmss"/></tstamp>

    <!-- Start recording progress to a log file -->
    <mkdir dir="${dir.bld.log}"/>
    <record name="${dir.bld.log}/BatchLauncher${tim.start.sort}.log" loglevel="info" />

    <!-- On zOS, put in noargsconversion -->
    <condition property="java.extra.jvmargs" value="-Xnoargsconversion" >
      <os family="z/os"/>
    </condition>
    <property name="java.extra.jvmargs" value="-Dfake.property=1"/>

    <property name="batch.program"    value=" "/>
    <property name="batch.parameters" value=" "/>
    <property name="batch.username"   value=" "/>
    <property name="disable.database.callback"   value=" "/>
    <property name="batch.base.dir"   value="${dir.bld.log}"/>
    <property name="curam.disable.dynamic.properties"   value="false"/>
    <property name="force.disable.in.standalone" value=" "/>

    <mkdir dir="${batch.base.dir}"/>

    <!-- Start the Batch Launcher -->
    <java
      dir="${batch.base.dir}"
      classname="curam.util.impl.BatchLauncher"
      classpathref="j.cp"
      fork="${java.fork}"
      failonerror="${java.failonerror}"
      maxmemory="${java.maxmemory}"
      taskname="batchlauncher"
    >
      <sysproperty key="curam.disable.dynamic.properties" value="${curam.disable.dynamic.properties}"/>
      <jvmarg line="${java.jvmargs}" />
      <jvmarg value="-Xms${java.maxmemory}" />
      <jvmarg line="${java.extra.jvmargs}" />
      <jvmarg value="-Dconsole.encoding=${java.console.encoding}" />
      <jvmarg value="-Dfile.encoding=UTF-8" />
      <jvmarg value="-Xbootclasspath/p:${jars.allxml}" />
      <arg value="${batch.program}" />
      <arg value="${batch.parameters}" />
      <arg value="${batch.username}" />
      <arg value="${disable.database.callback}" />
      <arg value="${force.disable.in.standalone}" />
    </java>

    <antcall target="dispmsg" inheritall="false">
      <param name="prm.msg" value="Ending batchlauncher"/>
    </antcall>
  </target>

</project>

