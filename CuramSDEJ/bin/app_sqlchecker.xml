<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2012,2021. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!--

  This is the ant file for running the SQL Checker.

-->
<project name="app_sqlchecker" default="check.sql">

  <!--  ***************************  -->
  <!--  ***  Import Properties  ***  -->
  <!--  ***************************  -->
  <import file="./app_properties.xml" />

  <!--  **************************  -->
  <!--  ***  Import Utilities  ***  -->
  <!--  **************************  -->
  <import file="./app_utilities.xml" />

  <!--  *******************************  -->
  <!--  ***  S Q L   C H E C K E R  ***  -->
  <!--  *******************************  -->

  <!--  *************************  -->
  <!--  *** C H E C K   S Q L ***  -->
  <!--  *************************  -->
  <target name="check.sql"
       depends="check.db.type, run.database.db2, run.database.ora, run.database.h2,
                run.database.zos, get.replaced.project.package">

    <!-- Start recording progress to a log file -->
    <mkdir dir="${dir.bld.log}"/>

    <!-- Set the starting time stamp for use in file names -->
    <tstamp><format property="tim.start.sort" pattern="yyyyMMddHHmmss"/></tstamp>
    <record name="${dir.bld.log}/SQLChecker${tim.start.sort}.log" loglevel="info" />

    <antcall target="dispmsg" inheritAll="false">
      <param name="prm.msg" value="Invoking the SQL Checker"/>
    </antcall>

    <!-- Set this here so it can be overridden from build.bat or ANT_OPTS -->
    <property name="portability.warnings" value="DMX,BUILD"/>

    <!-- Make the temp directory -->
    <delete dir="${dir.bld}/sqlcheck"/>
    <mkdir dir="${dir.bld}/sqlcheck" />


    <path id="sqlchecker.path">
      <pathelement path="${sysenv.PRE_CLASSPATH}"/>
      <pathelement location="${dir.bld.svr.cls}"/>
      <pathelement location="${jar.struct}"/>
      <fileset dir="${base.dir}/components">
        <include name="*/lib/**/*.jar"/>
      </fileset>
      <pathelement location="${jar.coreinf}"/>
      <pathelement location="${jar.gss}"/>
      <pathelement location="${jar.appinf}"/>
      <pathelement location="${jar.appinf_internal}"/>
      <pathelement location="${sqlj.classpath}"/>
      <pathelement path="${sysenv.POST_CLASSPATH}"/>
    </path>
    <property name="sqlchecker.src.path" refid="sqlchecker.path"/>

    <java
      classname="curam.util.tools.sqlcheck.SQLCheck"
      classpath="${jar.tools}:${jar.dom4j}:${jar.jaxen}:${jar.coreinf}:${jar.log4j.2.core}:${jar.log4j.2.api}:
                 ${jar.ant}:${jar.clover}:${prop.file.location}:${crypto.prop.file.location}:
                 ${dir.bld.svr.cls}:${prop.jde.commons.jars.classpath}:${jar.commons}:
                 ${jar.guice}:${jar.guava}:${jar.failureaccess}:${jar.javax.inject}:${jar.aopalliance}:${jar.guice-assistedinject}:
                 ${jar.guice-multibindings}:${jar.guice-throwingproviders}"
      fork="${java.fork}"
      failonerror="${java.failonerror}"
      maxmemory="${java.maxmemory}"
      taskname="sqlcheck"
    >
      <jvmarg line="${java.jvmargs}" />
      <jvmarg value="-Xms${java.maxmemory}" />
      <jvmarg value="-Xbootclasspath/p:${jars.allxml}" />
      <sysproperty key="curam.disable.dynamic.properties"     value="true"/>
      <arg line="-ddllocation ${dir.bld}/ddl" />
      <arg line="-portabilitywarnings ${portability.warnings}" />
      <arg line="-outdir ${dir.bld}/sqlcheck" />
      <arg line="-driver ${db.driver}" />
      <arg line="-url ${db.url}" />
      <arg line="-userid ${curam.db.username}" />
      <arg line="-password ${curam.db.password}" />
      <arg line="-basedir ${base.dir}" />
      <arg line="-curamsdej ${dir.sde}" />
      <arg line="-datamanagerconfig ${datamanager.config.file}" />
      <arg value="-classpath" />
      <arg path="${sqlchecker.src.path}" />
    </java>


  </target>

  <!--  *****************  -->
  <!--  ***  THE END  ***  -->
  <!--  *****************  -->

</project>

