<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM
  
  Copyright IBM Corporation 2012. All Rights Reserved.
 
  US Government Users Restricted Rights - Use, duplication or disclosure 
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->  
<!-- Copyright (c) 2008 Curam Software Ltd.                                 -->
<!-- All rights reserved.                                                   -->
<!-- This software is the confidential and proprietary information of Curam -->
<!-- Software, Ltd. ("Confidential Information"). You shall not disclose    -->
<!-- such Confidential Information and shall use it only in accordance with -->
<!-- the terms of the license agreement you entered into with Curam         -->
<!-- Software.                                                              -->
<!-- Description -->
<!-- =========== -->
<!-- Page used to link from the IEGTester page to the IEGScriptPlayer JSP.  -->
<!-- A check for validation errors is carried out first and if there are    -->
<!-- any present, the validation errors page is displayed.                  -->
<PAGE PAGE_ID="Datastore_clearIEGCache">
	<JSP_SCRIPTLET>
    <![CDATA[
    
      curam.omega3.request.RequestHandler 
        rh = curam.omega3.request.
          RequestHandlerFactory.getRequestHandler(request);

      String context = request.getContextPath() + "/";
      String contextWithUserPreferences = context +
        curam.omega3.user.UserPreferencesFactory
          .getUserPreferences(pageContext.getSession()).getLocale() + "/";
       
      String url = null;
          
      // Clear the client IEG script definition cache.
      curam.ieg.player.IEGScriptCache.clearCacheNoJMS();
      
      // Clear the properties store and the application resource cache. This 
      // call will only affect these caches in the development environment. JMS
      // messaging is used to invalidate caches in production.
      curam.util.client.application.
        CacheInvalidationHelper.invalidateAllNoJMS();
      // if we clear the IEG script cache, we need to make sure domains are
      // also reloaded.
      curam.ieg.player.IEGPlayerRenderer.resetDynamicDomains();
      
      url = contextWithUserPreferences + "IEG2_listAllDatastoreSchemasPage.do?" + rh.getSystemParameters();        
      
      // Redirect to the correct page.
      response.sendRedirect(response.encodeRedirectURL(url));
    ]]>
  </JSP_SCRIPTLET>
</PAGE>
