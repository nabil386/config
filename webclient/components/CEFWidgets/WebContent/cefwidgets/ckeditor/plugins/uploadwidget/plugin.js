/**
 * @license Copyright (c) 2003-2016, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
"use strict";!function(){function e(e,t,o){var a=CKEDITOR.fileTools,i=e.uploadRepository,n=o.supportedTypes?10:20;o.fileToElement&&e.on("paste",function(n){var d,l,r=n.data,s=r.dataTransfer,u=s.getFilesCount(),p=o.loadMethod||"loadAndUpload";if(!r.dataValue&&u)for(l=0;u>l;l++)if(d=s.getFile(l),!o.supportedTypes||a.isTypeSupported(d,o.supportedTypes)){var c=o.fileToElement(d),f=i.create(d);c&&(f[p](o.uploadUrl),CKEDITOR.fileTools.markElement(c,t,f.id),("loadAndUpload"==p||"upload"==p)&&CKEDITOR.fileTools.bindNotifications(e,f),r.dataValue+=c.getOuterHtml())}},null,null,n),CKEDITOR.tools.extend(o,{downcast:function(){return new CKEDITOR.htmlParser.text("")},init:function(){var t,o,a=this,n=this.wrapper.findOne("[data-cke-upload-id]").data("cke-upload-id"),d=i.loaders[n],l=CKEDITOR.tools.capitalize;d.on("update",function(i){if(!a.wrapper||!a.wrapper.getParent())return e.editable().find('[data-cke-upload-id="'+n+'"]').count()||d.abort(),void i.removeListener();e.fire("lockSnapshot");var r="on"+l(d.status);return"function"==typeof a[r]&&a[r](d)===!1?void e.fire("unlockSnapshot"):(o="cke_upload_"+d.status,a.wrapper&&o!=t&&(t&&a.wrapper.removeClass(t),a.wrapper.addClass(o),t=o),("error"==d.status||"abort"==d.status)&&e.widgets.del(a),void e.fire("unlockSnapshot"))}),d.update()},replaceWith:function(t,o){if(""===t.trim())return void e.widgets.del(this);var a,i,n=this==e.widgets.focused,d=e.editable(),l=e.createRange();n||(i=e.getSelection().createBookmarks()),l.setStartBefore(this.wrapper),l.setEndAfter(this.wrapper),n&&(a=l.createBookmark()),d.insertHtmlIntoRange(t,l,o),e.widgets.checkWidgets({initOnlyNew:!0}),e.widgets.destroy(this,!0),n?(l.moveToBookmark(a),l.select()):e.getSelection().selectBookmarks(i)}}),e.widgets.add(t,o)}function t(e,t,o){e.setAttributes({"data-cke-upload-id":o,"data-widget":t})}function o(e,t){function o(){a=e._.uploadWidgetNotificaionAggregator,(!a||a.isFinished())&&(a=e._.uploadWidgetNotificaionAggregator=new CKEDITOR.plugins.notificationAggregator(e,e.lang.uploadwidget.uploadMany,e.lang.uploadwidget.uploadOne),a.once("finished",function(){var t=a.getTaskCount();0===t?a.notification.hide():a.notification.update({message:1==t?e.lang.uploadwidget.doneOne:e.lang.uploadwidget.doneMany.replace("%1",t),type:"success",important:1})}))}var a,i=null;t.on("update",function(){!i&&t.uploadTotal&&(o(),i=a.createTask({weight:t.uploadTotal})),i&&"uploading"==t.status&&i.update(t.uploaded)}),t.on("uploaded",function(){i&&i.done()}),t.on("error",function(){i&&i.cancel(),e.showNotification(t.message,"warning")}),t.on("abort",function(){i&&i.cancel(),e.showNotification(e.lang.uploadwidget.abort,"info")})}CKEDITOR.plugins.add("uploadwidget",{lang:"cs,da,de,de-ch,el,en,eo,eu,fr,gl,hu,id,it,km,ko,ku,nb,nl,pl,pt,pt-br,ru,sv,tr,ug,uk,zh,zh-cn",requires:"widget,clipboard,filetools,notificationaggregator",init:function(e){e.filter.allow("*[!data-widget,!data-cke-upload-id]")}}),CKEDITOR.fileTools||(CKEDITOR.fileTools={}),CKEDITOR.tools.extend(CKEDITOR.fileTools,{addUploadWidget:e,markElement:t,bindNotifications:o})}();