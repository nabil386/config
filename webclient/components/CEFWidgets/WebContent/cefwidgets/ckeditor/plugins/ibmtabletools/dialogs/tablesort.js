/* Copyright IBM Corp. 2009-2016  All Rights Reserved. *//*Copyright IBM Corp. 2011-2014 All Rights Reserved.*/
CKEDITOR.dialog.add("tablesort",function(t){function e(){for(var t=0;t<o().getChildCount();t++)for(var e=o().getChildren().getItem(t),n=0;n<e.getChildCount();n++)if(e.getChild&&e.getChild(n).getAttribute&&e.getChild(n).getAttribute("rowspan")>1)return!0;return!1}var n,o=function(){var e=t.getSelection().getSelectedElement();if(e&&"table"==e.getName())for(var n=0;n<e.getChildCount();n++)if("tbody"==e.getChild(n).getName())return e.getChild(n)},l=function(e,l,i){function r(t){for(var e=0;e<t.length;e++){var n=t[e].val;if(!isNaN(n))return!0}return!1}function a(t){return function(e,n){var o=e[t]<n[t]?-1:e[t]>n[t]?1:0;return 1*o}}function s(t){return function(e,n){var o=n[t]<e[t]?-1:n[t]>e[t]?1:0;return 1*o}}function g(t){return function(e,n){return u(n[t])-u(e[t])}}function u(t){return t=parseFloat(t),t=isNaN(t)?-1:t}function d(t){return function(e,n){return u(e[t])-u(n[t])}}var h,m=[],c={},f={},C=o();h=C.getChildren();for(var b=0;b<C.getChildCount();b++){var E=h.getItem(b);c[b]=E;for(var v=[],p=0;p<E.getChildCount();p++){var O=E.getChild(p);if(O)if(O.getAttribute("colspan")>1)for(var T=0;T<O.getAttribute("colspan");T++)O.getText&&O.getText()?v.push(O.getText()):v.push(O.getHtml());else O.getText&&O.getText()?v.push(O.getText()):v.push(O.getHtml())}f[b]=v}for(var I in f)if(f.hasOwnProperty(I)){var E=f[I];m.push({id:I,val:E[e-1]})}"txt"==i?"desc"==l?m.sort(s("val")):m.sort(a("val")):r(m)&&("desc"==l?m.sort(g("val")):m.sort(d("val")));var y=m.length>0?h.getItem(0).$.parentNode:null;if(y){for(var w=[],x=function(t,e){for(var n=e||0,o=w.length;o>n;n++)if(w[n]===t)return!0;return!1},B=function(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t)return n;return null},D=m,N=0;N<m.length;N++){var S=m[N].id;if(!(x(N)&&x(S)||N==S)){var A=h.getItem(S).$,E=c[N].$,R=A.cloneNode(!0),K=y.replaceChild(R,E);y.replaceChild(K,A),c[N].$=R,c[S].$=K,h.getItem(N).$=R,h.getItem(S).$=K;var P=B(S,D),$=B(N.toString(),D);D[P].id=N.toString(),D[$].id=S,w.push(N),w.push(S)}}var V=(t.getSelection(),new CKEDITOR.dom.element(y)),k=new CKEDITOR.dom.range(V.getParent());k.moveToElementEditablePosition(V),k.select(),n=t.getSelection().getCommonAncestor()}};return{title:t.lang.ibmtabletools.sortTable,minWidth:220,minHeight:50,onShow:function(){n=t.getSelection().getCommonAncestor(),this.getParentEditor().execCommand("selectTable"),e()?(this.getContentElement("info","mergedCells").getElement().show(),this.getButton("closeButton").getElement().show(),this.getButton("ok").getElement().hide(),this.getButton("cancel").getElement().hide(),this.getContentElement("info","column").getElement().hide(),this.getContentElement("info","type").getElement().hide(),this.getContentElement("info","order").getElement().hide()):(this.getContentElement("info","mergedCells").getElement().hide(),this.getButton("closeButton").getElement().hide(),this.getButton("ok").getElement().show(),this.getButton("cancel").getElement().show(),this.getContentElement("info","column").getElement().show(),this.getContentElement("info","type").getElement().show(),this.getContentElement("info","order").getElement().show())},onOk:function(){var t=this.getValueOf("info","column"),e=this.getValueOf("info","order"),n=this.getValueOf("info","type");l(t,e,n)},buttons:[CKEDITOR.dialog.cancelButton(t,{label:t.lang.common.close,id:"closeButton"}),CKEDITOR.dialog.okButton,CKEDITOR.dialog.cancelButton],contents:[{id:"info",style:"width: 100%",elements:[{type:"vbox",children:[{type:"hbox",children:[{label:t.lang.ibmtabletools.colNumber,type:"select",id:"column",items:[],onShow:function(){this.clear();for(var e=o(),n=0,l=0;l<e.getChildCount();l++){var i=e.getChildren().getItem(l);n<i.getChildCount()&&(n=i.getChildCount())}for(var r=0;n>r;r++)this.add(t.lang.ibmtabletools.colNumber+" "+(r+1),[r+1])},setup:function(t){t&&t[1]&&this.setValue(t[1])}},{type:"select",id:"type",label:t.lang.ibmtabletools.sortType,"default":"txt",items:[[t.lang.ibmtabletools.textType,"txt"],[t.lang.ibmtabletools.numericType,"num"]],setup:function(t){t&&t[2]&&this.setValue(t[2])}},{type:"select",id:"order",label:t.lang.ibmtabletools.sortOrder,"default":"asc",items:[[t.lang.ibmtabletools.sortOrderAsc,"asc"],[t.lang.ibmtabletools.sortOrderDesc,"desc"]],setup:function(t){t&&t[3]&&this.setValue(t[3])}}]},{type:"html",id:"mergedCells",style:"text-align: center;",html:"<div>"+CKEDITOR.tools.htmlEncode(t.lang.ibmtabletools.mergedCells)+"</div>",focus:!1,onShow:function(){if(e()){var t=this.getDialog().parts.dialog.getParent();this.getElement().show(),t.setAttribute("aria-describedby",this.domId)}},onHide:function(){var e=this.getDialog().parts.dialog.getParent();this.getElement().hide(),e.hasAttribute("aria-describedby")&&e.removeAttribute("aria-describedby");var o=t.createRange();o.setStartAt(n,CKEDITOR.POSITION_BEFORE_END),o.setEndAt(n,CKEDITOR.POSITION_BEFORE_END),o.select()}}]}]}]}});