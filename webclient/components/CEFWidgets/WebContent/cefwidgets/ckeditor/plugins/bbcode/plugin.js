/**
 * @license Copyright (c) 2003-2016, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
!function(){function e(e){var t="";for(var n in e){var r=e[n],i=(n+":"+r).replace(o,";");t+=i}return t}CKEDITOR.on("dialogDefinition",function(e){var t,n=e.data.name,r=e.data.definition;"link"==n?(r.removeContents("target"),r.removeContents("upload"),r.removeContents("advanced"),t=r.getContents("info"),t.remove("emailSubject"),t.remove("emailBody")):"image"==n&&(r.removeContents("advanced"),t=r.getContents("Link"),t.remove("cmbTarget"),t=r.getContents("info"),t.remove("txtAlt"),t.remove("basic"))});var t={b:"strong",u:"u",i:"em",color:"span",size:"span",quote:"blockquote",code:"code",url:"a",email:"span",img:"span","*":"li",list:"ol"},n={strong:"b",b:"b",u:"u",em:"i",i:"i",code:"code",li:"*"},r={strong:"b",em:"i",u:"u",li:"*",ul:"list",ol:"list",code:"code",a:"link",img:"img",blockquote:"quote"},i={color:"color",size:"font-size"},a={url:"href",email:"mailhref",quote:"cite",list:"listType"},s=CKEDITOR.dtd,l=CKEDITOR.tools.extend({table:1},s.$block,s.$listItem,s.$tableContent,s.$list),o=/\s*(?:;\s*|$)/,u={smiley:":)",sad:":(",wink:";)",laugh:":D",cheeky:":P",blush:":*)",surprise:":-o",indecision:":|",angry:">:(",angel:"o:)",cool:"8-)",devil:">:-)",crying:";(",kiss:":-*"},c={},f=[];for(var h in u)c[u[h]]=h,f.push(u[h].replace(/\(|\)|\:|\/|\*|\-|\|/g,function(e){return"\\"+e}));f=new RegExp(f.join("|"),"g");var d=function(){var e=[],t={nbsp:" ",shy:"­"};for(var n in t)e.push(n);return e=new RegExp("&("+e.join("|")+");","g"),function(n){return n.replace(e,function(e,n){return t[n]})}}();CKEDITOR.BBCodeParser=function(){this._={bbcPartsRegex:/(?:\[([^\/\]=]*?)(?:=([^\]]*?))?\])|(?:\[\/([a-z]{1,16})\])/gi}},CKEDITOR.BBCodeParser.prototype={parse:function(n){for(var r,s,l=0;r=this._.bbcPartsRegex.exec(n);){var o=r.index;if(o>l){var u=n.substring(l,o);this.onText(u,1)}if(l=this._.bbcPartsRegex.lastIndex,s=(r[1]||r[3]||"").toLowerCase(),!s||t[s])if(r[1]){var c=t[s],f={},h={},d=r[2];d&&("list"==s&&(isNaN(d)?/^[a-z]+$/.test(d)?d="lower-alpha":/^[A-Z]+$/.test(d)&&(d="upper-alpha"):d="decimal"),i[s]?("size"==s&&(d+="%"),h[i[s]]=d,f.style=e(h)):a[s]&&(f[a[s]]=CKEDITOR.tools.htmlDecode(d))),("email"==s||"img"==s)&&(f.bbcode=s),this.onTagOpen(c,f,CKEDITOR.dtd.$empty[c])}else r[3]&&this.onTagClose(t[s]);else this.onText(r[0])}n.length>l&&this.onText(n.substring(l,n.length),1)}},CKEDITOR.htmlParser.fragment.fromBBCode=function(e){function t(e){if(u.length>0)for(var t=0;t<u.length;t++){var n=u[t],r=n.name,i=CKEDITOR.dtd[r],a=d.name&&CKEDITOR.dtd[d.name];a&&!a[r]||e&&i&&!i[e]&&CKEDITOR.dtd[e]||(n=n.clone(),n.parent=d,d=n,u.splice(t,1),t--)}}function n(e,t){var n=d.children.length,i=n>0&&d.children[n-1],a=!i&&p.getRule(r[d.name],"breakAfterOpen"),s=i&&i.type==CKEDITOR.NODE_ELEMENT&&p.getRule(r[i.name],"breakAfterClose"),o=e&&p.getRule(r[e],t?"breakBeforeClose":"breakBeforeOpen");h&&(a||s||o)&&h--,h&&e in l&&h++;for(;h&&h--;)d.children.push(i=new CKEDITOR.htmlParser.element("br"))}function i(e,t){n(e.name,1),t=t||d||o;var r=t.children.length,i=r>0&&t.children[r-1]||null;e.previous=i,e.parent=t,t.children.push(e),e.returnPoint&&(d=e.returnPoint,delete e.returnPoint)}var a,s=new CKEDITOR.BBCodeParser,o=new CKEDITOR.htmlParser.fragment,u=[],h=0,d=o;s.onTagOpen=function(e,r){var l=new CKEDITOR.htmlParser.element(e,r);if(CKEDITOR.dtd.$removeEmpty[e])return void u.push(l);var o=d.name,c=o&&(CKEDITOR.dtd[o]||(d._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span));if(c&&!c[e]){var f,h=!1;if(e==o?i(d,d.parent):e in CKEDITOR.dtd.$listItem?(s.onTagOpen("ul",{}),f=d,h=!0):(i(d,d.parent),u.unshift(d),h=!0),d=f?f:d.returnPoint||d.parent,h)return void s.onTagOpen.apply(this,arguments)}t(e),n(e),l.parent=d,l.returnPoint=a,a=0,l.isEmpty?i(l):d=l},s.onTagClose=function(e){for(var t=u.length-1;t>=0;t--)if(e==u[t].name)return void u.splice(t,1);for(var n=[],r=[],a=d;a.type&&a.name!=e;)a._.isBlockLike||r.unshift(a),n.push(a),a=a.parent;if(a.type){for(t=0;t<n.length;t++){var s=n[t];i(s,s.parent)}d=a,i(a,a.parent),a==d&&(d=d.parent),u=u.concat(r)}},s.onText=function(e){var r=CKEDITOR.dtd[d.name];(!r||r["#"])&&(n(),t(),e.replace(/(\r\n|[\r\n])|[^\r\n]*/g,function(e,t){if(void 0!==t&&t.length)h++;else if(e.length){var n=0;e.replace(f,function(t,r){i(new CKEDITOR.htmlParser.text(e.substring(n,r)),d),i(new CKEDITOR.htmlParser.element("smiley",{desc:c[t]}),d),n=r+t.length}),n!=e.length&&i(new CKEDITOR.htmlParser.text(e.substring(n,e.length)),d)}}))},s.parse(CKEDITOR.tools.htmlEncode(e));for(;d.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT;){var m=d.parent,g=d;i(g,m),d=m}return o};var m=CKEDITOR.tools.createClass({$:function(){this._={output:[],rules:[]},this.setRules("list",{breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1}),this.setRules("*",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:1,breakAfterClose:0}),this.setRules("quote",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:0,breakAfterClose:1})},proto:{setRules:function(e,t){var n=this._.rules[e];n?CKEDITOR.tools.extend(n,t,!0):this._.rules[e]=t},getRule:function(e,t){return this._.rules[e]&&this._.rules[e][t]},openTag:function(e){e in t&&(this.getRule(e,"breakBeforeOpen")&&this.lineBreak(1),this.write("[",e))},openTagClose:function(e){"br"==e?this._.output.push("\n"):e in t&&(this.write("]"),this.getRule(e,"breakAfterOpen")&&this.lineBreak(1))},attribute:function(e,t){"option"==e&&this.write("=",t)},closeTag:function(e){e in t&&(this.getRule(e,"breakBeforeClose")&&this.lineBreak(1),"*"!=e&&this.write("[/",e,"]"),this.getRule(e,"breakAfterClose")&&this.lineBreak(1))},text:function(e){this.write(e)},comment:function(){},lineBreak:function(){!this._.hasLineBreak&&this._.output.length&&(this.write("\n"),this._.hasLineBreak=1)},write:function(){this._.hasLineBreak=0;var e=Array.prototype.join.call(arguments,"");this._.output.push(e)},reset:function(){this._.output=[],this._.hasLineBreak=0},getHtml:function(e){var t=this._.output.join("");return e&&this.reset(),d(t)}}}),p=new m;CKEDITOR.plugins.add("bbcode",{requires:"entities",beforeInit:function(e){var t=e.config;CKEDITOR.tools.extend(t,{enterMode:CKEDITOR.ENTER_BR,basicEntities:!1,entities:!1,fillEmptyBlocks:!1},!0),e.filter.disable(),e.activeEnterMode=e.enterMode=CKEDITOR.ENTER_BR},init:function(e){function t(e){var t=CKEDITOR.htmlParser.fragment.fromBBCode(e),n=new CKEDITOR.htmlParser.basicWriter;return t.writeHtml(n,a),n.getHtml(!0)}function r(e){var n=e.data.dataValue;e.data.dataValue=t(n)}var i=e.config,a=new CKEDITOR.htmlParser.filter;a.addRules({elements:{blockquote:function(e){var t=new CKEDITOR.htmlParser.element("div");t.children=e.children,e.children=[t];var n=e.attributes.cite;if(n){var r=new CKEDITOR.htmlParser.element("cite");r.add(new CKEDITOR.htmlParser.text(n.replace(/^"|"$/g,""))),delete e.attributes.cite,e.children.unshift(r)}},span:function(e){var t;(t=e.attributes.bbcode)&&("img"==t?(e.name="img",e.attributes.src=e.children[0].value,e.children=[]):"email"==t&&(e.name="a",e.attributes.href="mailto:"+e.children[0].value),delete e.attributes.bbcode)},ol:function(e){e.attributes.listType?"decimal"!=e.attributes.listType&&(e.attributes.style="list-style-type:"+e.attributes.listType):e.name="ul",delete e.attributes.listType},a:function(e){e.attributes.href||(e.attributes.href=e.children[0].value)},smiley:function(e){e.name="img";var t=e.attributes.desc,n=i.smiley_images[CKEDITOR.tools.indexOf(i.smiley_descriptions,t)],r=CKEDITOR.tools.htmlEncode(i.smiley_path+n);e.attributes={src:r,"data-cke-saved-src":r,title:t,alt:t}}}}),e.dataProcessor.htmlFilter.addRules({elements:{$:function(t){var r,i=t.attributes,a=CKEDITOR.tools.parseCssText(i.style,1),s=t.name;if(s in n)s=n[s];else if("span"==s){if(r=a.color)s="color",r=CKEDITOR.tools.convertRgbToHex(r);else if(r=a["font-size"]){var l=r.match(/(\d+)%$/);l&&(r=l[1],s="size")}}else if("ol"==s||"ul"==s){if(r=a["list-style-type"])switch(r){case"lower-alpha":r="a";break;case"upper-alpha":r="A"}else"ol"==s&&(r=1);s="list"}else if("blockquote"==s){try{var o=t.children[0],c=t.children[1],f="cite"==o.name&&o.children[0].value;f&&(r='"'+f+'"',t.children=c.children)}catch(h){}s="quote"}else if("a"==s){if(r=i.href)if(-1!==r.indexOf("mailto:"))s="email",t.children=[new CKEDITOR.htmlParser.text(r.replace("mailto:",""))],r="";else{var d=1==t.children.length&&t.children[0];d&&d.type==CKEDITOR.NODE_TEXT&&d.value==r&&(r=""),s="url"}}else if("img"==s){t.isEmpty=0;var m=i["data-cke-saved-src"]||i.src,p=i.alt;if(m&&-1!=m.indexOf(e.config.smiley_path)&&p)return new CKEDITOR.htmlParser.text(u[p]);t.children=[new CKEDITOR.htmlParser.text(m)]}return t.name=s,r&&(t.attributes.option=r),null},br:function(e){var t=e.next;return t&&t.name in l?!1:void 0}}},1),e.dataProcessor.writer=p,e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?e.once("contentDom",function(){e.on("setData",r)}):e.on("setData",r)},afterInit:function(e){var t;e._.elementsPath&&(t=e._.elementsPath.filters)&&t.push(function(t){var n=t.getName(),i=r[n]||!1;if("link"==i&&0===t.getAttribute("href").indexOf("mailto:"))i="email";else if("span"==n)t.getStyle("font-size")?i="size":t.getStyle("color")&&(i="color");else if("img"==i){var a=t.data("cke-saved-src")||t.getAttribute("src");a&&0===a.indexOf(e.config.smiley_path)&&(i="smiley")}return i})}})}();