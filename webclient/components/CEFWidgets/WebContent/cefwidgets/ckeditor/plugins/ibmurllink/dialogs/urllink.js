/* Copyright IBM Corp. 2009-2016  All Rights Reserved. *//* Copyright IBM Corp. 2010-2014 All Rights Reserved.                    */
var linkDialog=function(e,t){var n,i=e.plugins.ibmurllink,l=CKEDITOR.plugins.link,a=!1,r=function(n){var i,r={},o=n&&(n.data("cke-saved-href")||n.getAttribute("href"))||"",s=/^#(.*)$/;return a=!1,(i=o.match(s)&&e.filter.check("a[name]"))?(a=!0,r.anchor={},r.anchor.name=r.anchor.id=i[1],n&&(r.text=n.getText())):(r.href=o,n&&(r.target=n.getAttribute("target")||"",r.text=n.getText())),"bookmark"==t||a?this.parts.title.setText(e.lang.ibmurllink.documentbookmarktitle):this.parts.title.setText(e.lang.ibmurllink.title),r.anchors=l.getEditorAnchors(e),this._.selectedElement=n,r};return{title:e.lang.ibmurllink.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:300,minHeight:200,onShow:function(){var t=e.getSelection(),l="";if(t.getType()==CKEDITOR.SELECTION_ELEMENT){var a=t.getSelectedElement();a.is("a")&&(l=a)}if(""==l){var o=t.getRanges();if(1!==o.length)return;o[0].shrink(CKEDITOR.SHRINK_TEXT);var s=o[0].getCommonAncestor(!0),l=s.getAscendant("a",!0)}this.setupContent(r.apply(this,[l]));var h=this.getContentElement("info","txtDisplay");h.enable(),l?(t.selectElement(l),n=i.findInnerElement(l),(i.hasChildElementNodes(n)||n instanceof CKEDITOR.dom.element&&"img"==n.getName())&&h.disable()):o[0].collapsed||(i.containsElementNodes(o)&&h.disable(),CKEDITOR.env.ie?(t.unlock(!0),h.setValue(t.getSelectedText()),t.lock()):h.setValue(t.getSelectedText()))},onOk:function(){var l={};this.commitContent(l);var r={};if("bookmark"==t||a){if(""==l.anchor.name)return;r.href="#"+(l.anchor.name||""),r.text=l.text}else"urllink"==t&&(r.href=l.url,r.target=l.target,r.text=l.text);if(this._.selectedElement){var o=this._.selectedElement;if(r.text){var s=r.text;delete r.text}("urllink"==t&&""==r.target||"bookmark"==t)&&(o.hasAttribute("target")&&"_blank"===o.getAttribute("target")&&o.removeAttribute("target"),delete r.target),r.href&&(r["data-cke-saved-href"]=r.href),o.setAttributes(r),CKEDITOR.env.ie&&n.type===CKEDITOR.NODE_TEXT&&(n=i.findInnerElement(o)),s&&n&&n.setText(s.replace(/ /g," ")),delete this._.selectedElement}else r.src="urllink",e.execCommand("insertLink",r)},contents:[{id:"info",style:"width: 100%",elements:[{type:"select",id:"anchorName","default":"",required:!0,label:e.lang.ibmurllink.linkTo,style:"width: 100%;",items:[[""]],setup:function(e){if(("bookmark"==t||a)&&e.anchors.length>0?this.getElement().show():this.getElement().hide(),e.anchors.length>0){this.clear();for(var n=0;n<e.anchors.length;n++)e.anchors[n].name&&this.add(e.anchors[n].name);e.anchor&&this.setValue(e.anchor.name)}},commit:function(e){e.anchor||(e.anchor={}),e.anchor.name=this.getValue()}},{type:"html",id:"noAnchors",style:"text-align: center; white-space: normal;",html:"<div>"+CKEDITOR.tools.htmlEncode(e.lang.link.noAnchors)+"</div>",focus:!1,setup:function(e){var n=this.getDialog().parts.dialog.getParent();("bookmark"==t||a)&&e.anchors.length<1?(this.getElement().show(),this.getDialog().getContentElement("info","requiredLabel").getElement().hide(),n.setAttribute("aria-describedby",this.domId)):(this.getElement().hide(),this.getDialog().getContentElement("info","requiredLabel").getElement().show(),n.hasAttribute("aria-describedby")&&n.removeAttribute("aria-describedby"))}},{id:"txtUrl",type:"text",required:!0,"default":"",label:e.lang.common.url,setup:function(e){"urllink"!=t||a?this.getElement().hide():this.getElement().show(),e.href&&this.setValue(e.href)},commit:function(t){var n=CKEDITOR.tools.trim(this.getValue());/^([a-zA-Z]+:\/\/|\.|\/|mailto:)/.test(n)||(n=(e.config.useHTTPs?"https://":"http://")+n),t.url=n},validate:function(){this.getDialog();if("bookmark"==t||a)return!0;var n=CKEDITOR.dialog.validate.notEmpty(e.lang.ibmurllink.nourl);return n.apply(this)}},{id:"txtDisplay",type:"text","default":"",style:"padding: 5px 0px;",label:e.lang.ibmurllink.linkText,inputStyle:CKEDITOR.env.ie&&CKEDITOR.env.version<9?"width:350px":"",setup:function(e){("bookmark"==t||a)&&e.anchors.length<1?this.getElement().hide():(this.getElement().show(),e.text&&this.setValue(e.text))},commit:function(e){if(this.isEnabled()){var n=this.getValue();"urllink"==t?e.text=""!==n?n:e.url:e.text=""!==n?n:e.anchor.name}}},{type:"checkbox",id:"chkNewWindow",requiredContent:"a[target]",label:e.lang.ibmurllink.openinnew,"default":!1,setup:function(e){("urllink"!=t||a)&&this.getElement().hide(),e.target&&this.setValue(e.target&&"_blank"===e.target)},commit:function(e){this.getValue()?e.target="_blank":e.target=""}}]}]}};CKEDITOR.dialog.add("urllink",function(e){return linkDialog(e,"urllink")}),CKEDITOR.dialog.add("bookmark",function(e){return linkDialog(e,"bookmark")});