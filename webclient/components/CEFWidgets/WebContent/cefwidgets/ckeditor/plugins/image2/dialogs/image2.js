/**
 * @license Copyright (c) 2003-2016, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
"use strict";CKEDITOR.dialog.add("image2",function(t){function e(){var t=this.getValue().match(D),e=!(!t||0===parseInt(t[1],10));return e||alert(R["invalid"+CKEDITOR.tools.capitalize(this.id)]),e}function i(){function t(t,n){a.push(i.once(t,function(t){e(),n(t)}))}function e(){for(var t;t=a.pop();)t.removeListener()}var i=u.createElement("img"),a=[];return function(e,a,n){t("load",function(){var t=N(i);a.call(n,i,t.width,t.height)}),t("error",function(){a(null)}),t("abort",function(){a(null)}),i.setAttribute("src",(B.baseHref||"")+e+"?"+Math.random().toString(16).substring(2))}}function a(){var e=this.getValue();s(!1),e!==d.data.src?(c(e,function(e,i,a){return s(!0),e?(w.setValue(t.config.image2_prefillDimensions===!1?0:i),y.setValue(t.config.image2_prefillDimensions===!1?0:a),f=i,g=a,void l(T.checkHasNaturalRatio(e))):l(!1)}),m=!0):m?(s(!0),w.setValue(h),y.setValue(p),m=!1):s(!0)}function n(){if(b){var t=this.getValue();if(t&&(t.match(D)||l(!1),"0"!==t)){var e="width"==this.id,i=h||f,a=p||g;t=e?Math.round(a*(t/i)):Math.round(i*(t/a)),isNaN(t)||(e?y:w).setValue(t)}}}function o(){function t(t){t.on("mouseover",function(){this.addClass("cke_btn_over")},t),t.on("mouseout",function(){this.removeClass("cke_btn_over")},t)}var e=this.getDialog();C=u.getById(x),V=u.getById(I),C&&(e.addFocusable(C,4+U),C.on("click",function(t){l(),t.data&&t.data.preventDefault()},this.getDialog()),t(C)),V&&(e.addFocusable(V,5+U),V.on("click",function(t){m?(w.setValue(f),y.setValue(g)):(w.setValue(h),y.setValue(p)),t.data&&t.data.preventDefault()},this),t(V))}function l(t){if(C){if("boolean"==typeof t){if(v)return;b=t}else{var e,i=w.getValue();v=!0,b=!b,b&&i&&(e=p/h*i,isNaN(e)||y.setValue(Math.round(e)))}if(C[b?"removeClass":"addClass"]("cke_btn_unlocked"),C.setAttribute("aria-checked",b),CKEDITOR.env.hc){var a=C.getChild(0);a.setHtml(b?CKEDITOR.env.ie?"■":"▣":CKEDITOR.env.ie?"□":"▢")}}}function s(t){var e=t?"enable":"disable";w[e](),y[e]()}var u,d,r,c,h,p,f,g,m,b,v,C,V,w,y,k,D=/(^\s*(\d+)(px)?\s*$)|^$/i,x=CKEDITOR.tools.getNextId(),I=CKEDITOR.tools.getNextId(),_=t.lang.image2,R=t.lang.common,K="margin-top:18px;width:40px;height:20px;",E=new CKEDITOR.template('<div><a href="javascript:void(0)" tabindex="-1" title="'+_.lockRatio+'" class="cke_btn_locked" id="{lockButtonId}" role="checkbox"><span class="cke_icon"></span><span class="cke_label">'+_.lockRatio+'</span></a><a href="javascript:void(0)" tabindex="-1" title="'+_.resetSize+'" class="cke_btn_reset" id="{resetButtonId}" role="button"><span class="cke_label">'+_.resetSize+"</span></a></div>").output({lockButtonId:x,resetButtonId:I}),T=CKEDITOR.plugins.image2,B=t.config,O=t.widgets.registered.image.features,N=T.getNatural,U=!(!B.filebrowserImageBrowseUrl&&!B.filebrowserBrowseUrl),q=[{id:"src",type:"text",label:R.url,onKeyup:a,onChange:a,setup:function(t){this.setValue(t.data.src)},commit:function(t){t.setData("src",this.getValue())},validate:CKEDITOR.dialog.validate.notEmpty(_.urlMissing)}];return U&&q.push({type:"button",id:"browse",style:"display:inline-block;margin-top:14px;",align:"center",label:t.lang.common.browseServer,hidden:!0,filebrowser:"info:src"}),{title:_.title,minWidth:250,minHeight:100,onLoad:function(){u=this._.element.getDocument(),c=i()},onShow:function(){d=this.widget,r=d.parts.image,m=v=b=!1,k=N(r),f=h=k.width,g=p=k.height},contents:[{id:"info",label:_.infoTab,elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["100%"],children:q}]},{id:"alt",type:"text",label:_.alt,setup:function(t){this.setValue(t.data.alt)},commit:function(t){t.setData("alt",this.getValue())}},{type:"hbox",widths:["25%","25%","50%"],requiredContent:O.dimension.requiredContent,children:[{type:"text",width:"45px",id:"width",label:R.width,validate:e,onKeyUp:n,onLoad:function(){w=this},setup:function(t){this.setValue(t.data.width)},commit:function(t){t.setData("width",this.getValue())}},{type:"text",id:"height",width:"45px",label:R.height,validate:e,onKeyUp:n,onLoad:function(){y=this},setup:function(t){this.setValue(t.data.height)},commit:function(t){t.setData("height",this.getValue())}},{id:"lock",type:"html",style:K,onLoad:o,setup:function(t){l(t.data.lock)},commit:function(t){t.setData("lock",b)},html:E}]},{type:"hbox",id:"alignment",requiredContent:O.align.requiredContent,children:[{id:"align",type:"radio",items:[[R.alignNone,"none"],[R.alignLeft,"left"],[R.alignCenter,"center"],[R.alignRight,"right"]],label:R.align,setup:function(t){this.setValue(t.data.align)},commit:function(t){t.setData("align",this.getValue())}}]},{id:"hasCaption",type:"checkbox",label:_.captioned,requiredContent:O.caption.requiredContent,setup:function(t){this.setValue(t.data.hasCaption)},commit:function(t){t.setData("hasCaption",this.getValue())}}]},{id:"Upload",hidden:!0,filebrowser:"uploadButton",label:_.uploadTab,elements:[{type:"file",id:"upload",label:_.btnUpload,style:"height:40px"},{type:"fileButton",id:"uploadButton",filebrowser:"info:src",label:_.btnUpload,"for":["Upload","upload"]}]}]}});