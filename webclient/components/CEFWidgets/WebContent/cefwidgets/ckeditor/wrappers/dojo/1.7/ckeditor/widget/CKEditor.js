/* Copyright IBM Corp. 2009-2016  All Rights Reserved. *//* Copyright IBM Corp. 2010-2014 All Rights Reserved.                    */
define(["dijit/_WidgetBase","dojo/_base/declare","dojo/_base/window","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/sniff","dojo/_base/connect","dojo/io/script"],function(t,e,i,o,n,d,r,s){var c=e("ckeditor.widget.CKEditor",[t],{_beingInitialized:!1,value:"",ckeditorConfig:null,constructor:function(){this.onLoadDeferred=new o,this.ckeditorConfig={}},onLoadDeferred:null,postCreate:function(){if(this.inherited(arguments),window.CKEditor)this._createEditorElement();else{for(var t,e=document.getElementsByTagName("script"),o=0;o<e.length;o++){var n=e[o].src.match(/(^|.*[\\\/])ckeditor(?:_basic)?(?:_source)?.js(?:\?.*)?$/);if(n){t=e[o];break}}if(!t){var c=window.CKEDITOR_BASEPATH||i.global.CKEDITOR_BASEPATH||"/ckeditor/";c+="ckeditor.js",t=s.attach("ckeditor",c,i.doc)}var a=d("ie")?"onreadystatechange":"load",h=/complete|loaded/,u=this,l=r.connect(t,a,function(e){("load"==e.type||h.test(t.readyState))&&(r.disconnect(l),u.set("loading",!1),u._createEditorElement())});(i.doc.parentWindow||i.doc.defaultView).CKEDITOR?this._createEditorElement():this.set("loading",!0)}},destroy:function(){this._ckeditor&&(this._ckeditor.destroy(!0),delete this._ckeditor),this.inherited(arguments)},addStyleSheet:function(t){if(window.CKEDITOR&&CKEDITOR.document){var e=t.toString();("."===e.charAt(0)||"/"!==e.charAt(0)&&!t.host)&&(e=new _Url(win.global.location,e).toString()),CKEDITOR.document.appendStyleSheet(e)}},focus:function(){this._ckeditor&&(this._beingInitialized?this._ckeditor.config.startupFocus=!0:this._ckeditor.focus())},onChange:function(){},_timeout:function(){this._createEditorElement()},_createEditorElement:function(){if(!this._beingInitialized&&!this._beingDestroyed)if(this.nRetry||(this.nRetry=0),(i.doc.parentWindow||i.doc.defaultView).CKEDITOR&&(CKEDITOR=(i.doc.parentWindow||i.doc.defaultView).CKEDITOR),CKEDITOR.document&&window.CKEDITOR&&(CKEDITOR.document=new CKEDITOR.dom.document(i.doc)),"unloaded"==CKEDITOR.status||"basic_loaded"==CKEDITOR.status||CKEDITOR.document&&!CKEDITOR.document.getById(this.id)){if(this.nRetry<600)return this.nRetry++,void setTimeout(n.hitch(this,"_timeout"),100)}else{if(this._destroyed)return;this._ckeditor=CKEDITOR.replace(this.domNode,this.get("ckeditorConfig")),this._beingInitialized=!0,this.set("loading",!0),this._ckeditor.on("instanceReady",n.hitch(this,this._onLoad)),this._ckeditor.on("blur",n.hitch(this,this._onBlur)),this.onLoadDeferred.callback(!0)}},_getCkeditorConfigAttr:function(){return this.ckeditorConfig},_onLoad:function(t){if(this._ckeditor){this._ckeditor.config.startupFocus&&this._ckeditor.focus();var e=new CKEDITOR.dom.range(this._ckeditor.document);e.selectNodeContents(this._ckeditor.document.getBody()),e.collapse(!0);var i=this._ckeditor.getSelection();i&&i.getNative()&&i.getNative().rangeCount&&i.selectRanges([e])}},_onBlur:function(t){this._set("value",this.get("value"))},_setValueAttr:function(t){this._set("value",t),this._ckeditor&&this._ckeditor.setData(t)},_getValueAttr:function(){var t="";return t=this._ckeditor?this._ckeditor.getData():this.value}});return c});