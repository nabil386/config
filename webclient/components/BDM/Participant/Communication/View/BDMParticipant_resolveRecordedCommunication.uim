<?xml version="1.0" encoding="UTF-8"?>
<!-- Description                                                            -->
<!-- ===============                                                        -->
<!-- Task - 57837 This jsp redirects the user the appropriate recorded communication from call back task action page.   -->

<PAGE
  PAGE_ID="BDMParticipant_resolveRecordedCommunication"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="file://Curam/UIMSchema.xsd"
>

  <PAGE_PARAMETER NAME="taskID"/>  
   <PAGE_PARAMETER NAME="correspondentConcernRoleID"/>
   
  <JSP_SCRIPTLET>   

      curam.omega3.request.RequestHandler 
        rh = curam.omega3.request.RequestHandlerFactory.getRequestHandler(request);


      String context = request.getContextPath() + "/";
      context += curam.omega3.user.UserPreferencesFactory.getUserPreferences(pageContext.getSession()).getLocale() + "/";
       String taskID = request.getParameter("taskID");
      String correspondentConcernRoleID = request.getParameter("correspondentConcernRoleID");
      String url = "";
      String pageDescription = "";
  
      curam.interfaces.BDMTaskManagementPkg.BDMTaskManagement_getBizObjIDByBizObjectTypeAndTaskID_TH
      th = new curam.interfaces.BDMTaskManagementPkg.BDMTaskManagement_getBizObjIDByBizObjectTypeAndTaskID_TH();
      
      th.setFieldValue(th.key$taskID_idx,taskID);
      th.setFieldValue(key$bizObjectType_idx,"BDMBOT8001");
      th.callServer();  	
  	
  		String communicationID = th.getFieldValue(th.result$bizObjectID_idx);
  		
            url = context + "Participant_viewRecordedCommunication1Page.do" + "?communicationID=" 
                      + curam.omega3.request.RequestUtils.escapeURL(communicationID) + "&amp;correspondentConcernRoleID="                                            
                      + curam.omega3.request.RequestUtils.escapeURL(correspondentConcernRoleID)
                      + "&amp;pageDescription=" + curam.omega3.request.RequestUtils.escapeURL(pageDescription);       
     
   
      url += "&amp;" + rh.getSystemParameters();  
      response.sendRedirect(response.encodeRedirectURL(url));
    
  </JSP_SCRIPTLET>
   
</PAGE>
