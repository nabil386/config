<?xml version="1.0" encoding="UTF-8"?>
<!-- Description                                                            -->
<!-- ===========                                                            -->
<!-- This page allows the user to select the proforma document to print.    -->
<PAGE
  PAGE_ID="BDMParticipant_redirectAfterSubmit"
  POPUP_PAGE="true"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="file://Curam/UIMSchema.xsd"
>

   
  <JSP_SCRIPTLET>
        
  	  Boolean isUrlOpenWindow = true;
  	       
  	        
  	  curam.omega3.request.RequestHandler rh = curam.omega3.request.RequestHandlerFactory.getRequestHandler(request);
      String context = request.getContextPath() + "/";
      context += curam.omega3.user.UserPreferencesFactory.getUserPreferences(pageContext.getSession()).getLocale() + "/";
      String concernRoleID = request.getParameter("concernRoleID");
      String urlNew = "";
      String cctUrl = request.getParameter("cctUrl");
      
      if(cctUrl == null){
          core.ScriptletMissingParamException e = new core.ScriptletMissingParamException(-20002, "cctUrl");
          System.out.println(e);
          throw e;
       }
      
      if(concernRoleID == null){
          core.ScriptletMissingParamException e = new core.ScriptletMissingParamException(-20002, "concernRoleID");
          System.out.println(e);
          throw e;
       } else {
          urlNew = context + "Person_listCommunicationPage.do?concernRoleID=" + curam.omega3.request.RequestUtils.escapeURL(concernRoleID);
       }
        urlNew += "&amp;" + rh.getSystemParameters();
		   	
		   	
		   	<![CDATA[
		   	
		   	if(isUrlOpenWindow){
		  
  	    	String blank = "_blank";
  	    	String configs = "toolbar=yes,scrollbars=yes,resizable=yes,top=300,left=300,width=800,height=800";
		   	
		   		out.println("<html>"); 
				out.println("<head>");
				out.println("<title>" + cctUrl +"</title>");
				out.println("<script type='text/javascript'>");
				out.println("function load(){let win;win=window.open(\""+ cctUrl + "\" ,\""+ blank + "\",\""+ configs + "\");const timer=setInterval(()=>{if(win.closed){clearInterval(timer);window.location.replace(\""+ urlNew + "\");}},100);}");
				out.println("</script>");
		    	out.println("</head>");
				out.println("<body onload=\"load()\">");
				out.println("</body>");
				out.println("</html>");
				} else {
				response.sendRedirect(response.encodeRedirectURL(urlNew));
			}
			
			]]>
      
  </JSP_SCRIPTLET>	
  
  


</PAGE>
