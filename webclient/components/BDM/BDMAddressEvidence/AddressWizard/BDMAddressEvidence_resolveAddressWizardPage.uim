<?xml version="1.0" encoding="UTF-8"?>
<!-- Resolver to navigate on create address evidence wizard  -->
<PAGE
  PAGE_ID="BDMAddressEvidence_resolveAddressWizardPage"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="file://Curam/UIMSchema.xsd"
>

  <JSP_SCRIPTLET>

      curam.omega3.request.RequestHandler
        rh = curam.omega3.request.RequestHandlerFactory.getRequestHandler(request);


      String context = request.getContextPath() + "/";
      context += curam.omega3.user.UserPreferencesFactory.getUserPreferences(pageContext.getSession()).getLocale() + "/";
      String wizardStateID = request.getParameter("wizardStateID");
      String sourcePageAction = request.getParameter("sourcePageAction");
       String pageName="";
      String url = "";
      String actionID = "SAVE";
      
      if (wizardStateID == null) {
       core.ScriptletMissingParamException e = new
                core.ScriptletMissingParamException(-20002, "wizardStateID");
       throw e;
      }
      
      if (sourcePageAction == null) {
       core.ScriptletMissingParamException e = new
                core.ScriptletMissingParamException(-20002, "sourcePageAction");
       throw e;
      }
      
         
		curam.interfaces.BDMAddressEvidenceWizardPkg.BDMAddressEvidenceWizard_getAddressEvidenceWizardDetails_TH
		getTh = new curam.interfaces.BDMAddressEvidenceWizardPkg.BDMAddressEvidenceWizard_getAddressEvidenceWizardDetails_TH();
		getTh.setFieldValue(getTh.wizardStateID$wizardStateID_idx,wizardStateID);
		getTh.callServer();
		String isValidAddress = getTh.getFieldValue(getTh.result$dtls$isValidAddress_idx);
		 String message [] = getTh.getListField(getTh.result$dtls$dtls2$dtls$message_idx);
		
		
      if(isValidAddress.equals("true")){
      
      	response.sendRedirect(response.encodeURL(request.getContextPath() + "/ieg/CloseAndRedirect.jspx"));
      	
      }else{
      	if (sourcePageAction.equals("CreateAddressEvidence")){
        	pageName="BDMAddressEvidence_createAddressWizardStep4";
        }if (sourcePageAction.equals("EditAddressEvidence")){
        	pageName="BDMAddressEvidence_editAddressWizardStep4";
        }
        url = context + curam.omega3.request.RequestUtils.escapeURL(pageName) + "Page.do?wizardStateID=" + curam.omega3.request.RequestUtils.escapeURL(wizardStateID);
		url += "&amp;" + "message="+curam.omega3.request.RequestUtils.escapeURL(message[0]);

      url += "&amp;" + rh.getSystemParameters();
      response.sendRedirect(response.encodeRedirectURL(url));
      }
     

      

  </JSP_SCRIPTLET>
</PAGE>
