<?xml version="1.0" encoding="UTF-8"?>
<!-- Resolver to navigate on create address evidence wizard  -->
<PAGE
  PAGE_ID="BDMAddressSearch_resolveAddressWizardPage"
  SCRIPT_FILE="BDMSearchAddress.js"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="file://Curam/UIMSchema.xsd"
  >
  <JSP_SCRIPTLET>

      curam.omega3.request.RequestHandler
        rh = curam.omega3.request.RequestHandlerFactory.getRequestHandler(request);


      String context = request.getContextPath() + "/";
      context += curam.omega3.user.UserPreferencesFactory.getUserPreferences(pageContext.getSession()).getLocale() + "/";
      String wizardStateID = request.getParameter("wizardStateID");
      String sourcePageAction = request.getParameter("sourcePageAction");
      String searchID = request.getParameter("searchID");
      String addressDetails = request.getParameter("addressDetails");
      String countryID = request.getParameter("countryID");
      
      String clientSelectedAddressLine1 = request.getParameter("clientSelectedAddressLine1");
      String clientSelectedAddressLine2 = request.getParameter("clientSelectedAddressLine2");
      String clientSelectedPOBox = request.getParameter("clientSelectedPOBox");
      
      
   
      
       String pageName="";
      String url = "";
      String actionID = "SAVE";
      
      if (wizardStateID == null) {
       core.ScriptletMissingParamException e = new
                core.ScriptletMissingParamException(-20002, "wizardStateID");
       throw e;
      }
      
      if (sourcePageAction == null) {
       core.ScriptletMissingParamException e = new
                core.ScriptletMissingParamException(-20002, "sourcePageAction");
       throw e;
      }

      curam.interfaces.BDMAddressEvidenceWizardPkg.BDMAddressEvidenceWizard_isValidAddressEvidence_TH 
      		th = new curam.interfaces.BDMAddressEvidenceWizardPkg.BDMAddressEvidenceWizard_isValidAddressEvidence_TH();
      th.setFieldValue(th.wizardStateID$wizardStateID_idx,wizardStateID);
      th.callServer();

      String isValidAddress = th.getFieldValue(th.result$isValidAddress_idx);    
      String message [] = th.getListField(th.result$dtls$dtls$message_idx);
      
     
      if(isValidAddress.equals("true")){
      
		curam.interfaces.BDMAddressEvidenceWizardPkg.BDMAddressEvidenceWizard_getAddressEvidenceWizardDetails_TH
		getTh = new curam.interfaces.BDMAddressEvidenceWizardPkg.BDMAddressEvidenceWizard_getAddressEvidenceWizardDetails_TH();
		getTh.setFieldValue(getTh.wizardStateID$wizardStateID_idx,wizardStateID);
		getTh.callServer();
		
		String adressData = getTh.getFieldValue(getTh.result$dtls$addressData_idx);
		String countryCode = getTh.getFieldValue(getTh.result$dtls$countryCode_idx);
		//System.out.println(""+adressData);
		pageName="BDMSearchAddressPopupStep4";
        url = context + curam.omega3.request.RequestUtils.escapeURL(pageName) + "Page.do?wizardStateID=" + curam.omega3.request.RequestUtils.escapeURL(wizardStateID);
        url += "&amp;" + "searchID="+curam.omega3.request.RequestUtils.escapeURL(searchID);
		url += "&amp;" + "addressDetails="+curam.omega3.request.RequestUtils.escapeURL(adressData);
		url += "&amp;" + "countryID="+curam.omega3.request.RequestUtils.escapeURL(countryID);
		url += "&amp;" + "countryCode="+curam.omega3.request.RequestUtils.escapeURL(countryCode);
      	url += "&amp;" + rh.getSystemParameters();
      response.sendRedirect(response.encodeRedirectURL(url));
		
	
      }else{
      
      	pageName="BDMSearchAddressPopupStep3";
        url = context + curam.omega3.request.RequestUtils.escapeURL(pageName) + "Page.do?wizardStateID=" + curam.omega3.request.RequestUtils.escapeURL(wizardStateID);
		url += "&amp;" + "searchID="+curam.omega3.request.RequestUtils.escapeURL(searchID);
		url += "&amp;" + "addressDetails="+curam.omega3.request.RequestUtils.escapeURL(addressDetails);
		url += "&amp;" + "countryID="+curam.omega3.request.RequestUtils.escapeURL(countryID);
		url += "&amp;" + "message="+curam.omega3.request.RequestUtils.escapeURL(message[0]);
      	url += "&amp;" + rh.getSystemParameters();
      response.sendRedirect(response.encodeRedirectURL(url));
      }
     

      

  </JSP_SCRIPTLET>
</PAGE>
