<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM
  
  Copyright IBM Corporation 2012. All Rights Reserved.
  
  US Government Users Restricted Rights - Use, duplication or disclosure 
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!-- Copyright (c) 2005-2006, 2008 Curam Software Ltd.                      -->
<!-- All rights reserved.                                                   -->
<!-- This software is the confidential and proprietary information of Curam -->
<!-- Software, Ltd. ("Confidential Information"). You shall not disclose    -->
<!-- such Confidential Information and shall use it only in accordance with -->
<!-- the terms of the license agreement you entered into with Curam         -->
<!-- Software.                                                              -->
<!-- Description                                                            -->
<!-- ===========                                                            -->
<!-- Resolver to refresh the Incoming Evidence Comparison page       		-->
<PAGE
  PAGE_ID="AdvancedEvidenceSearch_afterActionResolve"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="file://Curam/UIMSchema.xsd"
>
  <JSP_SCRIPTLET>    
      curam.omega3.request.RequestHandler 
        rh = curam.omega3.request.RequestHandlerFactory.getRequestHandler(request);

	  // get context and locale
      String context = request.getContextPath() + "/";
      context += curam.omega3.user.UserPreferencesFactory.getUserPreferences(pageContext.getSession()).getLocale() + "/"; 
     
      	  
      String rpu = rh.getRequestItem(curam.omega3.request.ParameterTypeRegistry.PREFIX_RETURN_PAGE).getValue();
      	 
      // change screen context so that the page opens correctly in a tab	 
      int ctxIdxStart = rpu.lastIndexOf("3ctx="); // add 4 for length of string	 
      String afterCtx = rpu.substring(ctxIdxStart + 4, rpu.length());	 
      int idxCtxEnd = afterCtx.length();	 
      if(afterCtx.contains("&amp;")){	 
               idxCtxEnd = afterCtx.indexOf("&amp;");                      	 
      }	 
      afterCtx = afterCtx.substring(idxCtxEnd, afterCtx.length());	 
      rpu = rpu.substring(0, ctxIdxStart) + "3ctx=258" + afterCtx; // -&gt; leave me alone!	      	 
  	     	      	      	      	     
      String pageName = rpu;
      pageName += "&amp;o3" + "modalprev=AdvancedEvidenceSearch_afterActionResolve";
      pageName += "&amp;o3frame=modal";
      String url = context + pageName;             
          
      response.sendRedirect(response.encodeRedirectURL(url));     
  </JSP_SCRIPTLET>
</PAGE>
