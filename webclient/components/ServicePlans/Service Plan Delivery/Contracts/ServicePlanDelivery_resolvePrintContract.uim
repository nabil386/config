<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM
 
  Copyright IBM Corporation 2012. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure 
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!-- Copyright (c) 2008 Curam Software Ltd.                                 -->
<!-- All rights reserved.                                                   -->
<!-- This software is the confidential and proprietary information of Curam -->
<!-- Software, Ltd. ("Confidential Information"). You shall not disclose    -->
<!-- such Confidential Information and shall use it only in accordance with -->
<!-- the terms of the license agreement you entered into with Curam         -->
<!-- Software.                                                              -->
<!-- Description -->
<!-- This jsp redirects the user to print confirmation screen or            -->
<!-- security message informational screen depending on user access rights  -->
<!-- to service plan delivery printContract security identifier.            -->
<PAGE
  PAGE_ID="ServicePlanDelivery_resolvePrintContract"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="file://Curam/UIMSchema.xsd"
>


  <JSP_SCRIPTLET>
  
    // Get the context details
    String context = request.getContextPath() + "/";
    curam.omega3.request.RequestHandler rh =
      curam.omega3.request.RequestHandlerFactory.getRequestHandler(
        request);
    context
      += curam
        .omega3
        .user
        .UserPreferencesFactory
        .getUserPreferences(pageContext.getSession())
        .getLocale()
      + "/";
    
                
    // Retrieve the service plan contract ID
    String servicePlanContractID =
      request.getParameter("servicePlanContractID");
    if (servicePlanContractID == null) {
      // BEGIN, CR00110216, SK
       core.ScriptletMissingParamException e = new
                core.ScriptletMissingParamException(-20002, "servicePlanContractID");
       System.out.println(e);
       throw e;
       // END, CR00110216
    }
          
    // Retrieve the context description
    String description =
      request.getParameter("description");
    if (description == null) {
      // BEGIN, CR00110216, SK
       core.ScriptletMissingParamException e = new
                core.ScriptletMissingParamException(-20002, "description");
       System.out.println(e);
       throw e;
       // END, CR00110216
    }
      
    // Retrieve the case ID
    String caseID =
      request.getParameter("caseID");
    if (caseID == null) {
      // BEGIN, CR00110216, SK
       core.ScriptletMissingParamException e = new
                core.ScriptletMissingParamException(-20002, "caseID");
       System.out.println(e);
       throw e;
       // END, CR00110216
    }
      
    // Retrieve the full query string for this request
    java.util.Enumeration params = request.getParameterNames();
    StringBuffer queryBuffer = new StringBuffer(25);
    
    while (params.hasMoreElements()) { 
    
      String parameterName = (String) params.nextElement(); 
      String parameterValue = request.getParameter(parameterName);
      queryBuffer.append("&amp;").append(parameterName).append("=");
      
      if (parameterName.equals(curam.omega3.request. 
           ParameterTypeRegistry.PREFIX_RETURN_PAGE)) {
        queryBuffer.append(java.net.URLEncoder.encode(parameterValue));
      } else {         
        queryBuffer.append(parameterValue);          
      }
      
    }
      
    if (queryBuffer.length() &gt; 0) {
      queryBuffer.deleteCharAt(0);
    }
    
    String url = context;
    
    // call server bean
    curam.interfaces.ServicePlanDeliveryPkg.ServicePlanDelivery_isPrintContractAuthorised_TH
    th = new curam.interfaces.ServicePlanDeliveryPkg.ServicePlanDelivery_isPrintContractAuthorised_TH();
                       
    th.callServer();
          
    Boolean isAuthorised
      = new Boolean(th.getFieldValue(th.result$indicator_idx));
        
    // if printing is authorised
    if (isAuthorised.booleanValue()) {
          
      // redirect to print confirmation screen
      url += "ServicePlanDelivery_savePrintContractPage.do?caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID)
      + "&amp;servicePlanContractID=" + curam.omega3.request.RequestUtils.escapeURL(servicePlanContractID)
      + "&amp;description=" + curam.omega3.request.RequestUtils.escapeURL(description);
    
    } else {
        
      // redirect to informational screen
      url += "ServicePlanDelivery_savePrintContractInformationalPage.do?caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID)
      + "&amp;servicePlanContractID=" + curam.omega3.request.RequestUtils.escapeURL(servicePlanContractID)
      + "&amp;description=" + curam.omega3.request.RequestUtils.escapeURL(description);
          
    }
      
    url += "&amp;" + rh.getSystemParameters();
          
    response.sendRedirect(response.encodeRedirectURL(url));
    
  </JSP_SCRIPTLET>


</PAGE>
