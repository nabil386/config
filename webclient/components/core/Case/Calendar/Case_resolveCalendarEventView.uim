<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM
  
  Copyright IBM Corporation 2012-2014. All Rights Reserved.
  
  US Government Users Restricted Rights - Use, duplication or disclosure 
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!-- Copyright 2003-2005, 2007-2008, 2010-2011 Curam Software Ltd.          -->
<!-- All rights reserved.                                                   -->
<!-- This software is the confidential and proprietary information of Curam -->
<!-- Software, Ltd. ("Confidential Information"). You shall not disclose    -->
<!-- such Confidential Information and shall use it only in accordance with -->
<!-- the terms of the license agreement you entered into with Curam         -->
<!-- Software.                                                              -->
<!-- Description                                                            -->
<!-- ===========                                                            -->
<!-- This jsp redirects the user to the appropriate page                    -->
<!-- to view details of an event or activity from a case calendar.          -->
<PAGE
  PAGE_ID="Case_resolveCalendarEventView"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="file://Curam/UIMSchema.xsd"
>
  <JSP_SCRIPTLET>
    

      curam.omega3.request.RequestHandler 
        rh = curam.omega3.request.RequestHandlerFactory.getRequestHandler(request);

      String context = request.getContextPath() + "/";
      context += curam.omega3.user.UserPreferencesFactory.getUserPreferences(pageContext.getSession()).getLocale() + "/";
      String eventType = request.getParameter("TYPE");
      String eventID = request.getParameter("ID");
      String caseID = request.getParameter("caseID");
      String isRecurring = request.getParameter("RE");
      String isReadOnly = request.getParameter("RO");
      String url = "";
      String currentPlanInd = "";
            
      String startDate = request.getParameter("startDate");
      String calendarViewType = request.getParameter("calendarViewType");      
      
      if (startDate == null) {
        startDate = "";
      }
      
      //Read the case description and pass it to activity pages.
      if (eventID == null) {
        // BEGIN, CR00110216, SK
       core.ScriptletMissingParamException e = new
                core.ScriptletMissingParamException(-20002, "eventID");
       throw e;
       // END, CR00110216
      }

      String description = "";
      //if event has not passed the case description, set the description here
   
      
      if (caseID.equals("null")) {
        if (eventType == null) {

          curam.interfaces.ActivityPkg.Activity_readContextDescription_TH
          th = new curam.interfaces.ActivityPkg.Activity_readContextDescription_TH();

          th.setFieldValue(th.key$activityContextDescriptionKey$activityID_idx,eventID);
          th.callServer();
          description = th.getFieldValue(th.result$activityContextDescriptionDetails$description_idx);

        }
      
      }
      
      if (eventType == null) { // Event must be an user activity
      
        // BEGIN, CR00192053, ELG
        url = context + "Case_resolveCalendarEventViewForMeetingsPage.do?ID=" + curam.omega3.request.RequestUtils.escapeURL(eventID)
          + "&amp;RO=" + curam.omega3.request.RequestUtils.escapeURL(isReadOnly)
          + "&amp;RE=" + curam.omega3.request.RequestUtils.escapeURL(isRecurring)
          + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);              
        // END, CR00192053
      
      // BEGIN, CR00110216, SK
      } else if (eventType.equals("ET2")) {
        url = context + "Case_viewAppealViewOnlyPage.do?appealID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);

      } else if (eventType.equals("ET3")) {
        url = context + "Case_viewReviewViewOnlyPage.do?reviewID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);

      } else if (eventType.equals("ET4")) {
        url = context + "Case_viewReferralViewOnlyPage.do?referralID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);

      } else if (eventType.equals("ET12")) {
        url = context + "ProductDelivery_viewCloseViewOnlyPage.do?closureID=" 
                + curam.omega3.request.RequestUtils.escapeURL(eventID) + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);

      } else if (eventType.equals("ET1")) {

        // BEGIN, CR00421479, DG
        curam.interfaces.CasePkg.Case_isCERDecision_TH 
          th = new curam.interfaces.CasePkg.Case_isCERDecision_TH();
        th.setFieldValue(th.key$caseDecisionID_idx, eventID);
        th.callServer();              
        String result  = th.getFieldValue("result$result");
              
        if (result.equals("YES")) {
          // Decision is from a CER ruleset
          String determinationID = th.getFieldValue("result$determinationID");
          String decisionFromDate = th.getFieldValue("result$decisionFromDate");
          url = context + "ProductDelivery_viewCreoleDecisionDetailsViewOnlyPage.do?determinationID=" 
             + curam.omega3.request.RequestUtils.escapeURL(determinationID)
             + "&amp;displayDate=" + curam.omega3.request.RequestUtils.escapeURL(decisionFromDate);
        } else {
          // Decision is from a classic ruleset
          url = context + "ProductDelivery_viewDecisionWithStaticRulesTreeViewOnlyPage.do?decisionID=" 
             + curam.omega3.request.RequestUtils.escapeURL(eventID) ; 
        }
        // END, CR00421479

      
      // BEGIN, CR00243088, CW
      } else if (eventType.equals("ET5")) {
          
        curam.interfaces.CasePkg.Case_isCreoleProduct_TH 
          th = new curam.interfaces.CasePkg.Case_isCreoleProduct_TH();
          
        th.setFieldValue(th.key$caseID_idx, caseID);
        th.setFieldValue(th.approvalKey$caseApprovalID_idx, eventID);
        th.callServer();              
        
        String result  = th.getFieldValue("result$result");
        String determinationID = th.getFieldValue("result$determinationID");
          
        if (result.equals("YES")) {
          url = context + "ProductDelivery_listCaseApprovalEventCreoleDecisionsViewOnlyPage.do?approvalID=" 
                  + curam.omega3.request.RequestUtils.escapeURL(eventID)
                  + "&amp;determinationID=" 
                  + curam.omega3.request.RequestUtils.escapeURL(determinationID)
             + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);
        } else {
          url = context + "Case_viewApprovalTextBasedTreeViewOnlyPage.do?approvalID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);      
        }        

      } else if (eventType.equals("ET7")) {
        
        curam.interfaces.CasePkg.Case_isCreoleProduct_TH 
          th = new curam.interfaces.CasePkg.Case_isCreoleProduct_TH();
          
        th.setFieldValue(th.key$caseID_idx, caseID);
        th.setFieldValue(th.approvalKey$caseApprovalID_idx, eventID);
        th.callServer();              
        
        String result  = th.getFieldValue("result$result");
        String determinationID = th.getFieldValue("result$determinationID");
          
        if (result.equals("YES")) {
          url = context + "ProductDelivery_listSubmitForApprovalCreoleDecisionsViewOnlyPage.do?approvalID=" 
                  + curam.omega3.request.RequestUtils.escapeURL(eventID)
                  + "&amp;determinationID=" 
                  + curam.omega3.request.RequestUtils.escapeURL(determinationID)
                + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);
        } else {
          //BEGIN, CR00281170, SG
          curam.interfaces.CasePkg.Case_resolveCaseType_TH caseTypeTH = 
          new curam.interfaces.CasePkg.Case_resolveCaseType_TH();
          caseTypeTH.setFieldValue(caseTypeTH.readCaseTypeDetails$caseID_idx, caseID);
          caseTypeTH.callServer();
          String caseTypeCode = caseTypeTH.getFieldValue(caseTypeTH.result$caseTypeCode$caseTypeCode_idx);
          if(caseTypeCode.equals("CT2000")) {
            url = context + "Case_viewSubmitForApprovalOnlyPage.do?approvalID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);
          } else {
            url = context + "Case_viewSubmitForApprovalViewOnlyPage.do?approvalID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);
          }
          //END, CR00281170
        }         

      } else if (eventType.equals("ET8")) {
                           
        curam.interfaces.CasePkg.Case_isCreoleProduct_TH 
          th = new curam.interfaces.CasePkg.Case_isCreoleProduct_TH();
          
        th.setFieldValue(th.key$caseID_idx, caseID);
        th.setFieldValue(th.approvalKey$caseApprovalID_idx, eventID);
        th.callServer();              
        
        String result  = th.getFieldValue("result$result");
        String determinationID = th.getFieldValue("result$determinationID");
          
        if (result.equals("YES")) {
          url = context + "ProductDelivery_listCreoleDecisionsForDeterminationPage.do?determinationID=" 
                + curam.omega3.request.RequestUtils.escapeURL(determinationID)
                + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);
        }            
      // END, CR00243088  
      } else if (eventType.equals("ET10")) {
        url = context + "Financial_viewPaymentInstructionModalPage.do?finInstructionID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);
      
      // BEGIN, CR00192053, ELG
      } else if (eventType.equals("ET13")) {
        
        String attendeeInd = request.getParameter("attendeeInd");
        String acceptableInd = request.getParameter("acceptableInd");
        
        if (attendeeInd == null) {
          throw new Exception("'attendeeInd' parameter does not exist");
        }
        
        if (acceptableInd == null) {
          throw new Exception("'acceptableInd' parameter does not exist");
        }
      
        url = context + "Case_resolveCalendarEventViewForMeetingsPage.do?ID=" + curam.omega3.request.RequestUtils.escapeURL(eventID)
                + "&amp;RO=false" + "&amp;RE=" + curam.omega3.request.RequestUtils.escapeURL(isRecurring)
                + "&amp;AT=" + curam.omega3.request.RequestUtils.escapeURL(attendeeInd) 
                + "&amp;AC=" + curam.omega3.request.RequestUtils.escapeURL(acceptableInd)
                + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);              
      
      // END, CR00192053
      
      } else if (eventType.equals("ET46")) {             
        url = context + "ServicePlanDelivery_viewServicePlanApprovalRequestViewOnlyPage.do?servicePlanApprovalRequestID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);
                       
      } else if (eventType.equals("ET47")) {             
            url = context + "ServicePlanDelivery_viewServicePlanApprovalRequestViewOnlyPage.do?servicePlanApprovalRequestID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);
              
      } else if (eventType.equals("ET48")) {             
                url = context + "ServicePlanDelivery_viewServicePlanApprovalRequestViewOnlyPage.do?servicePlanApprovalRequestID=" + curam.omega3.request.RequestUtils.escapeURL(eventID);      
      
      } else if (eventType.equals("ET101")) {
        url = context + "ServicePlanDelivery_viewClosureDetailsViewOnlyPage.do?closureID=" 
                      + curam.omega3.request.RequestUtils.escapeURL(eventID) + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);                      
      
      } else if (eventType.equals("ET128")) {
        url = context + "ServicePlanDelivery_viewContractPrintCalendarDetailsPage.do?servicePlanContractID=" + curam.omega3.request.RequestUtils.escapeURL(eventID)
          + "&amp;startDate=" + curam.omega3.request.RequestUtils.escapeURL(startDate) + "&amp;calendarViewType=" + curam.omega3.request.RequestUtils.escapeURL(calendarViewType) + 
            "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);              
       
      } else if (eventType.equals("ET129")) {
        url = context + "IssueDelivery_viewApprovalRequestPage.do?issueApprovalRequestID=" + curam.omega3.request.RequestUtils.escapeURL(eventID)
        + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);      

      } else if (eventType.equals("ET130")) {
        url = context + "IssueDelivery_viewApprovalRequestPage.do?issueApprovalRequestID=" + curam.omega3.request.RequestUtils.escapeURL(eventID)
        + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);

      } else if (eventType.equals("ET131")) {
        url = context + "IssueDelivery_viewApprovalRequestPage.do?issueApprovalRequestID=" + curam.omega3.request.RequestUtils.escapeURL(eventID)
        + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);

      } else if (eventType.equals("ET133")) {
        url = context + "IssueDelivery_viewClosureDetailsPage.do?caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID); 
        
      } else if (eventType.equals("ET134")) {
        url = context + "ProductDelivery_viewMilestoneModalPage.do?milestoneDeliveryID=" + curam.omega3.request.RequestUtils.escapeURL(eventID)
        + "&amp;caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);   

      } else {
        url = context + "Case_noEventDetailsPage.do?caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID); 

      }
      // END, CR00110216
      url += "&amp;" + rh.getSystemParameters();     

      response.sendRedirect(response.encodeRedirectURL(url));

    
  </JSP_SCRIPTLET>
</PAGE>
