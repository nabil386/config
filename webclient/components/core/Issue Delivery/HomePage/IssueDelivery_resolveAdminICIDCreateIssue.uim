<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM
 
  Copyright IBM Corporation 2012-2013. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure 
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!-- Copyright 2010,2011 Curam Software Ltd.                                -->
<!-- All rights reserved.                                                   -->
<!-- This software is the confidential and proprietary information of Curam -->
<!-- Software, Ltd. ("Confidential Information"). You shall not disclose    -->
<!-- such Confidential Information and shall use it only in accordance with -->
<!-- the terms of the license agreement you entered into with Curam         -->
<!-- Software.                                                              -->
<!-- Description                                                            -->
<!-- ===========                                                            -->
<!-- Read for the admin integrated case ID them redirect to the create      -->
<!-- issue pages.                                                           -->
<PAGE PAGE_ID="IssueDelivery_resolveAdminICIDCreateIssue">
  <JSP_SCRIPTLET>    

    curam.omega3.request.RequestHandler 
      rh = curam.omega3.request.RequestHandlerFactory.getRequestHandler(request);

    String context = request.getContextPath() + "/";
    context += curam.omega3.user.UserPreferencesFactory.getUserPreferences(
        pageContext.getSession()).getLocale() + "/";
       
    String url = "";
    
    String caseID = request.getParameter("caseID");

    if (caseID == null) {
      throw new Exception("'caseID' parameter does not exist");
    }
    
    curam.interfaces.IntegratedCasePkg.IntegratedCase_listIssue_TH 
       resolveAdminICID = 
            new curam.interfaces.IntegratedCasePkg.IntegratedCase_listIssue_TH();

    resolveAdminICID.setFieldValue(
        resolveAdminICID.caseHeaderKey$caseID_idx, caseID);

    resolveAdminICID.callServer();

    String adminICID = resolveAdminICID.getFieldValue(
      resolveAdminICID.result$adminIntegratedCaseID_idx);
      
    url = context + "IssueDelivery_selectEvidenceIssueTypeForICWizardPage.do?caseID="+ curam.omega3.request.RequestUtils.escapeURL(caseID)  
        + "&amp;" + "adminIntegratedCaseID=" + curam.omega3.request.RequestUtils.escapeURL(adminICID) 
        + "&amp;" + "description=" + curam.omega3.request.RequestUtils.escapeURL(request.getParameter("description"));
    
    url += "&amp;" + rh.getSystemParameters();
  
    response.sendRedirect(response.encodeRedirectURL(url));
  
  </JSP_SCRIPTLET>
</PAGE>
