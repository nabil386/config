<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM
  
  Copyright IBM Corporation 2012. All Rights Reserved.
  
  US Government Users Restricted Rights - Use, duplication or disclosure 
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!-- Copyright (c) 2005, 2008, 2011 Curam Software Ltd.                     -->
<!-- All rights reserved.                                                   -->
<!-- This software is the confidential and proprietary information of Curam -->
<!-- Software, Ltd. ("Confidential Information"). You shall not disclose    -->
<!-- such Confidential Information and shall use it only in accordance with -->
<!-- the terms of the license agreement you entered into with Curam         -->
<!-- Software.                                                              -->
<!-- Description                                                            -->
<!-- ===========                                                            -->
<!-- This jsp redirects the user to the financial list page of the case.    -->
<?curam-deprecated Since Curam 6.0. Replaced by Case_resolveCaseHome.uim. ?>
<PAGE
  PAGE_ID="Financial_resolveIntegratedCase"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="file://Curam/UIMSchema.xsd"
>
  <JSP_SCRIPTLET>
      

        curam.omega3.request.RequestHandler
          rh = curam.omega3.request.RequestHandlerFactory.getRequestHandler(request);

        String context = request.getContextPath() + "/";
        context += curam.omega3.user.UserPreferencesFactory.getUserPreferences(pageContext.getSession()).getLocale() + "/";

        String caseID = request.getParameter("caseID");
        String integratedCaseID = "0"; 
        String productID = "0";
        String url = "";
        String productType = "";

        if (caseID == null) {
          // BEGIN, CR00110216, SK
       core.ScriptletMissingParamException e = new
                core.ScriptletMissingParamException(-20002, "caseID");
       System.out.println(e);
       throw e;
       // END, CR00110216
        }


        curam.interfaces.FinancialPkg.Financial_readIntegratedCaseIDByCaseID_TH th = new curam.interfaces.FinancialPkg.Financial_readIntegratedCaseIDByCaseID_TH();

        th.setFieldValue(th.resolveIntegratedCaseKey$caseKey$caseID_idx,caseID);
        
        th.callServer();

        integratedCaseID = th.getFieldValue(th.result$integratedCaseID$integratedCaseID_idx);

        curam.interfaces.ProductDeliveryPkg.ProductDelivery_readProductType_TH thProductType = new curam.interfaces.ProductDeliveryPkg.ProductDelivery_readProductType_TH();

        thProductType.setFieldValue(thProductType.productDeliveryKey$caseID_idx,caseID);
        
        thProductType.callServer();

        productType = thProductType.getFieldValue(thProductType.result$productType_idx);
    // BEGIN, CR00110216, SK
    if (productType.equals("PT25")) {
          url += "&amp;" + rh.getSystemParameters();
          url = context + "PDBenefitUnderPayment_listFinancialPage.do?caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);    
    } else if (productType.equals("PT4")) {
          url += "&amp;" + rh.getSystemParameters();
          url = context + "BenefitSampleOverpayment_listFinancialPage.do?caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);    
    } else {
      if(!integratedCaseID.equals("0")){
       url += "&amp;" + rh.getSystemParameters();
       url = context + "ICProductSample_listFinancialPage.do?caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);
          }else {
           curam.interfaces.ProductDeliveryPkg.ProductDelivery_readProductID_TH th2 = new curam.interfaces.ProductDeliveryPkg.ProductDelivery_readProductID_TH(); 
        
       th2.setFieldValue(th2.key$caseID_idx,caseID); 
                
       th2.callServer(); 
        
       productID = th2.getFieldValue(th2.result$productID_idx); 
                
       if(productID.equals("2111")) { 
                    
            url += "&amp;" + rh.getSystemParameters(); 
            url = context + "LiabilityOverbilling_listFinancialPage.do?caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID); 
                  
       } else { 

                  url += "&amp;" + rh.getSystemParameters();
                  url = context + "BenefitSample_listFinancialPage.do?caseID=" + curam.omega3.request.RequestUtils.escapeURL(caseID);
        }    
      }
     }
        
    // END, CR00110216
        response.sendRedirect(response.encodeRedirectURL(url));

      
    </JSP_SCRIPTLET>
</PAGE>
